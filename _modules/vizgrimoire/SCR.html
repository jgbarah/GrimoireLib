<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>vizgrimoire.SCR &mdash; GrimoreLib 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="GrimoreLib 1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">GrimoreLib 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for vizgrimoire.SCR</h1><div class="highlight"><pre>
<span class="c">## Copyright (C) 2013-2014 Bitergia</span>
<span class="c">##</span>
<span class="c">## This program is free software; you can redistribute it and/or modify</span>
<span class="c">## it under the terms of the GNU General Public License as published by</span>
<span class="c">## the Free Software Foundation; either version 3 of the License, or</span>
<span class="c">## (at your option) any later version.</span>
<span class="c">##</span>
<span class="c">## This program is distributed in the hope that it will be useful,</span>
<span class="c">## but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c">## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="c">## GNU General Public License for more details.</span>
<span class="c">##</span>
<span class="c">## You should have received a copy of the GNU General Public License</span>
<span class="c">## along with this program; if not, write to the Free Software</span>
<span class="c">## Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
<span class="c">##</span>
<span class="c">## This file is a part of the vizGrimoire R package</span>
<span class="c">##  (an R library for the MetricsGrimoire and vizGrimoire systems)</span>
<span class="c">##</span>
<span class="c">##</span>
<span class="c">## Queries for source code review data analysis</span>
<span class="c">##</span>
<span class="c">##</span>
<span class="c">## Authors:</span>
<span class="c">##   Daniel Izquierdo &lt;dizquierdo@bitergia.com&gt;</span>
<span class="c">##   Alvaro del Castillo San Felix &lt;acs@bitergia.com&gt;</span>

<span class="kn">import</span> <span class="nn">logging</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">median</span><span class="p">,</span> <span class="n">average</span>

<span class="kn">from</span> <span class="nn">GrimoireSQL</span> <span class="kn">import</span> <span class="n">GetSQLGlobal</span><span class="p">,</span> <span class="n">GetSQLPeriod</span>
<span class="kn">from</span> <span class="nn">GrimoireSQL</span> <span class="kn">import</span> <span class="n">ExecuteQuery</span>
<span class="kn">from</span> <span class="nn">GrimoireUtils</span> <span class="kn">import</span> <span class="n">GetPercentageDiff</span><span class="p">,</span> <span class="n">GetDates</span><span class="p">,</span> <span class="n">completePeriodIds</span>
<span class="kn">from</span> <span class="nn">GrimoireUtils</span> <span class="kn">import</span> <span class="n">checkListArray</span><span class="p">,</span> <span class="n">removeDecimals</span><span class="p">,</span> <span class="n">get_subprojects</span>
<span class="kn">from</span> <span class="nn">GrimoireUtils</span> <span class="kn">import</span> <span class="n">getPeriod</span><span class="p">,</span> <span class="n">createJSON</span><span class="p">,</span> <span class="n">checkFloatArray</span>

<span class="kn">from</span> <span class="nn">data_source</span> <span class="kn">import</span> <span class="n">DataSource</span>
<span class="kn">from</span> <span class="nn">filter</span> <span class="kn">import</span> <span class="n">Filter</span>


<div class="viewcode-block" id="SCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR">[docs]</a><span class="k">class</span> <span class="nc">SCR</span><span class="p">(</span><span class="n">DataSource</span><span class="p">):</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.get_db_name"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.get_db_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_db_name</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">&quot;db_gerrit&quot;</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.get_name"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">():</span> <span class="k">return</span> <span class="s">&quot;scr&quot;</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.get_evolutionary_data"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.get_evolutionary_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_evolutionary_data</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">evol</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">filter_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_item</span><span class="p">()]</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsSubmitted</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsMerged</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsAbandoned</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsPending</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">period</span> <span class="o">==</span> <span class="s">&quot;month&quot;</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">EvolTimeToReviewSCR</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">checkFloatArray</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">])</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_median&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">checkFloatArray</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_median&#39;</span><span class="p">])</span>
                <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">evol</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsSubmitted</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsOpened</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsNew</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsNewChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="c"># data = EvolReviewsInProgress(period, startdate, enddate)</span>
            <span class="c"># evol = dict(evol.items() + completePeriodIds(data, period, startdate, enddate).items())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsClosed</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsMerged</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsMergedChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsAbandoned</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsAbandonedChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsPending</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="c">#Patches info</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolPatchesVerified</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="c"># data = EvolPatchesApproved(period, startdate, enddate)</span>
            <span class="c"># evol = dict(evol.items() + completePeriodIds(data, period, startdate, enddate).items())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolPatchesCodeReview</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolPatchesSent</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="c">#Waiting for actions info</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolWaiting4Reviewer</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolWaiting4Submitter</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="c">#Reviewers info</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="c"># Time to Review info</span>
            <span class="k">if</span> <span class="n">period</span> <span class="o">==</span> <span class="s">&quot;month&quot;</span><span class="p">:</span> <span class="c"># only month supported now</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">EvolTimeToReviewSCR</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">])):</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> 
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="c"># number of filter items evol in time</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">get_countries</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">get_companies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">get_repositories</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="k">return</span> <span class="n">evol</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.create_evolutionary_report"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.create_evolutionary_report">[docs]</a>    <span class="k">def</span> <span class="nf">create_evolutionary_report</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">filter_</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span>  <span class="n">SCR</span><span class="o">.</span><span class="n">get_evolutionary_data</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">filter_</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">SCR</span><span class="p">()</span><span class="o">.</span><span class="n">get_evolutionary_filename</span><span class="p">()</span>
        <span class="n">createJSON</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.get_agg_data"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.get_agg_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_agg_data</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">filter_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_item</span><span class="p">()]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticReviewsSubmitted</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticReviewsMerged</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticReviewsAbandoned</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticReviewsPending</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticTimeToReviewSCR</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">val</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_median&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">val</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_median&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_median&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="n">StaticReviewsSubmitted</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticReviewsOpened</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticReviewsNew</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticReviewsInProgress</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticReviewsClosed</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticReviewsMerged</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticReviewsAbandoned</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticReviewsPending</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticPatchesVerified</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticPatchesApproved</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticPatchesCodeReview</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticPatchesSent</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticWaiting4Reviewer</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticWaiting4Submitter</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="c">#Reviewers info</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticReviewers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="c"># Time to Review info</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">StaticTimeToReviewSCR</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">])</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_median&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_median&#39;</span><span class="p">])</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="c"># Tendencies</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">365</span><span class="p">]:</span>
                <span class="n">period_data</span> <span class="o">=</span> <span class="n">GetSCRDiffSubmittedDays</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
                <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">period_data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="n">period_data</span> <span class="o">=</span> <span class="n">GetSCRDiffMergedDays</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
                <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">period_data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="n">period_data</span> <span class="o">=</span> <span class="n">GetSCRDiffPendingDays</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
                <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">period_data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="n">period_data</span> <span class="o">=</span> <span class="n">GetSCRDiffAbandonedDays</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
                <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">period_data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="c"># number of filter items</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">get_countries</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">get_companies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">get_repositories</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">agg</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.create_agg_report"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.create_agg_report">[docs]</a>    <span class="k">def</span> <span class="nf">create_agg_report</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">filter_</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">get_agg_data</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">filter_</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">SCR</span><span class="p">()</span><span class="o">.</span><span class="n">get_agg_filename</span><span class="p">()</span>
        <span class="n">createJSON</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.get_top_data"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.get_top_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_top_data</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_</span><span class="p">,</span> <span class="n">npeople</span><span class="p">):</span>
        <span class="n">bots</span> <span class="o">=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">get_bots</span><span class="p">()</span>

        <span class="n">top_reviewers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">top_reviewers</span><span class="p">[</span><span class="s">&#39;reviewers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GetTopReviewersSCR</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
        <span class="n">top_reviewers</span><span class="p">[</span><span class="s">&#39;reviewers.last year&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">GetTopReviewersSCR</span><span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
        <span class="n">top_reviewers</span><span class="p">[</span><span class="s">&#39;reviewers.last month&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">GetTopReviewersSCR</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>

        <span class="c"># Top openers</span>
        <span class="n">top_openers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">top_openers</span><span class="p">[</span><span class="s">&#39;openers.&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">GetTopOpenersSCR</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
        <span class="n">top_openers</span><span class="p">[</span><span class="s">&#39;openers.last year&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">GetTopOpenersSCR</span><span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
        <span class="n">top_openers</span><span class="p">[</span><span class="s">&#39;openers.last_month&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">GetTopOpenersSCR</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>

        <span class="c"># Top mergers</span>
        <span class="n">top_mergers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">top_mergers</span><span class="p">[</span><span class="s">&#39;mergers.last year&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">GetTopMergersSCR</span><span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
        <span class="n">top_mergers</span><span class="p">[</span><span class="s">&#39;mergers.&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">GetTopMergersSCR</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
        <span class="n">top_mergers</span><span class="p">[</span><span class="s">&#39;mergers.last_month&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">GetTopMergersSCR</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>

        <span class="c"># The order of the list item change so we can not check it</span>
        <span class="n">top_all</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">top_reviewers</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span>  <span class="n">top_openers</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">top_mergers</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">top_all</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.create_top_report"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.create_top_report">[docs]</a>    <span class="k">def</span> <span class="nf">create_top_report</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">npeople</span><span class="p">,</span> <span class="n">i_db</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">get_top_data</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
        <span class="n">createJSON</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">destdir</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">SCR</span><span class="p">()</span><span class="o">.</span><span class="n">get_top_filename</span><span class="p">())</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.get_filter_items"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.get_filter_items">[docs]</a>    <span class="k">def</span> <span class="nf">get_filter_items</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">filter_name</span> <span class="o">=</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span><span class="p">):</span>
            <span class="n">items</span>  <span class="o">=</span> <span class="n">GetReposSCRName</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;company&quot;</span><span class="p">):</span>
            <span class="n">items</span>  <span class="o">=</span> <span class="n">GetCompaniesSCRName</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;country&quot;</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">GetCountriesSCRName</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;domain&quot;</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;SCR &quot;</span> <span class="o">+</span> <span class="n">filter_name</span> <span class="o">+</span> <span class="s">&quot; not supported&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;project&quot;</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">get_projects_scr_name</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;SCR &quot;</span> <span class="o">+</span> <span class="n">filter_name</span> <span class="o">+</span> <span class="s">&quot; not supported&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.create_filter_report"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.create_filter_report">[docs]</a>    <span class="k">def</span> <span class="nf">create_filter_report</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">npeople</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">get_filter_items</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">items</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span> <span class="k">return</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>

        <span class="n">filter_name</span> <span class="o">=</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">)):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span><span class="p">]</span>

        <span class="c"># For repos aggregated data. Include metrics to sort in javascript.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span><span class="p">):</span>
            <span class="n">items_list</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:[],</span><span class="s">&quot;review_time_days_median&quot;</span><span class="p">:[],</span><span class="s">&quot;submitted&quot;</span><span class="p">:[]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items_list</span> <span class="o">=</span> <span class="n">items</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span> <span class="p">:</span>
            <span class="n">item_file</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span><span class="p">):</span>
                <span class="n">items_list</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_file</span><span class="p">)</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">filter_item</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="n">filter_name</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

            <span class="n">evol</span> <span class="o">=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">get_evolutionary_data</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> 
                                               <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_item</span><span class="p">)</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filter_item</span><span class="o">.</span><span class="n">get_evolutionary_filename</span><span class="p">(</span><span class="n">SCR</span><span class="p">()))</span>
            <span class="n">createJSON</span><span class="p">(</span><span class="n">evol</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

            <span class="c"># Static</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">get_agg_data</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_item</span><span class="p">)</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filter_item</span><span class="o">.</span><span class="n">get_static_filename</span><span class="p">(</span><span class="n">SCR</span><span class="p">()))</span>
            <span class="n">createJSON</span><span class="p">(</span><span class="n">agg</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span><span class="p">):</span>
                <span class="n">items_list</span><span class="p">[</span><span class="s">&quot;submitted&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agg</span><span class="p">[</span><span class="s">&quot;submitted&quot;</span><span class="p">])</span>
                <span class="n">items_list</span><span class="p">[</span><span class="s">&quot;review_time_days_median&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agg</span><span class="p">[</span><span class="s">&#39;review_time_days_median&#39;</span><span class="p">])</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="n">SCR</span><span class="p">()))</span>
        <span class="n">createJSON</span><span class="p">(</span><span class="n">items_list</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

    <span class="c"># Unify top format</span></div>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_safeTopIds</span><span class="p">(</span><span class="n">top_data_period</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top_data_period</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">top_data_period</span><span class="p">:</span>
                <span class="n">top_data_period</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">top_data_period</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">top_data_period</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.get_top_people"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.get_top_people">[docs]</a>    <span class="k">def</span> <span class="nf">get_top_people</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">npeople</span><span class="p">):</span>

        <span class="n">top_data</span> <span class="o">=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">get_top_data</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>

        <span class="n">top</span>  <span class="o">=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">_safeTopIds</span><span class="p">(</span><span class="n">top_data</span><span class="p">[</span><span class="s">&#39;reviewers&#39;</span><span class="p">])</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">_safeTopIds</span><span class="p">(</span><span class="n">top_data</span><span class="p">[</span><span class="s">&#39;reviewers.last year&#39;</span><span class="p">])</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">_safeTopIds</span><span class="p">(</span><span class="n">top_data</span><span class="p">[</span><span class="s">&#39;reviewers.last month&#39;</span><span class="p">])</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">_safeTopIds</span><span class="p">(</span><span class="n">top_data</span><span class="p">[</span><span class="s">&#39;openers.&#39;</span><span class="p">])</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">_safeTopIds</span><span class="p">(</span><span class="n">top_data</span><span class="p">[</span><span class="s">&#39;openers.last year&#39;</span><span class="p">])</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">_safeTopIds</span><span class="p">(</span><span class="n">top_data</span><span class="p">[</span><span class="s">&#39;openers.last_month&#39;</span><span class="p">])</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">_safeTopIds</span><span class="p">(</span><span class="n">top_data</span><span class="p">[</span><span class="s">&#39;mergers.&#39;</span><span class="p">])</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">_safeTopIds</span><span class="p">(</span><span class="n">top_data</span><span class="p">[</span><span class="s">&#39;mergers.last year&#39;</span><span class="p">])</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">SCR</span><span class="o">.</span><span class="n">_safeTopIds</span><span class="p">(</span><span class="n">top_data</span><span class="p">[</span><span class="s">&#39;mergers.last_month&#39;</span><span class="p">])</span>
        <span class="c"># remove duplicates</span>
        <span class="n">people</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">top</span><span class="p">))</span> 

        <span class="k">return</span> <span class="n">people</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.get_person_evol"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.get_person_evol">[docs]</a>    <span class="k">def</span> <span class="nf">get_person_evol</span><span class="p">(</span><span class="n">upeople_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
        <span class="n">evol</span> <span class="o">=</span> <span class="n">GetPeopleEvolSCR</span><span class="p">(</span><span class="n">upeople_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="n">evol</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">evol</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">evol</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.get_person_agg"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.get_person_agg">[docs]</a>    <span class="k">def</span> <span class="nf">get_person_agg</span><span class="p">(</span><span class="n">upeople_id</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GetPeopleStaticSCR</span><span class="p">(</span><span class="n">upeople_id</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.create_r_reports"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.create_r_reports">[docs]</a>    <span class="k">def</span> <span class="nf">create_r_reports</span><span class="p">(</span><span class="n">vizr</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">):</span>
        <span class="k">pass</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCR.get_metrics_definition"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.SCR.get_metrics_definition">[docs]</a>    <span class="k">def</span> <span class="nf">get_metrics_definition</span> <span class="p">():</span>
        <span class="n">mdef</span> <span class="o">=</span>  <span class="p">{</span>
            <span class="s">&quot;scr_merged&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_merged&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;merged&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Merged changes&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of changes merged into the source code&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_mergers&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_mergers&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;mergers&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Successful submitters&quot;</span><span class="p">,</span>
                <span class="s">&quot;action&quot;</span> <span class="p">:</span> <span class="s">&quot;merged&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of persons submitting changes that got accepted&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_opened&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_opened&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;opened&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Opened reviews&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of review processes opened&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_closed&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_closed&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;closed&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Closed reviews&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of closed review processes (merged or abandoned)&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_new&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_new&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;new&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;New reviews&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of new review processes&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_abandoned&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_abandoned&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;abandoned&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Abandoned&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of abandoned review processes&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_verified&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_verified&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;verified&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Verified&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of verified changes&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_approved&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_approved&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;approved&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Approved&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of code review processes in approved state&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_codereview&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_codereview&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;codereview&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Code review&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of code review processes in code review state&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_WaitingForReviewer&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_WaitingForReviewer&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;WaitingForReviewer&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Waiting for reviewer&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of code review processes waiting for reviewer&quot;</span>
            <span class="p">},</span>        
            <span class="s">&quot;scr_WaitingForSubmitter&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_WaitingForSubmitter&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;WaitingForSubmitter&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Waiting for submitter&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of code review processes waiting for submitter&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_submitted&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_submitted&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;submitted&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;submitted&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of submitted code review processes&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_companies&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_companies&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;companies&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Organizations&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of organizations (companies, etc.) with persons active in code review&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_countries&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_countries&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;countries&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Countries&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of countries with persons active in code review&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_domains&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_domains&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;domains&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Domains&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of domains with persons active in code review&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_repositories&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_repositories&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;repositories&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Repositories&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of respositories with active code review activities&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_people&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_people&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;people&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;People&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of persons active in code review activities&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_closers&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_closers&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;closers&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Closers&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of persons closing code review processes&quot;</span><span class="p">,</span>
                <span class="s">&quot;action&quot;</span> <span class="p">:</span> <span class="s">&quot;closed&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scr_openers&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scr_openers&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;openers&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Openers&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of persons closing code review processes&quot;</span><span class="p">,</span>
                <span class="s">&quot;action&quot;</span> <span class="p">:</span> <span class="s">&quot;opened&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">mdef</span>

<span class="c">##########</span>
<span class="c"># Specific FROM and WHERE clauses per type of report</span>
<span class="c">##########</span></div></div>
<div class="viewcode-block" id="GetSQLRepositoriesFromSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetSQLRepositoriesFromSCR">[docs]</a><span class="k">def</span> <span class="nf">GetSQLRepositoriesFromSCR</span> <span class="p">():</span>
    <span class="c">#tables necessaries for repositories</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot; , trackers t&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetSQLRepositoriesWhereSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetSQLRepositoriesWhereSCR">[docs]</a><span class="k">def</span> <span class="nf">GetSQLRepositoriesWhereSCR</span> <span class="p">(</span><span class="n">repository</span><span class="p">):</span>
    <span class="c">#fields necessaries to match info among tables</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot; and t.url =&#39;&quot;</span><span class="o">+</span> <span class="n">repository</span><span class="o">+</span> <span class="s">&quot;&#39; and t.id = i.tracker_id&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetSQLProjectFromSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetSQLProjectFromSCR">[docs]</a><span class="k">def</span> <span class="nf">GetSQLProjectFromSCR</span> <span class="p">():</span>
    <span class="c"># projects are mapped to repositories</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot; , trackers t&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetSQLProjectWhereSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetSQLProjectWhereSCR">[docs]</a><span class="k">def</span> <span class="nf">GetSQLProjectWhereSCR</span> <span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">):</span>
    <span class="c"># include all repositories for a project and its subprojects</span>

    <span class="n">repos</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;and t.url IN (</span>
<span class="s">           SELECT repository_name</span>
<span class="s">           FROM   </span><span class="si">%s</span><span class="s">.projects p, </span><span class="si">%s</span><span class="s">.project_repositories pr</span>
<span class="s">           WHERE  p.project_id = pr.project_id AND p.project_id IN (</span><span class="si">%s</span><span class="s">)</span>
<span class="s">               AND pr.data_source=&#39;scr&#39;</span>
<span class="s">    )&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">get_subprojects</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">repos</span>   <span class="o">+</span> <span class="s">&quot; and t.id = i.tracker_id&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetSQLCompaniesFromSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetSQLCompaniesFromSCR">[docs]</a><span class="k">def</span> <span class="nf">GetSQLCompaniesFromSCR</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">):</span>
    <span class="c">#tables necessaries for companies</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot; , people_upeople pup,&quot;</span><span class="o">+</span>\
            <span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople_companies upc,&quot;</span><span class="o">+</span>\
            <span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.companies c&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetSQLCompaniesWhereSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetSQLCompaniesWhereSCR">[docs]</a><span class="k">def</span> <span class="nf">GetSQLCompaniesWhereSCR</span> <span class="p">(</span><span class="n">company</span><span class="p">):</span>
    <span class="c">#fields necessaries to match info among tables</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot;and i.submitted_by = pup.people_id &quot;</span><span class="o">+</span>\
              <span class="s">&quot;and pup.upeople_id = upc.upeople_id &quot;</span><span class="o">+</span>\
              <span class="s">&quot;and i.submitted_on &gt;= upc.init &quot;</span><span class="o">+</span>\
              <span class="s">&quot;and i.submitted_on &lt; upc.end &quot;</span><span class="o">+</span>\
              <span class="s">&quot;and upc.company_id = c.id &quot;</span><span class="o">+</span>\
              <span class="s">&quot;and c.name =&#39;&quot;</span><span class="o">+</span> <span class="n">company</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetSQLCountriesFromSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetSQLCountriesFromSCR">[docs]</a><span class="k">def</span> <span class="nf">GetSQLCountriesFromSCR</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">):</span>
    <span class="c">#tables necessaries for companies</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot; , people_upeople pup, &quot;</span><span class="o">+</span>\
              <span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople_countries upc, &quot;</span><span class="o">+</span>\
              <span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.countries c &quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetSQLCountriesWhereSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetSQLCountriesWhereSCR">[docs]</a><span class="k">def</span> <span class="nf">GetSQLCountriesWhereSCR</span> <span class="p">(</span><span class="n">country</span><span class="p">):</span>
    <span class="c">#fields necessaries to match info among tables</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot;and i.submitted_by = pup.people_id &quot;</span><span class="o">+</span>\
              <span class="s">&quot;and pup.upeople_id = upc.upeople_id &quot;</span><span class="o">+</span>\
              <span class="s">&quot;and upc.country_id = c.id &quot;</span><span class="o">+</span>\
              <span class="s">&quot;and c.name =&#39;&quot;</span><span class="o">+</span><span class="n">country</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span><span class="p">)</span>


<span class="c">##########</span>
<span class="c">#Generic functions to obtain FROM and WHERE clauses per type of report</span>
<span class="c">##########</span>
</div>
<div class="viewcode-block" id="GetSQLReportFromSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetSQLReportFromSCR">[docs]</a><span class="k">def</span> <span class="nf">GetSQLReportFromSCR</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c">#generic function to generate &#39;from&#39; clauses</span>
    <span class="c">#&quot;type&quot; is a list of two values: type of analysis and value of</span>
    <span class="c">#such analysis</span>

    <span class="n">From</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span> <span class="k">return</span> <span class="n">From</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">analysis</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;repository&#39;</span><span class="p">:</span> <span class="n">From</span> <span class="o">=</span> <span class="n">GetSQLRepositoriesFromSCR</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;company&#39;</span><span class="p">:</span> <span class="n">From</span> <span class="o">=</span> <span class="n">GetSQLCompaniesFromSCR</span><span class="p">(</span><span class="n">identities_db</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;country&#39;</span><span class="p">:</span> <span class="n">From</span> <span class="o">=</span> <span class="n">GetSQLCountriesFromSCR</span><span class="p">(</span><span class="n">identities_db</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;project&#39;</span><span class="p">:</span> <span class="n">From</span> <span class="o">=</span> <span class="n">GetSQLProjectFromSCR</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">From</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetSQLReportWhereSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetSQLReportWhereSCR">[docs]</a><span class="k">def</span> <span class="nf">GetSQLReportWhereSCR</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="c">#generic function to generate &#39;where&#39; clauses</span>

    <span class="c">#&quot;type&quot; is a list of two values: type of analysis and value of</span>
    <span class="c">#such analysis</span>

    <span class="n">where</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span> <span class="k">return</span> <span class="n">where</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">analysis</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;repository&#39;</span><span class="p">:</span> <span class="n">where</span> <span class="o">=</span> <span class="n">GetSQLRepositoriesWhereSCR</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;company&#39;</span><span class="p">:</span> <span class="n">where</span> <span class="o">=</span> <span class="n">GetSQLCompaniesWhereSCR</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;country&#39;</span><span class="p">:</span> <span class="n">where</span> <span class="o">=</span> <span class="n">GetSQLCountriesWhereSCR</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;project&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">identities_db</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;project filter not supported without identities_db&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">where</span> <span class="o">=</span> <span class="n">GetSQLProjectWhereSCR</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">where</span><span class="p">)</span>


<span class="c">#########</span>
<span class="c"># General functions</span>
<span class="c">#########</span>
</div>
<div class="viewcode-block" id="GetReposSCRName"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetReposSCRName">[docs]</a><span class="k">def</span> <span class="nf">GetReposSCRName</span>  <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="n">limit_sql</span><span class="o">=</span><span class="s">&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span> <span class="n">limit_sql</span> <span class="o">=</span> <span class="s">&quot; LIMIT &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT t.url as name, COUNT(DISTINCT(i.id)) AS issues &quot;</span><span class="o">+</span>\
           <span class="s">&quot; FROM  issues i, trackers t &quot;</span><span class="o">+</span>\
           <span class="s">&quot; WHERE i.tracker_id = t.id AND &quot;</span><span class="o">+</span>\
           <span class="s">&quot;  i.submitted_on &gt;=&quot;</span><span class="o">+</span>  <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; AND &quot;</span><span class="o">+</span>\
           <span class="s">&quot;  i.submitted_on &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span> <span class="o">+</span>\
           <span class="s">&quot; GROUP BY t.url &quot;</span><span class="o">+</span>\
           <span class="s">&quot; ORDER BY issues DESC &quot;</span><span class="o">+</span><span class="n">limit_sql</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">)):</span> <span class="n">names</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetCompaniesSCRName"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetCompaniesSCRName">[docs]</a><span class="k">def</span> <span class="nf">GetCompaniesSCRName</span>  <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="n">limit_sql</span><span class="o">=</span><span class="s">&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span> <span class="n">limit_sql</span> <span class="o">=</span> <span class="s">&quot; LIMIT &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT c.id as id, c.name as name, COUNT(DISTINCT(i.id)) AS total &quot;</span><span class="o">+</span>\
               <span class="s">&quot;FROM  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.companies c, &quot;</span><span class="o">+</span>\
                       <span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople_companies upc, &quot;</span><span class="o">+</span>\
                <span class="s">&quot;     people_upeople pup, &quot;</span><span class="o">+</span>\
                <span class="s">&quot;     issues i &quot;</span><span class="o">+</span>\
               <span class="s">&quot;WHERE i.submitted_by = pup.people_id AND &quot;</span><span class="o">+</span>\
               <span class="s">&quot;  upc.upeople_id = pup.upeople_id AND &quot;</span><span class="o">+</span>\
               <span class="s">&quot;  c.id = upc.company_id AND &quot;</span><span class="o">+</span>\
               <span class="s">&quot;  i.status = &#39;merged&#39; AND &quot;</span><span class="o">+</span>\
               <span class="s">&quot;  i.submitted_on &gt;=&quot;</span><span class="o">+</span>  <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; AND &quot;</span><span class="o">+</span>\
               <span class="s">&quot;  i.submitted_on &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
               <span class="s">&quot;GROUP BY c.name &quot;</span><span class="o">+</span>\
               <span class="s">&quot;ORDER BY total DESC &quot;</span> <span class="o">+</span> <span class="n">limit_sql</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="GetCountriesSCRName"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetCountriesSCRName">[docs]</a><span class="k">def</span> <span class="nf">GetCountriesSCRName</span>  <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="n">limit_sql</span><span class="o">=</span><span class="s">&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span> <span class="n">limit_sql</span> <span class="o">=</span> <span class="s">&quot; LIMIT &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT c.name as name, COUNT(DISTINCT(i.id)) AS issues &quot;</span><span class="o">+</span>\
           <span class="s">&quot;FROM  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.countries c, &quot;</span><span class="o">+</span>\
                   <span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople_countries upc, &quot;</span><span class="o">+</span>\
            <span class="s">&quot;    people_upeople pup, &quot;</span><span class="o">+</span>\
            <span class="s">&quot;    issues i &quot;</span><span class="o">+</span>\
           <span class="s">&quot;WHERE i.submitted_by = pup.people_id AND &quot;</span><span class="o">+</span>\
           <span class="s">&quot;  upc.upeople_id = pup.upeople_id AND &quot;</span><span class="o">+</span>\
           <span class="s">&quot;  c.id = upc.country_id AND &quot;</span><span class="o">+</span>\
           <span class="s">&quot;  i.status = &#39;merged&#39; AND &quot;</span><span class="o">+</span>\
           <span class="s">&quot;  i.submitted_on &gt;=&quot;</span><span class="o">+</span>  <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; AND &quot;</span><span class="o">+</span>\
           <span class="s">&quot;  i.submitted_on &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
           <span class="s">&quot;GROUP BY c.name &quot;</span><span class="o">+</span>\
           <span class="s">&quot;ORDER BY issues DESC &quot;</span><span class="o">+</span><span class="n">limit_sql</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="get_countries"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.get_countries">[docs]</a><span class="k">def</span> <span class="nf">get_countries</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">evol</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;count(distinct(upc.country_id)) as countries&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot;issues i, people_upeople pup, </span><span class="si">%s</span><span class="s">.upeople_countries upc&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot;i.submitted_by = pup.people_id and pup.upeople_id = upc.upeople_id&quot;</span>
    <span class="k">if</span> <span class="n">evol</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="s">&#39;i.submitted_on&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
               <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&#39;i.submitted_on&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
               <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="n">countries</span><span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">countries</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="get_companies"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.get_companies">[docs]</a><span class="k">def</span> <span class="nf">get_companies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">evol</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;count(distinct(upc.company_id)) as companies&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot;issues i, people_upeople pup, </span><span class="si">%s</span><span class="s">.upeople_companies upc&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot;i.submitted_by = pup.people_id and pup.upeople_id = upc.upeople_id&quot;</span>
    <span class="k">if</span> <span class="n">evol</span><span class="p">:</span>
       <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="s">&#39;i.submitted_on&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
               <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&#39;i.submitted_on&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="n">companies</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">companies</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="get_repositories"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.get_repositories">[docs]</a><span class="k">def</span> <span class="nf">get_repositories</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">evol</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;count(distinct(t.id)) as repositories&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot;issues i, trackers t&quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot;i.tracker_id = t.id&quot;</span>
    <span class="k">if</span> <span class="n">evol</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="s">&#39;i.submitted_on&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
               <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&#39;i.submitted_on&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="n">repositories</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">repositories</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="get_projects_scr_name"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.get_projects_scr_name">[docs]</a><span class="k">def</span> <span class="nf">get_projects_scr_name</span>  <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="c"># Projects activity needs to include subprojects also</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s">&quot;Getting projects list for SCR&quot;</span><span class="p">)</span>

    <span class="c"># Get all projects list</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT p.id AS name FROM  </span><span class="si">%s</span><span class="s">.projects p&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">)</span>
    <span class="n">projects</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c"># Loop all projects getting reviews</span>
    <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">projects</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]:</span>
        <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;project&#39;</span><span class="p">,</span> <span class="n">project</span><span class="p">]</span>
        <span class="n">period</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">evol</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">reviews</span> <span class="o">=</span> <span class="n">GetReviews</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;submitted&quot;</span><span class="p">,</span>
                              <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evol</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
        <span class="n">reviews</span> <span class="o">=</span> <span class="n">reviews</span><span class="p">[</span><span class="s">&#39;submitted&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">reviews</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">reviews</span><span class="p">,</span><span class="n">project</span><span class="p">])</span>

    <span class="c"># Order the list using reviews: https://wiki.python.org/moin/HowTo/Sorting</span>
    <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
    <span class="n">data_sort</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_sort</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span> <span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
    <span class="k">return</span><span class="p">({</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="n">names</span><span class="p">})</span>

<span class="c">#########</span>
<span class="c">#Functions about the status of the review</span>
<span class="c">#########</span>

<span class="c"># REVIEWS</span></div>
<div class="viewcode-block" id="GetReviews"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetReviews">[docs]</a><span class="k">def</span> <span class="nf">GetReviews</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">):</span>
    <span class="c">#Building the query</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(i.issue)) as &quot;</span> <span class="o">+</span> <span class="n">type_</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot;issues i&quot;</span> <span class="o">+</span> <span class="n">GetSQLReportFromSCR</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s">&quot;submitted&quot;</span><span class="p">:</span> <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s">&quot;opened&quot;</span><span class="p">:</span> <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; (i.status = &#39;NEW&#39; or i.status = &#39;WORKINPROGRESS&#39;) &quot;</span>
    <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s">&quot;new&quot;</span><span class="p">:</span> <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; i.status = &#39;NEW&#39; &quot;</span>
    <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s">&quot;inprogress&quot;</span><span class="p">:</span> <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; i.status = &#39;WORKINGPROGRESS&#39; &quot;</span>
    <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s">&quot;closed&quot;</span><span class="p">:</span> <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; (i.status = &#39;MERGED&#39; or i.status = &#39;ABANDONED&#39;) &quot;</span>
    <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s">&quot;merged&quot;</span><span class="p">:</span> <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; i.status = &#39;MERGED&#39; &quot;</span>
    <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s">&quot;abandoned&quot;</span><span class="p">:</span> <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; i.status = &#39;ABANDONED&#39; &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="o">+</span> <span class="n">GetSQLReportWhereSCR</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#Adding dates filters (and evolutionary or static analysis)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">evolutionary</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="s">&quot;i.submitted_on&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                         <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&quot; i.submitted_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>


<span class="c"># Reviews status using changes table</span></div>
<div class="viewcode-block" id="GetReviewsChanges"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetReviewsChanges">[docs]</a><span class="k">def</span> <span class="nf">GetReviewsChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">):</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;count(issue_id) as &quot;</span><span class="o">+</span> <span class="n">type_</span><span class="o">+</span> <span class="s">&quot;_changes&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot;changes c, issues i&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">tables</span> <span class="o">+</span> <span class="n">GetSQLReportFromSCR</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot;c.issue_id = i.id AND new_value=&#39;&quot;</span><span class="o">+</span><span class="n">type_</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="o">+</span> <span class="n">GetSQLReportWhereSCR</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#Adding dates filters (and evolutionary or static analysis)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">evolutionary</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="s">&quot; changed_on&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                            <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&quot; changed_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>


<span class="c"># EVOLUTIONoneRY META FUNCTIONS BASED ON REVIEWS</span>
</div>
<div class="viewcode-block" id="EvolReviewsSubmitted"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolReviewsSubmitted">[docs]</a><span class="k">def</span> <span class="nf">EvolReviewsSubmitted</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviews</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;submitted&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolReviewsOpened"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolReviewsOpened">[docs]</a><span class="k">def</span> <span class="nf">EvolReviewsOpened</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviews</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;opened&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolReviewsNew"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolReviewsNew">[docs]</a><span class="k">def</span> <span class="nf">EvolReviewsNew</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviews</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;new&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="GetEvolChanges"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetEvolChanges">[docs]</a><span class="k">def</span> <span class="nf">GetEvolChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;count(issue_id) as &quot;</span><span class="o">+</span> <span class="n">value</span><span class="o">+</span> <span class="s">&quot;_changes&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot;changes&quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot;new_value=&#39;&quot;</span><span class="o">+</span><span class="n">value</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="s">&quot; changed_on&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
            <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolReviewsNewChanges"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolReviewsNewChanges">[docs]</a><span class="k">def</span> <span class="nf">EvolReviewsNewChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviewsChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;new&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolReviewsInProgress"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolReviewsInProgress">[docs]</a><span class="k">def</span> <span class="nf">EvolReviewsInProgress</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviews</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;inprogress&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolReviewsClosed"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolReviewsClosed">[docs]</a><span class="k">def</span> <span class="nf">EvolReviewsClosed</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviews</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;closed&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolReviewsMerged"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolReviewsMerged">[docs]</a><span class="k">def</span> <span class="nf">EvolReviewsMerged</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviews</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;merged&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolReviewsMergedChanges"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolReviewsMergedChanges">[docs]</a><span class="k">def</span> <span class="nf">EvolReviewsMergedChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviewsChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;merged&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolReviewsAbandoned"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolReviewsAbandoned">[docs]</a><span class="k">def</span> <span class="nf">EvolReviewsAbandoned</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviews</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;abandoned&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolReviewsAbandonedChanges"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolReviewsAbandonedChanges">[docs]</a><span class="k">def</span> <span class="nf">EvolReviewsAbandonedChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviewsChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;abandoned&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolReviewsPending"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolReviewsPending">[docs]</a><span class="k">def</span> <span class="nf">EvolReviewsPending</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsSubmitted</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">data1</span> <span class="o">=</span> <span class="n">EvolReviewsMerged</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="n">data1</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">data2</span> <span class="o">=</span> <span class="n">EvolReviewsAbandoned</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="n">data2</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data1</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data2</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">pending</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;pending&quot;</span><span class="p">:[]}</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">evol</span><span class="p">[</span><span class="s">&#39;merged&#39;</span><span class="p">])):</span>
        <span class="n">pending_val</span> <span class="o">=</span> <span class="n">evol</span><span class="p">[</span><span class="s">&quot;submitted&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">evol</span><span class="p">[</span><span class="s">&quot;merged&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">evol</span><span class="p">[</span><span class="s">&quot;abandoned&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">pending</span><span class="p">[</span><span class="s">&quot;pending&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pending_val</span><span class="p">)</span>
    <span class="n">pending</span><span class="p">[</span><span class="n">period</span><span class="p">]</span> <span class="o">=</span> <span class="n">evol</span><span class="p">[</span><span class="n">period</span><span class="p">]</span>
    <span class="n">pending</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">pending</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pending</span>

<span class="c"># PENDING = SUBMITTED - MERGED - ABANDONED</span></div>
<div class="viewcode-block" id="EvolReviewsPendingChanges"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolReviewsPendingChanges">[docs]</a><span class="k">def</span> <span class="nf">EvolReviewsPendingChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">EvolReviewsSubmitted</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">data1</span> <span class="o">=</span> <span class="n">EvolReviewsMergedChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="n">data1</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">data2</span> <span class="o">=</span> <span class="n">EvolReviewsAbandonedChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="n">data2</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data1</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data2</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">pending</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;pending&quot;</span><span class="p">:[]}</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">evol</span><span class="p">[</span><span class="s">&#39;merged_changes&#39;</span><span class="p">])):</span>
        <span class="n">pending_val</span> <span class="o">=</span> <span class="n">evol</span><span class="p">[</span><span class="s">&quot;submitted&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">evol</span><span class="p">[</span><span class="s">&quot;merged_changes&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">evol</span><span class="p">[</span><span class="s">&quot;abandoned_changes&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">pending</span><span class="p">[</span><span class="s">&quot;pending&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pending_val</span><span class="p">)</span>

    <span class="n">pending</span><span class="p">[</span><span class="n">period</span><span class="p">]</span> <span class="o">=</span> <span class="n">evol</span><span class="p">[</span><span class="n">period</span><span class="p">]</span>
    <span class="n">pending</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">pending</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pending</span>

<span class="c"># STATIC META FUNCTIONS BASED ON REVIEWS</span>
</div>
<div class="viewcode-block" id="StaticReviewsSubmitted"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticReviewsSubmitted">[docs]</a><span class="k">def</span> <span class="nf">StaticReviewsSubmitted</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviews</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;submitted&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticReviewsOpened"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticReviewsOpened">[docs]</a><span class="k">def</span> <span class="nf">StaticReviewsOpened</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviews</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;opened&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticReviewsNew"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticReviewsNew">[docs]</a><span class="k">def</span> <span class="nf">StaticReviewsNew</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviews</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;new&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticReviewsNewChanges"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticReviewsNewChanges">[docs]</a><span class="k">def</span> <span class="nf">StaticReviewsNewChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviewsChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;new&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticReviewsInProgress"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticReviewsInProgress">[docs]</a><span class="k">def</span> <span class="nf">StaticReviewsInProgress</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviews</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;inprogress&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticReviewsClosed"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticReviewsClosed">[docs]</a><span class="k">def</span> <span class="nf">StaticReviewsClosed</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviews</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;closed&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticReviewsMerged"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticReviewsMerged">[docs]</a><span class="k">def</span> <span class="nf">StaticReviewsMerged</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviews</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;merged&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticReviewsMergedChanges"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticReviewsMergedChanges">[docs]</a><span class="k">def</span> <span class="nf">StaticReviewsMergedChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviewsChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;merged&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticReviewsAbandoned"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticReviewsAbandoned">[docs]</a><span class="k">def</span> <span class="nf">StaticReviewsAbandoned</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviews</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;abandoned&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticReviewsAbandonedChanges"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticReviewsAbandonedChanges">[docs]</a><span class="k">def</span> <span class="nf">StaticReviewsAbandonedChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviewsChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;abandoned&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>


<span class="c"># PENDING = SUBMITTED - MERGED - ABANDONED</span></div>
<div class="viewcode-block" id="StaticReviewsPending"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticReviewsPending">[docs]</a><span class="k">def</span> <span class="nf">StaticReviewsPending</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">submitted</span> <span class="o">=</span> <span class="n">StaticReviewsSubmitted</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="n">merged</span> <span class="o">=</span> <span class="n">StaticReviewsMerged</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="n">abandoned</span> <span class="o">=</span> <span class="n">StaticReviewsAbandoned</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="n">pending</span> <span class="o">=</span> <span class="n">submitted</span><span class="p">[</span><span class="s">&#39;submitted&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">merged</span><span class="p">[</span><span class="s">&#39;merged&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">abandoned</span><span class="p">[</span><span class="s">&#39;abandoned&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">({</span><span class="s">&quot;pending&quot;</span><span class="p">:</span><span class="n">pending</span><span class="p">})</span>

</div>
<div class="viewcode-block" id="StaticReviewsPendingChanges"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticReviewsPendingChanges">[docs]</a><span class="k">def</span> <span class="nf">StaticReviewsPendingChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">submitted</span> <span class="o">=</span> <span class="n">StaticReviewsSubmitted</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="n">merged</span> <span class="o">=</span> <span class="n">StaticReviewsMergedChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="n">abandoned</span> <span class="o">=</span> <span class="n">StaticReviewsAbandonedChanges</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="n">pending</span> <span class="o">=</span> <span class="n">submitted</span><span class="p">[</span><span class="s">&#39;submitted&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">merged</span><span class="p">[</span><span class="s">&#39;merged&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">abandoned</span><span class="p">[</span><span class="s">&#39;abandoned&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">({</span><span class="s">&quot;pending&quot;</span><span class="p">:</span><span class="n">pending</span><span class="p">})</span>


<span class="c">#WORK ON PATCHES: ANY REVIEW MAY HAVE MORE THAN ONE PATCH</span></div>
<div class="viewcode-block" id="GetEvaluations"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetEvaluations">[docs]</a><span class="k">def</span> <span class="nf">GetEvaluations</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">,</span> <span class="n">identities_db</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="c"># verified - VRIF</span>
    <span class="c"># approved - APRV</span>
    <span class="c"># code review - CRVW</span>
    <span class="c"># submitted - SUBM</span>

    <span class="c">#Building the query</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(c.id)) as &quot;</span> <span class="o">+</span> <span class="n">type_</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; changes c, issues i &quot;</span> <span class="o">+</span> <span class="n">GetSQLReportFromSCR</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s">&quot;verified&quot;</span><span class="p">:</span> <span class="n">filters</span> <span class="o">=</span>  <span class="s">&quot; (c.field = &#39;VRIF&#39; OR c.field = &#39;Verified&#39;) &quot;</span>
    <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s">&quot;approved&quot;</span><span class="p">:</span> <span class="n">filters</span> <span class="o">=</span>  <span class="s">&quot; c.field = &#39;APRV&#39;  &quot;</span>
    <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s">&quot;codereview&quot;</span><span class="p">:</span> <span class="n">filters</span> <span class="o">=</span>  <span class="s">&quot;   (c.field = &#39;CRVW&#39; OR c.field = &#39;Code-Review&#39;) &quot;</span>
    <span class="k">elif</span> <span class="n">type_</span> <span class="o">==</span> <span class="s">&quot;sent&quot;</span><span class="p">:</span> <span class="n">filters</span> <span class="o">=</span>  <span class="s">&quot; c.field = &#39;SUBM&#39;  &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="o">+</span> <span class="s">&quot; and i.id = c.issue_id &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="o">+</span> <span class="n">GetSQLReportWhereSCR</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#Adding dates filters</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">evolutionary</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="s">&quot; c.changed_on&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                          <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&quot; c.changed_on&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                      <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

<span class="c"># EVOLUTIONoneRY METRICS</span></div>
<div class="viewcode-block" id="EvolPatchesVerified"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolPatchesVerified">[docs]</a><span class="k">def</span> <span class="nf">EvolPatchesVerified</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetEvaluations</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;verified&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolPatchesApproved"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolPatchesApproved">[docs]</a><span class="k">def</span> <span class="nf">EvolPatchesApproved</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetEvaluations</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;approved&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolPatchesCodeReview"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolPatchesCodeReview">[docs]</a><span class="k">def</span> <span class="nf">EvolPatchesCodeReview</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetEvaluations</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;codereview&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolPatchesSent"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolPatchesSent">[docs]</a><span class="k">def</span> <span class="nf">EvolPatchesSent</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetEvaluations</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;sent&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>


<span class="c">#STATIC METRICS</span></div>
<div class="viewcode-block" id="StaticPatchesVerified"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticPatchesVerified">[docs]</a><span class="k">def</span> <span class="nf">StaticPatchesVerified</span>  <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetEvaluations</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;verified&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticPatchesApproved"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticPatchesApproved">[docs]</a><span class="k">def</span> <span class="nf">StaticPatchesApproved</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetEvaluations</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;approved&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticPatchesCodeReview"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticPatchesCodeReview">[docs]</a><span class="k">def</span> <span class="nf">StaticPatchesCodeReview</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetEvaluations</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;codereview&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticPatchesSent"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticPatchesSent">[docs]</a><span class="k">def</span> <span class="nf">StaticPatchesSent</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetEvaluations</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;sent&quot;</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>


<span class="c">#PATCHES WAITING FOR REVIEW FROM REVIEWER</span></div>
<div class="viewcode-block" id="GetWaiting4Reviewer"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetWaiting4Reviewer">[docs]</a><span class="k">def</span> <span class="nf">GetWaiting4Reviewer</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(c.id)) as WaitingForReviewer &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; changes c, &quot;</span><span class="o">+</span>\
             <span class="s">&quot;  issues i, &quot;</span><span class="o">+</span>\
             <span class="s">&quot;        (select c.issue_id as issue_id, &quot;</span><span class="o">+</span>\
             <span class="s">&quot;                c.old_value as old_value, &quot;</span><span class="o">+</span>\
             <span class="s">&quot;                max(c.id) as id &quot;</span><span class="o">+</span>\
             <span class="s">&quot;         from changes c, &quot;</span><span class="o">+</span>\
             <span class="s">&quot;              issues i &quot;</span><span class="o">+</span>\
             <span class="s">&quot;         where c.issue_id = i.id and &quot;</span><span class="o">+</span>\
             <span class="s">&quot;               i.status=&#39;NEW&#39; &quot;</span><span class="o">+</span>\
             <span class="s">&quot;         group by c.issue_id, c.old_value) t1 &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">tables</span> <span class="o">+</span> <span class="n">GetSQLReportFromSCR</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span>  <span class="s">&quot; i.id = c.issue_id  &quot;</span><span class="o">+</span>\
               <span class="s">&quot;  and t1.id = c.id &quot;</span><span class="o">+</span>\
               <span class="s">&quot;  and (c.field=&#39;CRVW&#39; or c.field=&#39;Code-Review&#39; or c.field=&#39;Verified&#39; or c.field=&#39;VRIF&#39;) &quot;</span><span class="o">+</span>\
               <span class="s">&quot;  and (c.new_value=1 or c.new_value=2) &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="o">+</span> <span class="n">GetSQLReportWhereSCR</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">evolutionary</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="s">&quot; c.changed_on&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                          <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&quot; c.changed_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                          <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolWaiting4Reviewer"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolWaiting4Reviewer">[docs]</a><span class="k">def</span> <span class="nf">EvolWaiting4Reviewer</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetWaiting4Reviewer</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticWaiting4Reviewer"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticWaiting4Reviewer">[docs]</a><span class="k">def</span> <span class="nf">StaticWaiting4Reviewer</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetWaiting4Reviewer</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GetWaiting4Submitter"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetWaiting4Submitter">[docs]</a><span class="k">def</span> <span class="nf">GetWaiting4Submitter</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;count(distinct(c.id)) as WaitingForSubmitter &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot;  changes c, &quot;</span><span class="o">+</span>\
             <span class="s">&quot;   issues i, &quot;</span><span class="o">+</span>\
             <span class="s">&quot;        (select c.issue_id as issue_id, &quot;</span><span class="o">+</span>\
             <span class="s">&quot;                c.old_value as old_value, &quot;</span><span class="o">+</span>\
             <span class="s">&quot;                max(c.id) as id &quot;</span><span class="o">+</span>\
             <span class="s">&quot;         from changes c, &quot;</span><span class="o">+</span>\
             <span class="s">&quot;              issues i &quot;</span><span class="o">+</span>\
             <span class="s">&quot;         where c.issue_id = i.id and &quot;</span><span class="o">+</span>\
             <span class="s">&quot;               i.status=&#39;NEW&#39; &quot;</span><span class="o">+</span>\
             <span class="s">&quot;         group by c.issue_id, c.old_value) t1 &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">tables</span> <span class="o">+</span> <span class="n">GetSQLReportFromSCR</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; i.id = c.issue_id &quot;</span><span class="o">+</span>\
              <span class="s">&quot;  and t1.id = c.id &quot;</span><span class="o">+</span>\
              <span class="s">&quot;  and (c.field=&#39;CRVW&#39; or c.field=&#39;Code-Review&#39; or c.field=&#39;Verified&#39; or c.field=&#39;VRIF&#39;) &quot;</span><span class="o">+</span>\
              <span class="s">&quot;  and (c.new_value=-1 or c.new_value=-2) &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="o">+</span> <span class="n">GetSQLReportWhereSCR</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">evolutionary</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="s">&quot; c.changed_on&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                          <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&quot; c.changed_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                          <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolWaiting4Submitter"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolWaiting4Submitter">[docs]</a><span class="k">def</span> <span class="nf">EvolWaiting4Submitter</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetWaiting4Submitter</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticWaiting4Submitter"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticWaiting4Submitter">[docs]</a><span class="k">def</span> <span class="nf">StaticWaiting4Submitter</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetWaiting4Submitter</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>


<span class="c">#REVIEWERS</span>
</div>
<div class="viewcode-block" id="GetReviewers"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetReviewers">[docs]</a><span class="k">def</span> <span class="nf">GetReviewers</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># TODO: so far without unique identities</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(changed_by)) as reviewers &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; changes c &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">evolutionary</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="s">&quot; c.changed_on&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                          <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&quot; c.changed_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                          <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolReviewers"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolReviewers">[docs]</a><span class="k">def</span> <span class="nf">EvolReviewers</span>  <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviewers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticReviewers"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticReviewers">[docs]</a><span class="k">def</span> <span class="nf">StaticReviewers</span>  <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetReviewers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>


<span class="c"># Nobody is using it yet</span></div>
<div class="viewcode-block" id="GetLongestReviews"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetLongestReviews">[docs]</a><span class="k">def</span> <span class="nf">GetLongestReviews</span>  <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>

<span class="c">#    q = &quot;select i.issue as review, &quot;+\</span>
<span class="c">#        &quot;         t1.old_value as patch, &quot;+\</span>
<span class="c">#        &quot;         timestampdiff (HOUR, t1.min_time, t1.max_time) as timeOpened &quot;+\</span>
<span class="c">#        &quot;  from ( &quot;+\</span>
<span class="c">#        &quot;        select c.issue_id as issue_id, &quot;+\</span>
<span class="c">#        &quot;               c.old_value as old_value, &quot;+\</span>
<span class="c">#        &quot;               min(c.changed_on) as min_time, &quot;+\</span>
<span class="c">#        &quot;               max(c.changed_on) as max_time &quot;+\</span>
<span class="c">#        &quot;        from changes c, &quot;+\</span>
<span class="c">#        &quot;             issues i &quot;+\</span>
<span class="c">#        &quot;        where c.issue_id = i.id and &quot;+\</span>
<span class="c">#        &quot;              i.status=&#39;NEW&#39; &quot;+\</span>
<span class="c">#        &quot;        group by c.issue_id, &quot;+\</span>
<span class="c">#        &quot;                 c.old_value) t1, &quot;+\</span>
<span class="c">#        &quot;       issues i &quot;+\</span>
<span class="c">#        &quot;  where t1.issue_id = i.id &quot;+\</span>
<span class="c">#        &quot;  order by timeOpened desc &quot;+\</span>
<span class="c">#        &quot;  limit 20&quot;</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; i.issue as review, &quot;</span> <span class="o">+</span> \
             <span class="s">&quot; t1.old_value as patch, &quot;</span> <span class="o">+</span> \
            <span class="s">&quot; timestampdiff (HOUR, t1.min_time, t1.max_time) as timeOpened, &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; issues i, &quot;</span><span class="o">+</span>\
            <span class="s">&quot; (select c.issue_id as issue_id, &quot;</span><span class="o">+</span>\
            <span class="s">&quot;           c.old_value as old_value, &quot;</span><span class="o">+</span>\
            <span class="s">&quot;           min(c.changed_on) as min_time, &quot;</span><span class="o">+</span>\
            <span class="s">&quot;           max(c.changed_on) as max_time &quot;</span><span class="o">+</span>\
            <span class="s">&quot;    from changes c, &quot;</span><span class="o">+</span>\
            <span class="s">&quot;         issues i &quot;</span><span class="o">+</span>\
            <span class="s">&quot;    where c.issue_id = i.id and &quot;</span><span class="o">+</span>\
            <span class="s">&quot;          i.status=&#39;NEW&#39; &quot;</span><span class="o">+</span>\
            <span class="s">&quot;    group by c.issue_id, &quot;</span><span class="o">+</span>\
            <span class="s">&quot;             c.old_value) t1 &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">tables</span> <span class="o">+</span> <span class="n">GetSQLReportFromSCR</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; t1.issue_id = i.id &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="o">+</span> <span class="n">GetSQLReportWhereSCR</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&quot; i.submitted_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                           <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

<span class="c">##</span>
<span class="c"># Tops</span>
<span class="c">##</span>

<span class="c"># Is this right???</span></div>
<div class="viewcode-block" id="GetTopReviewersSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetTopReviewersSCR">[docs]</a><span class="k">def</span> <span class="nf">GetTopReviewersSCR</span> <span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
    <span class="n">date_limit</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">filter_bots</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">bot</span> <span class="ow">in</span> <span class="n">bots</span><span class="p">:</span>
        <span class="n">filter_bots</span> <span class="o">=</span> <span class="n">filter_bots</span> <span class="o">+</span> <span class="s">&quot; up.identifier&lt;&gt;&#39;&quot;</span><span class="o">+</span><span class="n">bot</span><span class="o">+</span><span class="s">&quot;&#39; and &quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">days</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT @maxdate:=max(changed_on) from changes limit 1&quot;</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">date_limit</span> <span class="o">=</span> <span class="s">&quot; AND DATEDIFF(@maxdate, changed_on)&lt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT up.id as id, up.identifier as reviewers, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;               count(distinct(c.id)) as reviewed &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        FROM people_upeople pup, changes c, &quot;</span><span class="o">+</span> <span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople up &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        WHERE &quot;</span><span class="o">+</span> <span class="n">filter_bots</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;            c.changed_by = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;            pup.upeople_id = up.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;            c.changed_on &gt;= &quot;</span><span class="o">+</span> <span class="n">startdate</span> <span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;            c.changed_on &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;            &quot;</span><span class="o">+</span> <span class="n">date_limit</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        GROUP BY up.identifier &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        ORDER BY reviewed desc, reviewers &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        LIMIT &quot;</span> <span class="o">+</span> <span class="n">limit</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GetTopSubmittersQuerySCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetTopSubmittersQuerySCR">[docs]</a><span class="k">def</span> <span class="nf">GetTopSubmittersQuerySCR</span>   <span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">merged</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="n">date_limit</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">merged_sql</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">rol</span> <span class="o">=</span> <span class="s">&quot;openers&quot;</span>
    <span class="n">action</span> <span class="o">=</span> <span class="s">&quot;opened&quot;</span>
    <span class="n">filter_bots</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">bot</span> <span class="ow">in</span> <span class="n">bots</span><span class="p">:</span>
        <span class="n">filter_bots</span> <span class="o">=</span> <span class="n">filter_bots</span><span class="o">+</span> <span class="s">&quot; up.identifier&lt;&gt;&#39;&quot;</span><span class="o">+</span><span class="n">bot</span><span class="o">+</span><span class="s">&quot;&#39; and &quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">days</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT @maxdate:=max(submitted_on) from issues limit 1&quot;</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">date_limit</span> <span class="o">=</span> <span class="s">&quot; AND DATEDIFF(@maxdate, submitted_on)&lt;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">merged</span><span class="p">):</span>
        <span class="n">merged_sql</span> <span class="o">=</span> <span class="s">&quot; AND status=&#39;MERGED&#39; &quot;</span>
        <span class="n">rol</span> <span class="o">=</span> <span class="s">&quot;mergers&quot;</span>
        <span class="n">action</span> <span class="o">=</span> <span class="s">&quot;merged&quot;</span>


    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT up.id as id, up.identifier as &quot;</span><span class="o">+</span><span class="n">rol</span><span class="o">+</span><span class="s">&quot;, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;            count(distinct(i.id)) as &quot;</span><span class="o">+</span><span class="n">action</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        FROM people_upeople pup, issues i, &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople up &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        WHERE &quot;</span><span class="o">+</span> <span class="n">filter_bots</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;            i.submitted_by = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;            pup.upeople_id = up.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;            i.submitted_on &gt;= &quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;            i.submitted_on &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;            &quot;</span><span class="o">+</span><span class="n">date_limit</span><span class="o">+</span> <span class="n">merged_sql</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        GROUP BY up.identifier &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        ORDER BY &quot;</span><span class="o">+</span><span class="n">action</span><span class="o">+</span><span class="s">&quot; desc, id &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        LIMIT &quot;</span><span class="o">+</span> <span class="n">limit</span>
    <span class="k">return</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetTopOpenersSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetTopOpenersSCR">[docs]</a><span class="k">def</span> <span class="nf">GetTopOpenersSCR</span> <span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetTopSubmittersQuerySCR</span> <span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GetTopMergersSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetTopMergersSCR">[docs]</a><span class="k">def</span> <span class="nf">GetTopMergersSCR</span>   <span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetTopSubmittersQuerySCR</span> <span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>


<span class="c">#########</span>
<span class="c"># PEOPLE: Pretty similar to ITS</span>
<span class="c">#########</span></div>
<div class="viewcode-block" id="GetTablesOwnUniqueIdsSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetTablesOwnUniqueIdsSCR">[docs]</a><span class="k">def</span> <span class="nf">GetTablesOwnUniqueIdsSCR</span> <span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&#39;changes c, people_upeople pup&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">table</span> <span class="o">==</span> <span class="s">&quot;issues&quot;</span><span class="p">):</span> <span class="n">tables</span> <span class="o">=</span> <span class="s">&#39;issues i, people_upeople pup&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">tables</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetFiltersOwnUniqueIdsSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetFiltersOwnUniqueIdsSCR">[docs]</a><span class="k">def</span> <span class="nf">GetFiltersOwnUniqueIdsSCR</span>  <span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&#39;pup.people_id = c.changed_by&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">table</span> <span class="o">==</span> <span class="s">&quot;issues&quot;</span><span class="p">):</span> <span class="n">filters</span> <span class="o">=</span> <span class="s">&#39;pup.people_id = i.submitted_by&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">filters</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetPeopleListSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetPeopleListSCR">[docs]</a><span class="k">def</span> <span class="nf">GetPeopleListSCR</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">bots</span><span class="p">):</span>

    <span class="n">filter_bots</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">bot</span> <span class="ow">in</span> <span class="n">bots</span><span class="p">:</span>
        <span class="n">filter_bots</span> <span class="o">+=</span> <span class="s">&quot; name&lt;&gt;&#39;&quot;</span><span class="o">+</span><span class="n">bot</span><span class="o">+</span><span class="s">&quot;&#39; and &quot;</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;DISTINCT(pup.upeople_id) as id, count(i.id) as total, name&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">GetTablesOwnUniqueIdsSCR</span><span class="p">(</span><span class="s">&#39;issues&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;, people&quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">filter_bots</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="n">GetFiltersOwnUniqueIdsSCR</span><span class="p">(</span><span class="s">&#39;issues&#39;</span><span class="p">)</span><span class="o">+</span> <span class="s">&quot; and people.id = pup.people_id&quot;</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; GROUP BY id ORDER BY total desc&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&#39;submitted_on&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GetPeopleQuerySCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetPeopleQuerySCR">[docs]</a><span class="k">def</span> <span class="nf">GetPeopleQuerySCR</span> <span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">evol</span><span class="p">):</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;COUNT(c.id) AS closed&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">GetTablesOwnUniqueIdsSCR</span><span class="p">()</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetFiltersOwnUniqueIdsSCR</span><span class="p">()</span><span class="o">+</span> <span class="s">&quot; AND pup.upeople_id = &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">developer_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">evol</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="s">&#39;changed_on&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span> <span class="o">+</span> \
                <span class="s">&quot;,DATE_FORMAT (min(changed_on),&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;) as first_date, &quot;</span><span class="o">+</span>\
                <span class="s">&quot;  DATE_FORMAT (max(changed_on),&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;) as last_date&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&#39;changed_on&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetPeopleEvolSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetPeopleEvolSCR">[docs]</a><span class="k">def</span> <span class="nf">GetPeopleEvolSCR</span> <span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetPeopleQuerySCR</span><span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="GetPeopleStaticSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetPeopleStaticSCR">[docs]</a><span class="k">def</span> <span class="nf">GetPeopleStaticSCR</span> <span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetPeopleQuerySCR</span><span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

<span class="c">################</span>
<span class="c"># Time to review</span>
<span class="c">################</span>

<span class="c"># Real reviews spend &gt;1h, are not autoreviews, and bots are filtered out.</span></div>
<div class="viewcode-block" id="GetTimeToReviewQuerySCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetTimeToReviewQuerySCR">[docs]</a><span class="k">def</span> <span class="nf">GetTimeToReviewQuerySCR</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">bots</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="n">filter_bots</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">bot</span> <span class="ow">in</span> <span class="n">bots</span><span class="p">:</span>
        <span class="n">filter_bots</span> <span class="o">=</span> <span class="n">filter_bots</span> <span class="o">+</span> <span class="s">&quot; people.name&lt;&gt;&#39;&quot;</span><span class="o">+</span><span class="n">bot</span><span class="o">+</span><span class="s">&quot;&#39; and &quot;</span>

    <span class="c"># Subquery to get the time to review for all reviews</span>
    <span class="c"># fields = &quot;DATEDIFF(changed_on,submitted_on) AS revtime, changed_on &quot;</span>
    <span class="c"># fields = &quot;TIMEDIFF(changed_on,submitted_on)/(24*3600) AS revtime, changed_on &quot;</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;TIMESTAMPDIFF(SECOND, submitted_on, changed_on)/(24*3600) AS revtime, changed_on &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot;issues i, changes, people &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">tables</span> <span class="o">+</span> <span class="n">GetSQLReportFromSCR</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">filter_bots</span> <span class="o">+</span> <span class="s">&quot; i.id = changes.issue_id &quot;</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; AND people.id = changes.changed_by &quot;</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="n">GetSQLReportWhereSCR</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; AND field=&#39;status&#39; AND new_value=&#39;MERGED&#39; &quot;</span>
    <span class="c"># remove autoreviews</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; AND i.submitted_by&lt;&gt;changes.changed_by &quot;</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; ORDER BY changed_on &quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&#39;changed_on&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                    <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">min_days_for_review</span> <span class="o">=</span> <span class="mf">0.042</span> <span class="c"># one hour</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT revtime, changed_on FROM (&quot;</span><span class="o">+</span><span class="n">q</span><span class="o">+</span><span class="s">&quot;) qrevs WHERE revtime&gt;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">min_days_for_review</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span>

<span class="c"># Average can be calculate directly from SQL. But not used.</span></div>
<div class="viewcode-block" id="EvolTimeToReviewSCRsql"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolTimeToReviewSCRsql">[docs]</a><span class="k">def</span> <span class="nf">EvolTimeToReviewSCRsql</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetTimeToReviewQuerySCR</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="c"># Evolution in time of AVG review time</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;SUM(revtime)/COUNT(revtime) AS review_time_days_avg &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot;(&quot;</span><span class="o">+</span><span class="n">q</span><span class="o">+</span><span class="s">&quot;) t&quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="s">&#39;changed_on&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
            <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">)):</span> 
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">]]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c"># Average can be calculate directly from SQL. But not used.</span></div>
<div class="viewcode-block" id="StaticTimeToReviewSCRsql"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticTimeToReviewSCRsql">[docs]</a><span class="k">def</span> <span class="nf">StaticTimeToReviewSCRsql</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetTimeToReviewQuerySCR</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="c"># Total AVG review time</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot; SELECT AVG(revtime) AS review_time_days_avg FROM (&quot;</span><span class="o">+</span><span class="n">q</span><span class="o">+</span><span class="s">&quot;) t&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="StaticTimeToReviewSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.StaticTimeToReviewSCR">[docs]</a><span class="k">def</span> <span class="nf">StaticTimeToReviewSCR</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">bots</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">GetTimeToReviewQuerySCR</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">bots</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;revtime&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">):</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
    <span class="c"># ttr_median = sorted(data)[len(data)//2]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">ttr_median</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">&quot;nan&quot;</span><span class="p">)</span>
        <span class="n">ttr_avg</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">&quot;nan&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ttr_median</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">removeDecimals</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="n">ttr_avg</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="n">removeDecimals</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&quot;review_time_days_median&quot;</span><span class="p">:</span><span class="n">ttr_median</span><span class="p">,</span> <span class="s">&quot;review_time_days_avg&quot;</span><span class="p">:</span><span class="n">ttr_avg</span><span class="p">}</span>

</div>
<div class="viewcode-block" id="EvolTimeToReviewSCR"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.EvolTimeToReviewSCR">[docs]</a><span class="k">def</span> <span class="nf">EvolTimeToReviewSCR</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetTimeToReviewQuerySCR</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">review_list</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">checkListArray</span><span class="p">(</span><span class="n">review_list</span><span class="p">)</span>

    <span class="n">metrics_list</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;month&quot;</span><span class="p">:[],</span><span class="s">&quot;review_time_days_median&quot;</span><span class="p">:[],</span><span class="s">&quot;review_time_days_avg&quot;</span><span class="p">:[]}</span>
    <span class="c"># metrics_list = {&quot;month&quot;:[],&quot;review_time_days_median&quot;:[]}</span>
    <span class="n">review_list_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">review_list</span><span class="p">[</span><span class="s">&#39;changed_on&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">review_list</span><span class="p">[</span><span class="s">&#39;changed_on&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">metrics_list</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">review_list</span><span class="p">[</span><span class="s">&#39;changed_on&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">start_month</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">year</span><span class="o">*</span><span class="mi">12</span> <span class="o">+</span> <span class="n">start</span><span class="o">.</span><span class="n">month</span>
    <span class="c"># end = review_list[&#39;changed_on&#39;][review_list_len-1]</span>
    <span class="c"># end_month = end.year*12 + end.month</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">start_month</span>

    <span class="n">metrics_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">review_list_len</span><span class="p">):</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">review_list</span><span class="p">[</span><span class="s">&#39;changed_on&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="o">*</span><span class="mi">12</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">month</span><span class="p">:</span>
            <span class="n">metrics_list</span><span class="p">[</span><span class="s">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">review_list_len</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
                <span class="n">metrics_data</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="n">review_list</span><span class="p">[</span><span class="s">&#39;revtime&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="n">ttr_median</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;nan&#39;</span><span class="p">)</span>
                <span class="n">ttr_avg</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;nan&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">ttr_median</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">removeDecimals</span><span class="p">(</span><span class="n">metrics_data</span><span class="p">))</span>
                <span class="n">ttr_avg</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="n">removeDecimals</span><span class="p">(</span><span class="n">metrics_data</span><span class="p">))</span>
            <span class="c"># avg = sum(median) / float(len(median))</span>
            <span class="c"># metrics_list[&#39;review_time_avg&#39;].append(avg)</span>
            <span class="n">metrics_list</span><span class="p">[</span><span class="s">&#39;review_time_days_median&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ttr_median</span><span class="p">)</span>
            <span class="n">metrics_list</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ttr_avg</span><span class="p">)</span>
            <span class="n">metrics_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">review_list</span><span class="p">[</span><span class="s">&#39;revtime&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">month</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="o">*</span><span class="mi">12</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span>
        <span class="k">if</span>  <span class="n">i</span> <span class="o">==</span> <span class="n">review_list_len</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">month</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="o">*</span><span class="mi">12</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span>

            <span class="c"># Close last month also</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="o">*</span><span class="mi">12</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">month</span><span class="p">:</span>
                <span class="n">metrics_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">review_list</span><span class="p">[</span><span class="s">&#39;revtime&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="o">*</span><span class="mi">12</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="o">==</span> <span class="n">month</span><span class="p">:</span>
                <span class="n">metrics_data</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="n">review_list</span><span class="p">[</span><span class="s">&#39;revtime&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="n">metrics_list</span><span class="p">[</span><span class="s">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
            <span class="n">ttr_median</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">removeDecimals</span><span class="p">(</span><span class="n">metrics_data</span><span class="p">))</span>
            <span class="n">ttr_avg</span> <span class="o">=</span> <span class="n">average</span><span class="p">(</span><span class="n">removeDecimals</span><span class="p">(</span><span class="n">metrics_data</span><span class="p">))</span>
            <span class="n">metrics_list</span><span class="p">[</span><span class="s">&#39;review_time_days_median&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ttr_median</span><span class="p">)</span>
            <span class="n">metrics_list</span><span class="p">[</span><span class="s">&#39;review_time_days_avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ttr_avg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">metrics_data</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="n">review_list</span><span class="p">[</span><span class="s">&#39;revtime&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">metrics_list</span>

<span class="c">##############</span>
<span class="c"># Microstudies</span>
<span class="c">##############</span>
</div>
<div class="viewcode-block" id="GetSCRDiffSubmittedDays"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetSCRDiffSubmittedDays">[docs]</a><span class="k">def</span> <span class="nf">GetSCRDiffSubmittedDays</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">init_date</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span>
        <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="n">chardates</span> <span class="o">=</span> <span class="n">GetDates</span><span class="p">(</span><span class="n">init_date</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">StaticReviewsSubmitted</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;submitted&#39;</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">StaticReviewsSubmitted</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s">&#39;submitted&#39;</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;diff_netsubmitted_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">prev</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;percentage_submitted_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GetPercentageDiff</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;submitted_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetSCRDiffMergedDays"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetSCRDiffMergedDays">[docs]</a><span class="k">def</span> <span class="nf">GetSCRDiffMergedDays</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">init_date</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span>
        <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>

    <span class="n">chardates</span> <span class="o">=</span> <span class="n">GetDates</span><span class="p">(</span><span class="n">init_date</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">StaticReviewsMerged</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;merged&#39;</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">StaticReviewsMerged</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s">&#39;merged&#39;</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;diff_netmerged_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">prev</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;percentage_merged_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GetPercentageDiff</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;merged_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetSCRDiffAbandonedDays"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetSCRDiffAbandonedDays">[docs]</a><span class="k">def</span> <span class="nf">GetSCRDiffAbandonedDays</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">init_date</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span>
        <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>

    <span class="n">chardates</span> <span class="o">=</span> <span class="n">GetDates</span><span class="p">(</span><span class="n">init_date</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">StaticReviewsAbandoned</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;abandoned&#39;</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">StaticReviewsAbandoned</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s">&#39;abandoned&#39;</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;diff_netabandoned_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">prev</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;percentage_abandoned_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GetPercentageDiff</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;abandoned_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetSCRDiffPendingDays"><a class="viewcode-back" href="../../vizgrimoire.SCR.html#vizgrimoire.SCR.GetSCRDiffPendingDays">[docs]</a><span class="k">def</span> <span class="nf">GetSCRDiffPendingDays</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">init_date</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span>
        <span class="n">identities_db</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>

    <span class="n">chardates</span> <span class="o">=</span> <span class="n">GetDates</span><span class="p">(</span><span class="n">init_date</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">StaticReviewsPending</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;pending&#39;</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">StaticReviewsPending</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s">&#39;pending&#39;</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;diff_netpending_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">prev</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;percentage_pending_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GetPercentageDiff</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;pending_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">GrimoreLib 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Bitergia.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>