<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>vizgrimoire.SCM &mdash; GrimoreLib 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="GrimoreLib 1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">GrimoreLib 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for vizgrimoire.SCM</h1><div class="highlight"><pre>
<span class="c">## Copyright (C) 2012, 2013 Bitergia</span>
<span class="c">##</span>
<span class="c">## This program is free software; you can redistribute it and/or modify</span>
<span class="c">## it under the terms of the GNU General Public License as published by</span>
<span class="c">## the Free Software Foundation; either version 3 of the License, or</span>
<span class="c">## (at your option) any later version.</span>
<span class="c">##</span>
<span class="c">## This program is distributed in the hope that it will be useful,</span>
<span class="c">## but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c">## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="c">## GNU General Public License for more details. </span>
<span class="c">##</span>
<span class="c">## You should have received a copy of the GNU General Public License</span>
<span class="c">## along with this program; if not, write to the Free Software</span>
<span class="c">## Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
<span class="c">##</span>
<span class="c">## This file is a part of the vizGrimoire R package</span>
<span class="c">##  (an R library for the MetricsGrimoire and vizGrimoire systems)</span>
<span class="c">##</span>
<span class="c">## AuxiliarySCM.R</span>
<span class="c">##</span>
<span class="c">## Queries for SCM data analysis</span>
<span class="c">##</span>
<span class="c">## Authors:</span>
<span class="c">##   Jesus M. Gonzalez-Barahona &lt;jgb@bitergia.com&gt;</span>
<span class="c">##   Daniel Izquierdo &lt;dizquierdo@bitergia.com&gt;</span>
<span class="c">##   Alvaro del Castillo &lt;acs@bitergia.com&gt;</span>


<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">GrimoireSQL</span> <span class="kn">import</span> <span class="n">GetSQLGlobal</span><span class="p">,</span> <span class="n">GetSQLPeriod</span>
<span class="c"># TODO integrate: from GrimoireSQL import  GetSQLReportFrom </span>
<span class="kn">from</span> <span class="nn">GrimoireSQL</span> <span class="kn">import</span> <span class="n">GetSQLReportWhere</span><span class="p">,</span> <span class="n">ExecuteQuery</span><span class="p">,</span> <span class="n">BuildQuery</span>
<span class="kn">from</span> <span class="nn">GrimoireUtils</span> <span class="kn">import</span> <span class="n">GetPercentageDiff</span><span class="p">,</span> <span class="n">GetDates</span><span class="p">,</span> <span class="n">completePeriodIds</span>
<span class="kn">from</span> <span class="nn">GrimoireUtils</span> <span class="kn">import</span> <span class="n">createJSON</span><span class="p">,</span> <span class="n">getPeriod</span><span class="p">,</span> <span class="n">get_subprojects</span>
<span class="kn">from</span> <span class="nn">data_source</span> <span class="kn">import</span> <span class="n">DataSource</span>
<span class="kn">from</span> <span class="nn">filter</span> <span class="kn">import</span> <span class="n">Filter</span>

<div class="viewcode-block" id="SCM"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM">[docs]</a><span class="k">class</span> <span class="nc">SCM</span><span class="p">(</span><span class="n">DataSource</span><span class="p">):</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.get_db_name"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.get_db_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_db_name</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">&quot;db_cvsanaly&quot;</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.get_name"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">&quot;scm&quot;</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.get_evolutionary_data"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.get_evolutionary_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_evolutionary_data</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filter_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="s">&quot;&#39;&quot;</span><span class="o">+</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_item</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span><span class="p">]</span>
            <span class="n">evol_data</span> <span class="o">=</span> <span class="n">GetSCMEvolutionaryData</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> 
                                               <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">GetSCMEvolutionaryData</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">evol_data</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolCompanies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolCountries</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolDomains</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">evol_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">evol_data</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.create_evolutionary_report"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.create_evolutionary_report">[docs]</a>    <span class="k">def</span> <span class="nf">create_evolutionary_report</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">filter_</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span>  <span class="n">SCM</span><span class="o">.</span><span class="n">get_evolutionary_data</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">filter_</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">SCM</span><span class="p">()</span><span class="o">.</span><span class="n">get_evolutionary_filename</span><span class="p">()</span>
        <span class="n">createJSON</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.get_agg_data"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.get_agg_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_agg_data</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_</span><span class="o">=</span> <span class="bp">None</span><span class="p">):</span>


        <span class="k">if</span> <span class="p">(</span><span class="n">filter_</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">agg</span>  <span class="o">=</span> <span class="n">GetSCMStaticData</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_</span><span class="p">)</span>
            <span class="n">static_url</span> <span class="o">=</span> <span class="n">StaticURL</span><span class="p">()</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">static_url</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">evol_info_data_companies</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">evol_info_data_countries</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">evol_info_data_domains</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">GetCodeCommunityStructure</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="c"># Tendencies    </span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">365</span><span class="p">]:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">GetDiffCommitsDays</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">GetDiffAuthorsDays</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">GetDiffFilesDays</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">GetDiffLinesDays</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="c"># Last Activity: to be removed</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">365</span><span class="p">,</span><span class="mi">730</span><span class="p">]:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">last_activity</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="s">&quot;&#39;&quot;</span><span class="o">+</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_item</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span><span class="p">]</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">GetSCMStaticData</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="n">data</span>

        <span class="k">return</span> <span class="n">agg</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.create_agg_report"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.create_agg_report">[docs]</a>    <span class="k">def</span> <span class="nf">create_agg_report</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">filter_</span><span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">SCM</span><span class="o">.</span><span class="n">get_agg_data</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">filter_</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">SCM</span><span class="p">()</span><span class="o">.</span><span class="n">get_agg_filename</span><span class="p">()</span>
        <span class="n">createJSON</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.get_top_data"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.get_top_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_top_data</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">filter_</span><span class="p">,</span> <span class="n">npeople</span><span class="p">):</span>
        <span class="n">top</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">filter_</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">top</span><span class="p">[</span><span class="s">&#39;authors.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_people</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;author&quot;</span> <span class="p">,</span> <span class="s">&quot;&quot;</span> <span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
            <span class="n">top</span><span class="p">[</span><span class="s">&#39;authors.last month&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">top_people</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
            <span class="n">top</span><span class="p">[</span><span class="s">&#39;authors.last year&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">top_people</span><span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;company&quot;</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">company_top_authors</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="o">+</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_item</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">top</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.create_top_report"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.create_top_report">[docs]</a>    <span class="k">def</span> <span class="nf">create_top_report</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">npeople</span><span class="p">,</span> <span class="n">i_db</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">SCM</span><span class="o">.</span><span class="n">get_top_data</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
        <span class="n">createJSON</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">destdir</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">SCM</span><span class="p">()</span><span class="o">.</span><span class="n">get_top_filename</span><span class="p">())</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.get_filter_items"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.get_filter_items">[docs]</a>    <span class="k">def</span> <span class="nf">get_filter_items</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">filter_name</span> <span class="o">=</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span><span class="p">):</span>
            <span class="n">items</span>  <span class="o">=</span> <span class="n">repos_name</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;company&quot;</span><span class="p">):</span>
            <span class="n">items</span>  <span class="o">=</span> <span class="n">companies_name_wo_affs</span><span class="p">(</span><span class="n">bots</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;country&quot;</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">scm_countries_names</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;domain&quot;</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">scm_domains_names</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;project&quot;</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">scm_projects_name</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">filter_name</span> <span class="o">+</span> <span class="s">&quot; not supported&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.get_filter_summary"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.get_filter_summary">[docs]</a>    <span class="k">def</span> <span class="nf">get_filter_summary</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">filter_name</span> <span class="o">=</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;company&quot;</span><span class="p">):</span>
            <span class="n">summary</span> <span class="o">=</span>  <span class="n">GetCommitsSummaryCompanies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">summary</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.create_filter_report"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.create_filter_report">[docs]</a>    <span class="k">def</span> <span class="nf">create_filter_report</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">npeople</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">SCM</span><span class="o">.</span><span class="n">get_filter_items</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">items</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span> <span class="k">return</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>

        <span class="n">filter_name</span> <span class="o">=</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">)):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span><span class="p">]</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="n">SCM</span><span class="p">()))</span>
        <span class="n">createJSON</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filter_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;domain&quot;</span><span class="p">,</span> <span class="s">&quot;company&quot;</span><span class="p">,</span> <span class="s">&quot;repository&quot;</span><span class="p">):</span>
            <span class="n">items_list</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;commits_365&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;authors_365&#39;</span> <span class="p">:</span> <span class="p">[]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items_list</span> <span class="o">=</span> <span class="n">items</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span> <span class="p">:</span>
            <span class="n">item_name</span> <span class="o">=</span> <span class="s">&quot;&#39;&quot;</span><span class="o">+</span> <span class="n">item</span><span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="n">item_name</span><span class="p">)</span>
            <span class="n">filter_item</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="n">filter_name</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

            <span class="n">evol_data</span> <span class="o">=</span> <span class="n">SCM</span><span class="o">.</span><span class="n">get_evolutionary_data</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_item</span><span class="p">)</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filter_item</span><span class="o">.</span><span class="n">get_evolutionary_filename</span><span class="p">(</span><span class="n">SCM</span><span class="p">()))</span>
            <span class="n">createJSON</span><span class="p">(</span><span class="n">evol_data</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

            <span class="n">agg</span> <span class="o">=</span> <span class="n">SCM</span><span class="o">.</span><span class="n">get_agg_data</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_item</span><span class="p">)</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filter_item</span><span class="o">.</span><span class="n">get_static_filename</span><span class="p">(</span><span class="n">SCM</span><span class="p">()))</span>
            <span class="n">createJSON</span><span class="p">(</span><span class="n">agg</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">filter_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;domain&quot;</span><span class="p">,</span> <span class="s">&quot;company&quot;</span><span class="p">,</span> <span class="s">&quot;repository&quot;</span><span class="p">):</span>
                <span class="n">items_list</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">))</span>
                <span class="n">items_list</span><span class="p">[</span><span class="s">&#39;commits_365&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agg</span><span class="p">[</span><span class="s">&#39;commits_365&#39;</span><span class="p">])</span>
                <span class="n">items_list</span><span class="p">[</span><span class="s">&#39;authors_365&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agg</span><span class="p">[</span><span class="s">&#39;authors_365&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;company&quot;</span><span class="p">):</span>
                <span class="n">top_authors</span> <span class="o">=</span> <span class="n">SCM</span><span class="o">.</span><span class="n">get_top_data</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_item</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filter_item</span><span class="o">.</span><span class="n">get_top_filename</span><span class="p">(</span><span class="n">SCM</span><span class="p">()))</span>
                <span class="n">createJSON</span><span class="p">(</span><span class="n">top_authors</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

                <span class="c"># Old code not used. To be removed.</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2006</span><span class="p">,</span><span class="mi">2009</span><span class="p">,</span><span class="mi">2012</span><span class="p">]:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">company_top_authors_year</span><span class="p">(</span><span class="n">item_name</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
                    <span class="n">createJSON</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">destdir</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&quot;-&quot;</span><span class="o">+</span><span class="n">SCM</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;-top-authors_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;.json&quot;</span><span class="p">)</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="n">SCM</span><span class="p">()))</span>
        <span class="n">createJSON</span><span class="p">(</span><span class="n">items_list</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;company&quot;</span><span class="p">):</span>
            <span class="n">summary</span> <span class="o">=</span>  <span class="n">SCM</span><span class="o">.</span><span class="n">get_filter_summary</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">createJSON</span> <span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="n">destdir</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_summary_filename</span><span class="p">(</span><span class="n">SCM</span><span class="p">))</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.get_top_people"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.get_top_people">[docs]</a>    <span class="k">def</span> <span class="nf">get_top_people</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">npeople</span><span class="p">):</span>
        <span class="n">top_authors_data</span> <span class="o">=</span> <span class="n">SCM</span><span class="o">.</span><span class="n">get_top_data</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">top_authors_data</span><span class="p">[</span><span class="s">&#39;authors.&#39;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">top_authors_data</span><span class="p">[</span><span class="s">&#39;authors.last year&#39;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">top_authors_data</span><span class="p">[</span><span class="s">&#39;authors.last month&#39;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
        <span class="c"># remove duplicates</span>
        <span class="n">people</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">top</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">people</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.get_person_evol"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.get_person_evol">[docs]</a>    <span class="k">def</span> <span class="nf">get_person_evol</span><span class="p">(</span><span class="n">upeople_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
        <span class="n">evol_data</span> <span class="o">=</span> <span class="n">GetEvolPeopleSCM</span><span class="p">(</span><span class="n">upeople_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="n">evol_data</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">evol_data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">evol_data</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.get_person_agg"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.get_person_agg">[docs]</a>    <span class="k">def</span> <span class="nf">get_person_agg</span><span class="p">(</span><span class="n">upeople_id</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
        <span class="n">agg</span> <span class="o">=</span> <span class="n">GetStaticPeopleSCM</span><span class="p">(</span><span class="n">upeople_id</span><span class="p">,</span>  <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">agg</span>

    <span class="c"># Studies implemented in R</span></div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.create_r_reports"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.create_r_reports">[docs]</a>    <span class="k">def</span> <span class="nf">create_r_reports</span><span class="p">(</span><span class="n">vizr</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">):</span>
        <span class="n">unique_ids</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c"># Demographics</span>
        <span class="n">vizr</span><span class="o">.</span><span class="n">ReportDemographicsAgingSCM</span><span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">unique_ids</span><span class="p">)</span>
        <span class="n">vizr</span><span class="o">.</span><span class="n">ReportDemographicsBirthSCM</span><span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">unique_ids</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_remove_people</span><span class="p">(</span><span class="n">people_id</span><span class="p">):</span>
        <span class="c"># Remove from people</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM people_upeople WHERE people_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">people_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM people WHERE id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">people_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_remove_scmlog</span><span class="p">(</span><span class="n">scmlog_id</span><span class="p">):</span>
        <span class="c"># Get actions and remove mappings</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT * from actions where commit_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scmlog_id</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">action_id</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]:</span>
                <span class="c"># action_files is a view</span>
                <span class="c"># q = &quot;DELETE FROM action_files WHERE action_id=&#39;%s&#39;&quot; % (action_id)</span>
                <span class="c"># ExecuteQuery(q)</span>
                <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM file_copies WHERE action_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">action_id</span><span class="p">)</span>
                <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="c"># actions_file_names is a VIEW</span>
        <span class="c"># q = &quot;DELETE FROM actions_file_names WHERE commit_id=&#39;%s&#39;&quot; % (scmlog_id)</span>
        <span class="c"># ExecuteQuery(q)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM commits_lines WHERE commit_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scmlog_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM file_links WHERE commit_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scmlog_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT tag_id from tag_revisions WHERE commit_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scmlog_id</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tag_id</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;tag_id&#39;</span><span class="p">]:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM tags WHERE id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tag_id</span><span class="p">)</span>
            <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM tag_revisions WHERE tag_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tag_id</span><span class="p">)</span>
            <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM scmlog WHERE id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scmlog_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.remove_filter_data"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.remove_filter_data">[docs]</a>    <span class="k">def</span> <span class="nf">remove_filter_data</span><span class="p">(</span><span class="n">filter_</span><span class="p">):</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_item</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Removing SCM filter </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_item</span><span class="p">()))</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT * from repositories WHERE uri=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="n">repo</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">repo</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> not found&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">uri</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="c"># Remove people</span>
        <span class="k">def</span> <span class="nf">get_people_one_repo</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
            <span class="k">return</span>  <span class="s">&quot;&quot;&quot;</span>
<span class="s">                SELECT </span><span class="si">%s</span><span class="s"> FROM (SELECT COUNT(DISTINCT(repository_id)) AS total, </span><span class="si">%s</span><span class="s"></span>
<span class="s">                FROM scmlog</span>
<span class="s">                GROUP BY </span><span class="si">%s</span><span class="s"></span>
<span class="s">                HAVING total=1) t</span>
<span class="s">                &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
        <span class="c">## Remove committer_id that exists only in this repository</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">            SELECT DISTINCT(committer_id) from scmlog</span>
<span class="s">            WHERE repository_id=&#39;</span><span class="si">%s</span><span class="s">&#39; AND committer_id in (</span><span class="si">%s</span><span class="s">)</span>
<span class="s">        &quot;&quot;&quot;</span>  <span class="o">%</span> <span class="p">(</span><span class="n">repo</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span><span class="n">get_people_one_repo</span><span class="p">(</span><span class="s">&quot;committer_id&quot;</span><span class="p">))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">people_id</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;committer_id&#39;</span><span class="p">]:</span>
            <span class="n">SCM</span><span class="o">.</span><span class="n">_remove_people</span><span class="p">(</span><span class="n">people_id</span><span class="p">)</span>
        <span class="c">## Remove author_id that exists only in this repository</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">            SELECT DISTINCT(author_id) from scmlog</span>
<span class="s">            WHERE repository_id=&#39;</span><span class="si">%s</span><span class="s">&#39; AND author_id in (</span><span class="si">%s</span><span class="s">)</span>
<span class="s">        &quot;&quot;&quot;</span>  <span class="o">%</span> <span class="p">(</span><span class="n">repo</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span><span class="n">get_people_one_repo</span><span class="p">(</span><span class="s">&quot;author_id&quot;</span><span class="p">))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">people_id</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;author_id&#39;</span><span class="p">]:</span>
            <span class="n">SCM</span><span class="o">.</span><span class="n">_remove_people</span><span class="p">(</span><span class="n">people_id</span><span class="p">)</span>
        <span class="c"># Remove people activity</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT id from scmlog WHERE repository_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">repo</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">scmlog_id</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]:</span>
            <span class="n">SCM</span><span class="o">.</span><span class="n">_remove_scmlog</span><span class="p">(</span><span class="n">scmlog_id</span><span class="p">)</span>
        <span class="c"># Remove files</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT id FROM files WHERE repository_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">repo</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file_id</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM file_types WHERE file_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file_id</span><span class="p">)</span>
            <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM files WHERE id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">file_id</span><span class="p">)</span>
            <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="c"># Remove filter</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE from repositories WHERE id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">repo</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SCM.get_metrics_definition"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.SCM.get_metrics_definition">[docs]</a>    <span class="k">def</span> <span class="nf">get_metrics_definition</span> <span class="p">():</span>
        <span class="n">mdef</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;scm_commits&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scm_commits&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;commits&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Commits&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of commits (changes to source code), aggregating all branches&quot;</span><span class="p">,</span>
                <span class="s">&quot;envision&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s">&quot;y_labels&quot;</span> <span class="p">:</span> <span class="s">&quot;true&quot;</span><span class="p">,</span>
                    <span class="s">&quot;show_markers&quot;</span> <span class="p">:</span> <span class="s">&quot;true&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">&quot;scm_committers&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scm_committers&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;committers&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Committers&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of persons committing (merging changes to source code)&quot;</span><span class="p">,</span>
                <span class="s">&quot;action&quot;</span> <span class="p">:</span> <span class="s">&quot;commits&quot;</span><span class="p">,</span>
                <span class="s">&quot;envision&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s">&quot;gtype&quot;</span> <span class="p">:</span> <span class="s">&quot;whiskers&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">&quot;scm_authors&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scm_authors&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;authors&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Authors&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of persons authoring commits (changes to source code)&quot;</span><span class="p">,</span>
                <span class="s">&quot;action&quot;</span> <span class="p">:</span> <span class="s">&quot;commits&quot;</span><span class="p">,</span>
                <span class="s">&quot;envision&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s">&quot;gtype&quot;</span> <span class="p">:</span> <span class="s">&quot;whiskers&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">&quot;scm_branches&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scm_branches&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;branches&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Branches&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of active branches&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scm_files&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scm_files&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;files&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Files&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of files modified by at least one commit&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scm_added_lines&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scm_added_lines&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;added_lines&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Lines added&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Addition of lines added in all commits&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scm_removed_lines&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scm_removed_lines&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;removed_lines&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Lines removed&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Addition of lines removed in all commits&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scm_repositories&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scm_repositories&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;repositories&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Repositories&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Evolution of the number of source code repositories&quot;</span><span class="p">,</span>
                <span class="s">&quot;envision&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s">&quot;gtype&quot;</span> <span class="p">:</span> <span class="s">&quot;whiskers&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">&quot;scm_companies&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scm_companies&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;companies&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Organizations&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of organizations (companies, etc.) with persons active in changing code&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scm_countries&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scm_countries&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;countries&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Countries&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of countries with persons active in changing code&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scm_domains&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scm_domains&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;domains&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Domains&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of distinct domains with persons active in changing code&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;scm_people&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;scm_people&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;people&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Persons&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of persons active in changing code (authors, committers)&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">mdef</span>

<span class="c">##########</span>
<span class="c"># Meta-functions to automatically call metrics functions and merge them</span>
<span class="c">##########</span>

</div></div>
<div class="viewcode-block" id="GetSCMEvolutionaryData"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetSCMEvolutionaryData">[docs]</a><span class="k">def</span> <span class="nf">GetSCMEvolutionaryData</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># Meta function that includes basic evolutionary metrics from the source code</span>
    <span class="c"># management system. Those are merged and returned.</span>

    <span class="c"># 1- Retrieving information</span>
    <span class="n">commits</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">EvolCommits</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">),</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">EvolAuthors</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">),</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">committers</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">EvolCommitters</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">),</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">EvolFiles</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">),</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">EvolLines</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">),</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">branches</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">EvolBranches</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">),</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">repositories</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">EvolRepositories</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">),</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="c"># 2- Merging information</span>
    <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">commits</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">repositories</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">committers</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">authors</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">lines</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">branches</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">evol</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetSCMStaticData"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetSCMStaticData">[docs]</a><span class="k">def</span> <span class="nf">GetSCMStaticData</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># Meta function that includes basic aggregated metrics from the source code</span>
    <span class="c"># management system. Those are merged and returned.</span>

    <span class="c"># 1- Retrieving information</span>
    <span class="n">commits</span> <span class="o">=</span> <span class="n">StaticNumCommits</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">StaticNumAuthors</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">committers</span> <span class="o">=</span> <span class="n">StaticNumCommitters</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">StaticNumFiles</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">branches</span> <span class="o">=</span> <span class="n">StaticNumBranches</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">repositories</span> <span class="o">=</span> <span class="n">StaticNumRepositories</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="n">StaticNumActions</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">StaticNumLines</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">avg_commits_period</span> <span class="o">=</span> <span class="n">StaticAvgCommitsPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">avg_files_period</span> <span class="o">=</span> <span class="n">StaticAvgFilesPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">avg_commits_author</span> <span class="o">=</span> <span class="n">StaticAvgCommitsAuthor</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="c"># avg_authors_period = StaticAvgAuthorPeriod(period, startdate, enddate, i_db, type_analysis)</span>
    <span class="c"># avg_committer_period = StaticAvgCommitterPeriod(period, startdate, enddate, i_db, type_analysis)</span>
    <span class="n">avg_files_author</span> <span class="o">=</span> <span class="n">StaticAvgFilesAuthor</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>

    <span class="c"># Data from the last 365 days</span>
    <span class="n">fromdate</span> <span class="o">=</span> <span class="n">GetDates</span><span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="mi">365</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">commits_365</span> <span class="o">=</span> <span class="n">StaticNumCommits</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">authors_365</span> <span class="o">=</span> <span class="n">StaticNumAuthors</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>

    <span class="c"># 2- Merging information</span>
    <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">commits</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">repositories</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">committers</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">authors</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">actions</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">lines</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">branches</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">avg_commits_period</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">avg_files_period</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">avg_commits_author</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">avg_files_author</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">agg</span><span class="p">[</span><span class="s">&#39;commits_365&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">commits_365</span><span class="p">[</span><span class="s">&#39;commits&#39;</span><span class="p">]</span>
    <span class="n">agg</span><span class="p">[</span><span class="s">&#39;authors_365&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">authors_365</span><span class="p">[</span><span class="s">&#39;authors&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">agg</span><span class="p">)</span>

<span class="c">##########</span>
<span class="c"># Specific FROM and WHERE clauses per type of report</span>
<span class="c">##########</span></div>
<div class="viewcode-block" id="GetSQLRepositoriesFrom"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetSQLRepositoriesFrom">[docs]</a><span class="k">def</span> <span class="nf">GetSQLRepositoriesFrom</span> <span class="p">():</span>
    <span class="c">#tables necessaries for repositories</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot; , repositories r&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetSQLRepositoriesWhere"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetSQLRepositoriesWhere">[docs]</a><span class="k">def</span> <span class="nf">GetSQLRepositoriesWhere</span> <span class="p">(</span><span class="n">repository</span><span class="p">):</span>
    <span class="c">#fields necessaries to match info among tables</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot; and r.name =&quot;</span><span class="o">+</span> <span class="n">repository</span> <span class="o">+</span> \
            <span class="s">&quot; and r.id = s.repository_id&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetSQLProjectFrom"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetSQLProjectFrom">[docs]</a><span class="k">def</span> <span class="nf">GetSQLProjectFrom</span> <span class="p">():</span>
    <span class="c">#tables necessaries for repositories</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot; , repositories r&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetSQLProjectWhere"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetSQLProjectWhere">[docs]</a><span class="k">def</span> <span class="nf">GetSQLProjectWhere</span> <span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">):</span>
    <span class="c"># include all repositories for a project and its subprojects</span>
    <span class="c"># Remove &#39;&#39; from project name</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">project</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">project</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&#39;&quot;</span><span class="p">):</span>
        <span class="n">project</span> <span class="o">=</span> <span class="n">project</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">repos</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;and r.uri IN (</span>
<span class="s">           SELECT repository_name</span>
<span class="s">           FROM   </span><span class="si">%s</span><span class="s">.projects p, </span><span class="si">%s</span><span class="s">.project_repositories pr</span>
<span class="s">           WHERE  p.project_id = pr.project_id AND p.project_id IN (</span><span class="si">%s</span><span class="s">)</span>
<span class="s">            AND pr.data_source=&#39;scm&#39;</span>
<span class="s">    )&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">get_subprojects</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">repos</span>   <span class="o">+</span> <span class="s">&quot; and r.id = s.repository_id&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetSQLCompaniesFrom"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetSQLCompaniesFrom">[docs]</a><span class="k">def</span> <span class="nf">GetSQLCompaniesFrom</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">):</span>
    <span class="c">#tables necessaries for companies</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot; , &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup,&quot;</span><span class="o">+</span>\
                  <span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople_companies upc,&quot;</span><span class="o">+</span>\
                  <span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.companies c&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetSQLCompaniesWhere"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetSQLCompaniesWhere">[docs]</a><span class="k">def</span> <span class="nf">GetSQLCompaniesWhere</span> <span class="p">(</span><span class="n">company</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
    <span class="c">#fields necessaries to match info among tables</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot;and s.&quot;</span><span class="o">+</span><span class="n">role</span><span class="o">+</span><span class="s">&quot;_id = pup.people_id &quot;</span><span class="o">+</span>\
            <span class="s">&quot;  and pup.upeople_id = upc.upeople_id &quot;</span><span class="o">+</span>\
            <span class="s">&quot;  and s.date &gt;= upc.init &quot;</span><span class="o">+</span>\
            <span class="s">&quot;  and s.date &lt; upc.end &quot;</span><span class="o">+</span>\
            <span class="s">&quot;  and upc.company_id = c.id &quot;</span><span class="o">+</span>\
            <span class="s">&quot;  and c.name =&quot;</span> <span class="o">+</span> <span class="n">company</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetSQLCountriesFrom"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetSQLCountriesFrom">[docs]</a><span class="k">def</span> <span class="nf">GetSQLCountriesFrom</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">):</span>
    <span class="c">#tables necessaries for companies</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot; , &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup, &quot;</span><span class="o">+</span>\
                  <span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople_countries upc, &quot;</span><span class="o">+</span>\
                  <span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.countries c&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetSQLCountriesWhere"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetSQLCountriesWhere">[docs]</a><span class="k">def</span> <span class="nf">GetSQLCountriesWhere</span> <span class="p">(</span><span class="n">country</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
    <span class="c">#fields necessaries to match info among tables</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot;and s.&quot;</span><span class="o">+</span><span class="n">role</span><span class="o">+</span><span class="s">&quot;_id = pup.people_id &quot;</span><span class="o">+</span>\
                  <span class="s">&quot;and pup.upeople_id = upc.upeople_id &quot;</span><span class="o">+</span>\
                  <span class="s">&quot;and upc.country_id = c.id &quot;</span><span class="o">+</span>\
                  <span class="s">&quot;and c.name =&quot;</span><span class="o">+</span> <span class="n">country</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetSQLDomainsFrom"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetSQLDomainsFrom">[docs]</a><span class="k">def</span> <span class="nf">GetSQLDomainsFrom</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">)</span> <span class="p">:</span>
    <span class="c">#tables necessaries for domains</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot; , &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup, &quot;</span><span class="o">+</span>\
                <span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople_domains upd, &quot;</span><span class="o">+</span>\
                <span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.domains d&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetSQLDomainsWhere"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetSQLDomainsWhere">[docs]</a><span class="k">def</span> <span class="nf">GetSQLDomainsWhere</span> <span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span> <span class="p">:</span>
    <span class="c">#fields necessaries to match info among tables</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot;and s.&quot;</span><span class="o">+</span><span class="n">role</span><span class="o">+</span><span class="s">&quot;_id = pup.people_id &quot;</span><span class="o">+</span>\
            <span class="s">&quot;and pup.upeople_id = upd.upeople_id &quot;</span><span class="o">+</span>\
            <span class="s">&quot;and upd.domain_id = d.id &quot;</span><span class="o">+</span>\
            <span class="s">&quot;and d.name =&quot;</span><span class="o">+</span> <span class="n">domain</span><span class="p">)</span>


<span class="c">##########</span>
<span class="c">#Generic functions to obtain FROM and WHERE clauses per type of report</span>
<span class="c">##########</span>

<span class="c"># TODO: Use a SCM specific name</span></div>
<div class="viewcode-block" id="GetSQLReportFrom"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetSQLReportFrom">[docs]</a><span class="k">def</span> <span class="nf">GetSQLReportFrom</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c">#generic function to generate &#39;from&#39; clauses</span>
    <span class="c">#&quot;type&quot; is a list of two values: type of analysis and value of </span>
    <span class="c">#such analysis</span>

    <span class="n">From</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">type_analysis</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span> <span class="k">return</span> <span class="n">From</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c"># value = type_analysis[1]</span>

    <span class="k">if</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;repository&#39;</span><span class="p">:</span> <span class="n">From</span> <span class="o">=</span> <span class="n">GetSQLRepositoriesFrom</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;company&#39;</span><span class="p">:</span> <span class="n">From</span> <span class="o">=</span> <span class="n">GetSQLCompaniesFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;country&#39;</span><span class="p">:</span> <span class="n">From</span> <span class="o">=</span> <span class="n">GetSQLCountriesFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;domain&#39;</span><span class="p">:</span> <span class="n">From</span> <span class="o">=</span> <span class="n">GetSQLDomainsFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;project&#39;</span><span class="p">:</span> <span class="n">From</span> <span class="o">=</span> <span class="n">GetSQLProjectFrom</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">From</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetSQLReportWhere"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetSQLReportWhere">[docs]</a><span class="k">def</span> <span class="nf">GetSQLReportWhere</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">identities_db</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="c">#generic function to generate &#39;where&#39; clauses</span>

    <span class="c">#&quot;type&quot; is a list of two values: type of analysis and value of </span>
    <span class="c">#such analysis</span>

    <span class="n">where</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">type_analysis</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span> <span class="k">return</span> <span class="n">where</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;repository&#39;</span><span class="p">:</span> <span class="n">where</span> <span class="o">=</span> <span class="n">GetSQLRepositoriesWhere</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;company&#39;</span><span class="p">:</span> <span class="n">where</span> <span class="o">=</span> <span class="n">GetSQLCompaniesWhere</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;country&#39;</span><span class="p">:</span> <span class="n">where</span> <span class="o">=</span> <span class="n">GetSQLCountriesWhere</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;domain&#39;</span><span class="p">:</span> <span class="n">where</span> <span class="o">=</span> <span class="n">GetSQLDomainsWhere</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;project&#39;</span><span class="p">:</span> <span class="n">where</span> <span class="o">=</span> <span class="n">GetSQLProjectWhere</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">where</span><span class="p">)</span>

<span class="c">##----------------------</span>
<span class="c">## Auxiliary functions querying the database</span>
<span class="c">##----------------------</span>
</div>
<div class="viewcode-block" id="get_timespan"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.get_timespan">[docs]</a><span class="k">def</span> <span class="nf">get_timespan</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get timespan found in the SCM database.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    startdate : datetime.datetime</span>
<span class="sd">        Time of first commit</span>
<span class="sd">    enddate : datetime.datetime</span>
<span class="sd">        Time of last commit</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    Just looks for first and last date in scmlog.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;SELECT DATE(MIN(date)) as startdate,</span>
<span class="s">                  DATE(MAX(date)) as enddate FROM scmlog&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;startdate&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;enddate&#39;</span><span class="p">])</span>

<span class="c">#########</span>
<span class="c">#Functions to obtain info per type of basic piece of data</span>
<span class="c">#########</span>

<span class="c"># All of the EvolXXX or StaticXXX contains the same parameters:</span>
<span class="c">#    period:</span>
<span class="c">#    startdate:</span>
<span class="c">#    enddate:</span>
<span class="c">#    identities_db: MySQL database name</span>
<span class="c">#    type_analysis: tuple with two values: typeof and value</span>
<span class="c">#                   typeof = &#39;companies&#39;, &#39;countries&#39;, &#39;repositories&#39; or &#39;&#39;</span>
<span class="c">#                   value = any value that corresponds with the type of analysis</span>
</div>
<div class="viewcode-block" id="GetCommits"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetCommits">[docs]</a><span class="k">def</span> <span class="nf">GetCommits</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># This function contains basic parts of the query to count commits.</span>
    <span class="c"># That query is built and results returned.</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(s.id)) as commits &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; scmlog s, actions a &quot;</span> <span class="o">+</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; and s.id=a.commit_id &quot;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; s.date &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolCommits"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.EvolCommits">[docs]</a><span class="k">def</span> <span class="nf">EvolCommits</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># Returns the evolution of commits through the time</span>

    <span class="k">return</span><span class="p">(</span><span class="n">GetCommits</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>


<span class="c">#StaticNumCommits (period, startdate, enddate, identities_db, type_analysis):</span>
<span class="c">#    return(GetCommits(period, startdate, enddate, identities_db, type_analysis, False))</span>
<span class="c">#</span>

</div>
<div class="viewcode-block" id="GetAuthors"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetAuthors">[docs]</a><span class="k">def</span> <span class="nf">GetAuthors</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># This function contains basic parts of the query to count authors</span>
    <span class="c"># That query is later built and executed</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(pup.upeople_id)) AS authors &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; scmlog s &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#specific parts of the query depending on the report needed</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">type_analysis</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
        <span class="c">#Specific case for the basic option where people_upeople table is needed</span>
        <span class="c">#and not taken into account in the initial part of the query</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;,  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and s.author_id = pup.people_id&quot;</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span> <span class="ow">or</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;project&quot;</span><span class="p">):</span>
        <span class="c">#Adding people_upeople table</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;,  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and s.author_id = pup.people_id &quot;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; s.date &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolAuthors"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.EvolAuthors">[docs]</a><span class="k">def</span> <span class="nf">EvolAuthors</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the evolution of authors through the time</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetAuthors</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticNumAuthors"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticNumAuthors">[docs]</a><span class="k">def</span> <span class="nf">StaticNumAuthors</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the aggregated number of authors in the specified timeperiod (enddate - startdate)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetAuthors</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GetDiffAuthorsDays"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetDiffAuthorsDays">[docs]</a><span class="k">def</span> <span class="nf">GetDiffAuthorsDays</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">days</span><span class="p">):</span>
    <span class="c"># This function provides the percentage in activity between two periods:</span>
    <span class="n">chardates</span> <span class="o">=</span> <span class="n">GetDates</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">StaticNumAuthors</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;authors&#39;</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">StaticNumAuthors</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s">&#39;authors&#39;</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;diff_netauthors_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">prev</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;percentage_authors_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GetPercentageDiff</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
    <span class="c"># data[&#39;authors_&#39;+str(days)] = last</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetCommitters"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetCommitters">[docs]</a><span class="k">def</span> <span class="nf">GetCommitters</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># This function contains basic parts of the query to count committers</span>
    <span class="c"># That query is later built and executed</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&#39;count(distinct(pup.upeople_id)) AS committers &#39;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot;scmlog s &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;committer&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#specific parts of the query depending on the report needed</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">type_analysis</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
        <span class="c">#Specific case for the basic option where people_upeople table is needed</span>
        <span class="c">#and not taken into account in the initial part of the query</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot; ,  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup &quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and s.committer_id = pup.people_id&quot;</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span> <span class="ow">or</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;project&quot;</span><span class="p">):</span>
        <span class="c">#Adding people_upeople table</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;,  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and s.committer_id = pup.people_id &quot;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; s.date &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolCommitters"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.EvolCommitters">[docs]</a><span class="k">def</span> <span class="nf">EvolCommitters</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the evolution of the number of committers through the time</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetCommitters</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticNumCommitters"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticNumCommitters">[docs]</a><span class="k">def</span> <span class="nf">StaticNumCommitters</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the aggregate number of committers in the specified timeperiod (enddate - startdate)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetCommitters</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>


</div>
<div class="viewcode-block" id="GetFiles"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetFiles">[docs]</a><span class="k">def</span> <span class="nf">GetFiles</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># This function contains basic parts of the query to count files</span>
    <span class="c"># That query is later built and executed</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(a.file_id)) as files &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; scmlog s, actions a &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; a.commit_id = s.id &quot;</span>

    <span class="c">#specific parts of the query depending on the report needed</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="c">#TODO: left &quot;author&quot; as generic option coming from parameters (this should be specified by command line)</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#executing the query</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; s.date &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolFiles"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.EvolFiles">[docs]</a><span class="k">def</span> <span class="nf">EvolFiles</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the evolution of the number of files through the time</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetFiles</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticNumFiles"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticNumFiles">[docs]</a><span class="k">def</span> <span class="nf">StaticNumFiles</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the aggregate number of unique files in the specified timeperiod (enddate - startdate)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetFiles</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GetDiffFilesDays"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetDiffFilesDays">[docs]</a><span class="k">def</span> <span class="nf">GetDiffFilesDays</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">days</span><span class="p">):</span>
    <span class="c"># This function provides the percentage in activity between two periods:</span>
    <span class="n">chardates</span> <span class="o">=</span> <span class="n">GetDates</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">StaticNumFiles</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;files&#39;</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">StaticNumFiles</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s">&#39;files&#39;</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;diff_netfiles_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">prev</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;percentage_files_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GetPercentageDiff</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
    <span class="c"># data[&#39;files_&#39;+str(days)] = last</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetLines"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetLines">[docs]</a><span class="k">def</span> <span class="nf">GetLines</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># This function contains basic parts of the query to count lines</span>
    <span class="c"># That query is later built and executed</span>

    <span class="c"># basic parts of the query</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;sum(cl.added) as added_lines, sum(cl.removed) as removed_lines&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot;scmlog s, commits_lines cl &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot;cl.commit_id = s.id &quot;</span>

    <span class="c"># specific parts of the query depending on the report needed</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="c">#TODO: left &quot;author&quot; as generic option coming from parameters (this should be specified by command line)</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#executing the query</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; s.date &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;removed_lines&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">)):</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;removed_lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;removed_lines&#39;</span><span class="p">]]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;added_lines&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">)):</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;added_lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;added_lines&#39;</span><span class="p">]]</span>

    <span class="n">data</span><span class="p">[</span><span class="s">&#39;removed_lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>  <span class="k">for</span> <span class="n">lines</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;removed_lines&#39;</span><span class="p">]]</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;added_lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>  <span class="k">for</span> <span class="n">lines</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;added_lines&#39;</span><span class="p">]]</span>
    <span class="c"># TODO: not used so we don&#39;t need it - acs</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;negative_removed_lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">removed</span><span class="p">)</span> <span class="k">for</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;removed_lines&#39;</span><span class="p">]]</span>
    <span class="c"># data$negative_removed_lines = -data$removed_lines</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="EvolLines"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.EvolLines">[docs]</a><span class="k">def</span> <span class="nf">EvolLines</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># returns the evolution of the number of lines through the time</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetLines</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>


<span class="c"># TODO: two version of this funcion. Unify.</span></div>
<div class="viewcode-block" id="StaticNumLines2"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticNumLines2">[docs]</a><span class="k">def</span> <span class="nf">StaticNumLines2</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the aggregate number of lines in the specified timeperiod (enddate - startdate)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetLines</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="GetDiffLinesDays"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetDiffLinesDays">[docs]</a><span class="k">def</span> <span class="nf">GetDiffLinesDays</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">days</span><span class="p">):</span>
    <span class="c"># This function provides the percentage in activity between two periods:</span>
    <span class="n">chardates</span> <span class="o">=</span> <span class="n">GetDates</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">StaticNumLines</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">last_added</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;added_lines&#39;</span><span class="p">])</span>
    <span class="n">last_removed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;removed_lines&#39;</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">StaticNumLines</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">prev_added</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s">&#39;added_lines&#39;</span><span class="p">])</span>
    <span class="n">prev_removed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s">&#39;removed_lines&#39;</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;diff_netadded_lines_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last_added</span> <span class="o">-</span> <span class="n">prev_added</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;percentage_added_lines_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GetPercentageDiff</span><span class="p">(</span><span class="n">prev_added</span><span class="p">,</span> <span class="n">last_added</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;diff_netremoved_lines_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last_removed</span> <span class="o">-</span> <span class="n">prev_removed</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;percentage_removed_lines_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GetPercentageDiff</span><span class="p">(</span><span class="n">prev_removed</span><span class="p">,</span> <span class="n">last_removed</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetBranches"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetBranches">[docs]</a><span class="k">def</span> <span class="nf">GetBranches</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># This function contains basic parts of the query to count branches</span>
    <span class="c"># That query is later built and executed</span>

    <span class="c"># basic parts of the query</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;count(distinct(a.branch_id)) as branches &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; scmlog s, actions a &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; a.commit_id = s.id &quot;</span>

    <span class="c"># specific parts of the query depending on the report needed</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="c">#TODO: left &quot;author&quot; as generic option coming from parameters (this should be specified by command line)</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#executing the query</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; s.date &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolBranches"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.EvolBranches">[docs]</a><span class="k">def</span> <span class="nf">EvolBranches</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the evolution of the number of branches through the time</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetBranches</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticNumBranches"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticNumBranches">[docs]</a><span class="k">def</span> <span class="nf">StaticNumBranches</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the aggregate number of branches in the specified timeperiod (enddate - startdate)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetBranches</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GetRepositories"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetRepositories">[docs]</a><span class="k">def</span> <span class="nf">GetRepositories</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># This function contains basic parts of the query to count repositories</span>
    <span class="c"># That query is later built and executed</span>

    <span class="c"># basic parts of the query</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;count(distinct(s.repository_id)) AS repositories &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot;scmlog s &quot;</span>

    <span class="c"># specific parts of the query depending on the report needed</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="c">#TODO: left &quot;author&quot; as generic option coming from parameters (this should be specified by command line)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#executing the query</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; s.date &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolRepositories"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.EvolRepositories">[docs]</a><span class="k">def</span> <span class="nf">EvolRepositories</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the evolution of the number of repositories through the time</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetRepositories</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticNumRepositories"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticNumRepositories">[docs]</a><span class="k">def</span> <span class="nf">StaticNumRepositories</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the aggregate number of repositories in the specified timeperiod (enddate - startdate)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetRepositories</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticNumCommits"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticNumCommits">[docs]</a><span class="k">def</span> <span class="nf">StaticNumCommits</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># returns the aggregate number of commits in the specified timeperiod (enddate - startdate)</span>
    <span class="c"># TODO: this function is deprecated, but the new one is not ready yet. This should directly call</span>
    <span class="c">#       GetCommits as similarly done by EvolCommits function.</span>

    <span class="c">#TODO: first_date and last_date should be in another function</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;SELECT count(distinct(s.id)) as commits, &quot;</span><span class="o">+</span>\
             <span class="s">&quot;DATE_FORMAT (min(s.date), &#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;) as first_date, &quot;</span><span class="o">+</span>\
             <span class="s">&quot;DATE_FORMAT (max(s.date), &#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;) as last_date &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; FROM scmlog s, actions a &quot;</span> 
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; where s.date &gt;=&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
            <span class="s">&quot; s.date &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
            <span class="s">&quot; s.id = a.commit_id &quot;</span>

    <span class="c"># specific parts of the query depending on the report needed</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="c">#TODO: left &quot;author&quot; as generic option coming from parameters (this should be specified by command line)</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#executing the query</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">fields</span> <span class="o">+</span> <span class="n">tables</span> <span class="o">+</span> <span class="n">filters</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GetDiffCommitsDays"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetDiffCommitsDays">[docs]</a><span class="k">def</span> <span class="nf">GetDiffCommitsDays</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">days</span><span class="p">):</span>
    <span class="c"># This function provides the percentage in activity between two periods:</span>

    <span class="n">chardates</span> <span class="o">=</span> <span class="n">GetDates</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">StaticNumCommits</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;commits&#39;</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">StaticNumCommits</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s">&#39;commits&#39;</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;diff_netcommits_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">prev</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;percentage_commits_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GetPercentageDiff</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
    <span class="c"># data[&#39;commits_&#39;+str(days)] = last</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetActions"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetActions">[docs]</a><span class="k">def</span> <span class="nf">GetActions</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># This function contains basic parts of the query to count actions.</span>
    <span class="c"># An action is any type of change done in a file (addition, copy, removal, etc)</span>
    <span class="c"># That query is later built and executed</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(a.id)) as actions &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; scmlog s, actions a &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; a.commit_id = s.id &quot;</span>

    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; s.date &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolActions"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.EvolActions">[docs]</a><span class="k">def</span> <span class="nf">EvolActions</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the evolution of the number of actions through the time</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetActions</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticNumActions"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticNumActions">[docs]</a><span class="k">def</span> <span class="nf">StaticNumActions</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># returns the aggregate number of actions in the specified timeperiod (enddate - startdate)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetActions</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticNumLines"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticNumLines">[docs]</a><span class="k">def</span> <span class="nf">StaticNumLines</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># returns the aggregate number of repositories in the specified timeperiod (enddate - startdate)</span>
    <span class="c"># TODO: this function is deprecated, this should call GetLines</span>

    <span class="n">select</span> <span class="o">=</span> <span class="s">&quot;select sum(cl.added) as added_lines, &quot;</span><span class="o">+</span>\
             <span class="s">&quot;sum(cl.removed) as removed_lines &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; FROM scmlog s, commits_lines cl &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; where s.date &gt;=&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
              <span class="s">&quot; s.date &lt; &quot;</span><span class="o">+</span><span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
              <span class="s">&quot; cl.commit_id = s.id &quot;</span>

    <span class="c"># specific parts of the query depending on the report needed</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="c">#TODO: left &quot;author&quot; as generic option coming from parameters (this should be specified by command line)</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#executing the query</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">select</span> <span class="o">+</span> <span class="n">tables</span> <span class="o">+</span> <span class="n">filters</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;added_lines&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;added_lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;removed_lines&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;removed_lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetAvgCommitsPeriod"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetAvgCommitsPeriod">[docs]</a><span class="k">def</span> <span class="nf">GetAvgCommitsPeriod</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># returns the average number of commits per period of time (day, week, month, etc...) </span>
    <span class="c"># in the specified timeperiod (enddate - startdate)</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(s.id))/timestampdiff(&quot;</span><span class="o">+</span><span class="n">period</span><span class="o">+</span><span class="s">&quot;,min(s.date),max(s.date)) as avg_commits_&quot;</span><span class="o">+</span><span class="n">period</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; scmlog s, actions a &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; s.id = a.commit_id &quot;</span>

    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; s.date &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>


<span class="c">#EvolAvgCommitsPeriod (period, startdate, enddate, identities_db, type_analysis) :</span>
<span class="c">#WARNING: This function should provide same information as EvolCommits, do not use this.</span>
<span class="c">#    return (GetAvgCommitsPeriod(period, startdate, enddate, identities_db, type_analysis, True))</span>
<span class="c">#</span>
</div>
<div class="viewcode-block" id="StaticAvgCommitsPeriod"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticAvgCommitsPeriod">[docs]</a><span class="k">def</span> <span class="nf">StaticAvgCommitsPeriod</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># returns the average number of commits per period (weekly, monthly, etc) in the specified timeperiod (enddate - startdate)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetAvgCommitsPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>


</div>
<div class="viewcode-block" id="GetAvgFilesPeriod"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetAvgFilesPeriod">[docs]</a><span class="k">def</span> <span class="nf">GetAvgFilesPeriod</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># returns the average number of files per period (Weekly, monthly, etc) in the specified</span>
    <span class="c"># time period (enddate - startdate) </span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(a.file_id))/timestampdiff(&quot;</span><span class="o">+</span><span class="n">period</span><span class="o">+</span><span class="s">&quot;,min(s.date),max(s.date)) as avg_files_&quot;</span><span class="o">+</span><span class="n">period</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; scmlog s, actions a &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; s.id = a.commit_id &quot;</span>

    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; s.date &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>


<span class="c">#EvolAvgFilesPeriod (period, startdate, enddate, identities_db, type_analysis):</span>
<span class="c">#WARNING: this function should return same info as EvolFiles, do not use this</span>
<span class="c">#    return (GetAvgFilesPeriod(period, startdate, enddate, identities_db, type_analysis, True))</span>
<span class="c">#</span>
</div>
<div class="viewcode-block" id="StaticAvgFilesPeriod"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticAvgFilesPeriod">[docs]</a><span class="k">def</span> <span class="nf">StaticAvgFilesPeriod</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the average number of files per period (Weekly, monthly, etc) in the specified</span>
    <span class="c"># time period (enddate - startdate)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetAvgFilesPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="GetAvgCommitsAuthor"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetAvgCommitsAuthor">[docs]</a><span class="k">def</span> <span class="nf">GetAvgCommitsAuthor</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># returns the average number of commits per author in the specified</span>
    <span class="c"># time period (enddate - startdate)</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(s.id))/count(distinct(pup.upeople_id)) as avg_commits_author &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; scmlog s, actions a &quot;</span> 
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; s.id = a.commit_id &quot;</span> 

    <span class="n">filters</span> <span class="o">+=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#specific parts of the query depending on the report needed</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">type_analysis</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
        <span class="c">#Specific case for the basic option where people_upeople table is needed</span>
        <span class="c">#and not taken into account in the initial part of the query</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;,  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and s.author_id = pup.people_id&quot;</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span> <span class="ow">or</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;project&quot;</span><span class="p">):</span>
        <span class="c">#Adding people_upeople table</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;,  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and s.author_id = pup.people_id &quot;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; s.date &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolAvgCommitsAuthor"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.EvolAvgCommitsAuthor">[docs]</a><span class="k">def</span> <span class="nf">EvolAvgCommitsAuthor</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the average number of commits per author in the specified</span>
    <span class="c"># time period (enddate - startdate)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetAvgCommitsAuthor</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="StaticAvgCommitsAuthor"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticAvgCommitsAuthor">[docs]</a><span class="k">def</span> <span class="nf">StaticAvgCommitsAuthor</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the average and total number of commits per author in the specified</span>
    <span class="c"># time period (enddate - startdate)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetAvgCommitsAuthor</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>


</div>
<div class="viewcode-block" id="GetAvgAuthorPeriod"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetAvgAuthorPeriod">[docs]</a><span class="k">def</span> <span class="nf">GetAvgAuthorPeriod</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># returns the average number of authors per period (weekly, monthly) in the specified</span>
    <span class="c"># time period (enddate - startdate)</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(pup.upeople_id))/timestampdiff(&quot;</span><span class="o">+</span><span class="n">period</span><span class="o">+</span><span class="s">&quot;,min(s.date),max(s.date)) as avg_authors_&quot;</span><span class="o">+</span><span class="n">period</span> 
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; scmlog s &quot;</span>
    <span class="c"># filters = &quot;&quot;</span>

    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#specific parts of the query depending on the report needed</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">type_analysis</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
        <span class="c">#Specific case for the basic option where people_upeople table is needed</span>
        <span class="c">#and not taken into account in the initial part of the query</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;,  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and s.author_id = pup.people_id&quot;</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span> <span class="ow">or</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;project&quot;</span><span class="p">):</span>
        <span class="c">#Adding people_upeople table</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;,  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and s.author_id = pup.people_id &quot;</span>


    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; s.date &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>


<span class="c">#EvolAvgAuthorPeriod (period, startdate, enddate, identities_db, type_analysis):</span>
<span class="c">#WARNING: this function should return same information as EvolAuthors, do not use this</span>
<span class="c">#    return (GetAvgAuthorPeriod(period, startdate, enddate, identities_db, type_analysis, True))</span>
<span class="c">#</span>
</div>
<div class="viewcode-block" id="StaticAvgAuthorPeriod"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticAvgAuthorPeriod">[docs]</a><span class="k">def</span> <span class="nf">StaticAvgAuthorPeriod</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the average number of authors per period (weekly, monthly) in the specified</span>
    <span class="c"># time period (enddate - startdate)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">GetAvgAuthorPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="GetAvgCommitterPeriod"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetAvgCommitterPeriod">[docs]</a><span class="k">def</span> <span class="nf">GetAvgCommitterPeriod</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># returns the average number of committers per period (weekly, monthly) in the specified</span>
    <span class="c"># time period (enddate - startdate)</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(pup.upeople_id))/timestampdiff(&quot;</span><span class="o">+</span><span class="n">period</span><span class="o">+</span><span class="s">&quot;,min(s.date),max(s.date)) as avg_authors_&quot;</span><span class="o">+</span><span class="n">period</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; scmlog s &quot;</span>
    <span class="c"># filters = &quot;&quot;</span>

    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;committer&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#specific parts of the query depending on the report needed</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">type_analysis</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
        <span class="c">#Specific case for the basic option where people_upeople table is needed</span>
        <span class="c">#and not taken into account in the initial part of the query</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;,  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and s.committer_id = pup.people_id&quot;</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span> <span class="ow">or</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;project&quot;</span><span class="p">):</span>
        <span class="c">#Adding people_upeople table</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;,  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and s.committer_id = pup.people_id &quot;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; s.date &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>


<span class="c">#EvolAvgCommitterPeriod (period, startdate, enddate, identities_db, type_analysis):</span>
<span class="c">#WARNING: this function should return same info as EvolCommitters, do not use this</span>
<span class="c">#    return (GetAvgCommitterPeriod(period, startdate, enddate, identities_db, type_analysis, True))</span>
<span class="c">#</span>
</div>
<div class="viewcode-block" id="StaticAvgCommitterPeriod"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticAvgCommitterPeriod">[docs]</a><span class="k">def</span> <span class="nf">StaticAvgCommitterPeriod</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># returns the average number of committers per period (weekly, monthly) in the specified</span>
    <span class="c"># time period (enddate - startdate)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">GetAvgCommitterPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>


</div>
<div class="viewcode-block" id="GetAvgFilesAuthor"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetAvgFilesAuthor">[docs]</a><span class="k">def</span> <span class="nf">GetAvgFilesAuthor</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># returns the average number of files per author (weekly, monthly) in the specified</span>
    <span class="c"># time period (enddate - startdate)    </span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(a.file_id))/count(distinct(pup.upeople_id)) as avg_files_author &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; scmlog s, actions a &quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; s.id = a.commit_id &quot;</span>

    <span class="n">filters</span> <span class="o">+=</span> <span class="n">GetSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#specific parts of the query depending on the report needed</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="n">GetSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">type_analysis</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
        <span class="c">#Specific case for the basic option where people_upeople table is needed</span>
        <span class="c">#and not taken into account in the initial part of the query</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;,  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and s.author_id = pup.people_id&quot;</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span> <span class="ow">or</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;project&quot;</span><span class="p">):</span>
        <span class="c">#Adding people_upeople table</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;,  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and s.author_id = pup.people_id &quot;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; s.date &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>


    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolAvgFilesAuthor"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.EvolAvgFilesAuthor">[docs]</a><span class="k">def</span> <span class="nf">EvolAvgFilesAuthor</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># returns the average number of files per author and its evolution (weekly, monthly) in the specified</span>
    <span class="c"># time period (enddate - startdate)  </span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetAvgFilesAuthor</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="StaticAvgFilesAuthor"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticAvgFilesAuthor">[docs]</a><span class="k">def</span> <span class="nf">StaticAvgFilesAuthor</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># returns the average number of files per author (weekly, monthly) in the specified</span>
    <span class="c"># time period (enddate - startdate)  </span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetAvgFilesAuthor</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="StaticURL"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.StaticURL">[docs]</a><span class="k">def</span> <span class="nf">StaticURL</span> <span class="p">()</span> <span class="p">:</span>
    <span class="c"># Returns the SCM URL     </span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select uri as url,type from repositories limit 1&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

<span class="c">#</span>
<span class="c"># People</span>
<span class="c">#</span>
</div>
<div class="viewcode-block" id="GetTablesOwnUniqueIdsSCM"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetTablesOwnUniqueIdsSCM">[docs]</a><span class="k">def</span> <span class="nf">GetTablesOwnUniqueIdsSCM</span> <span class="p">()</span> <span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&#39;scmlog s, people_upeople pup&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetFiltersOwnUniqueIdsSCM"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetFiltersOwnUniqueIdsSCM">[docs]</a><span class="k">def</span> <span class="nf">GetFiltersOwnUniqueIdsSCM</span> <span class="p">()</span> <span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&#39;pup.people_id = s.author_id&#39;</span><span class="p">)</span> 
</div>
<div class="viewcode-block" id="GetPeopleListSCM"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetPeopleListSCM">[docs]</a><span class="k">def</span> <span class="nf">GetPeopleListSCM</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;DISTINCT(pup.upeople_id) as pid, COUNT(s.id) as total&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">GetTablesOwnUniqueIdsSCM</span><span class="p">()</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetFiltersOwnUniqueIdsSCM</span><span class="p">()</span>
    <span class="n">filters</span> <span class="o">+=</span><span class="s">&quot; GROUP BY pid ORDER BY total desc, pid&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&#39;s.date&#39;</span><span class="p">,</span><span class="n">fields</span><span class="p">,</span><span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetPeopleQuerySCM"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetPeopleQuerySCM">[docs]</a><span class="k">def</span> <span class="nf">GetPeopleQuerySCM</span> <span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">evol</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">fields</span> <span class="o">=</span><span class="s">&#39;COUNT(s.id) AS commits&#39;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">GetTablesOwnUniqueIdsSCM</span><span class="p">()</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetFiltersOwnUniqueIdsSCM</span><span class="p">()</span>
    <span class="n">filters</span> <span class="o">+=</span><span class="s">&quot; AND pup.upeople_id=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">developer_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">evol</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="s">&#39;s.date&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">fields</span> <span class="o">+=</span> <span class="s">&quot;,DATE_FORMAT (min(s.date),&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;) as first_date, &quot;</span><span class="o">+</span>\
                  <span class="s">&quot;DATE_FORMAT (max(s.date),&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;) as last_date&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&#39;s.date&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> 
                <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetEvolPeopleSCM"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetEvolPeopleSCM">[docs]</a><span class="k">def</span> <span class="nf">GetEvolPeopleSCM</span> <span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetPeopleQuerySCM</span> <span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetStaticPeopleSCM"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetStaticPeopleSCM">[docs]</a><span class="k">def</span> <span class="nf">GetStaticPeopleSCM</span> <span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetPeopleQuerySCM</span> <span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetActiveAuthorsSCM"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetActiveAuthorsSCM">[docs]</a><span class="k">def</span> <span class="nf">GetActiveAuthorsSCM</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
    <span class="c">#return unique ids of active authors during &quot;days&quot; day</span>
    <span class="c"># FIXME parameters should be: startdate and enddate</span>
    <span class="n">q0</span> <span class="o">=</span> <span class="s">&quot;SELECT distinct(pup.upeople_id) as active_authors &quot;</span><span class="o">+</span>\
        <span class="s">&quot;FROM scmlog s, people_upeople pup &quot;</span> <span class="o">+</span>\
        <span class="s">&quot;WHERE pup.people_id = s.author_id and &quot;</span> <span class="o">+</span>\
        <span class="s">&quot;s.date &gt;= (</span><span class="si">%s</span><span class="s"> - INTERVAL </span><span class="si">%s</span><span class="s"> day)&quot;</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="n">q0</span> <span class="o">%</span> <span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetActiveCommittersSCM"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetActiveCommittersSCM">[docs]</a><span class="k">def</span> <span class="nf">GetActiveCommittersSCM</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
    <span class="c">#return unique ids of active committers during &quot;days&quot; day</span>
    <span class="c"># FIXME parameters should be: startdate and enddate</span>
    <span class="n">q0</span> <span class="o">=</span> <span class="s">&quot;SELECT distinct(pup.upeople_id) as active_committers &quot;</span><span class="o">+</span>\
         <span class="s">&quot;FROM scmlog s, people_upeople pup &quot;</span> <span class="o">+</span>\
         <span class="s">&quot;WHERE pup.people_id = s.committer_id and &quot;</span> <span class="o">+</span> \
         <span class="s">&quot;s.date &gt;= (</span><span class="si">%s</span><span class="s"> - INTERVAL </span><span class="si">%s</span><span class="s"> day)&quot;</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="n">q0</span> <span class="o">%</span> <span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetActivePeopleSCM"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetActivePeopleSCM">[docs]</a><span class="k">def</span> <span class="nf">GetActivePeopleSCM</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
    <span class="c">#Gets IDs of active people on the repository during last x days</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">GetActiveAuthorsSCM</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">committers</span> <span class="o">=</span> <span class="n">GetActiveCommittersSCM</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">people_scm</span> <span class="o">=</span> <span class="n">authors</span><span class="p">[</span><span class="s">&#39;active_authors&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">committers</span><span class="p">[</span><span class="s">&#39;active_committers&#39;</span><span class="p">]</span>
    <span class="n">people_scm</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">people_scm</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">people_scm</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetCommunityMembers"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetCommunityMembers">[docs]</a><span class="k">def</span> <span class="nf">GetCommunityMembers</span><span class="p">():</span>
    <span class="c">#Gets IDs of all community members with no filter</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT DISTINCT(id) as members FROM upeople&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;members&#39;</span><span class="p">])</span>

<span class="c"># </span>
<span class="c"># Legacy and non legacy code - Cleanup</span>
<span class="c">#</span>
</div>
<div class="viewcode-block" id="EvolCompanies"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.EvolCompanies">[docs]</a><span class="k">def</span> <span class="nf">EvolCompanies</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>	
    <span class="c"># Returns the evolution in the provided period of the number of total companies</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;count(distinct(upc.company_id)) as companies&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; scmlog s, people_upeople pup, upeople_companies upc&quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot;s.author_id = pup.people_id and &quot;</span><span class="o">+</span>\
               <span class="s">&quot;pup.upeople_id = upc.upeople_id and &quot;</span><span class="o">+</span>\
               <span class="s">&quot;s.date &gt;= upc.init and  &quot;</span><span class="o">+</span>\
               <span class="s">&quot;s.date &lt; upc.end&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="s">&#39;s.date&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                     <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="EvolCountries"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.EvolCountries">[docs]</a><span class="k">def</span> <span class="nf">EvolCountries</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>	
    <span class="c"># Returns the evolution in the provided period of the number of total countries</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;count(distinct(upc.country_id)) as countries&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot;scmlog s, people_upeople pup, upeople_countries upc&quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot;s.author_id = pup.people_id and pup.upeople_id = upc.upeople_id&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="s">&#39;s.date&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> 
               <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="n">countries</span><span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">countries</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="EvolDomains"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.EvolDomains">[docs]</a><span class="k">def</span> <span class="nf">EvolDomains</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
    <span class="c"># Returns the evolution in the provided period of the number of total domains</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;COUNT(DISTINCT(upd.domain_id)) AS domains&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot;scmlog s, people_upeople pup, upeople_domains upd&quot;</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot;s.author_id = pup.people_id and pup.upeople_id = upd.upeople_id&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="s">&#39;s.date&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
            <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="n">domains</span><span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">domains</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="last_activity"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.last_activity">[docs]</a><span class="k">def</span> <span class="nf">last_activity</span> <span class="p">(</span><span class="n">days</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># Given a number of days, this function calculates the number of</span>
    <span class="c"># commits, authors, files, added and removed lines that took place</span>
    <span class="c"># in a project. </span>

    <span class="n">days</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)</span>

    <span class="c">#commits</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select count(*) as commits_&quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;from scmlog  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where date &gt;= ( &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      select (max(date) - INTERVAL &quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; day) &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      from scmlog)&quot;</span><span class="p">;</span>

    <span class="n">data1</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="c">#authors</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select count(distinct(pup.upeople_id)) as authors_&quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;from scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     people_upeople pup &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where pup.people_id = s.author_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      s.date &gt;= (select (max(date) - INTERVAL &quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; day) from scmlog)&quot;</span><span class="p">;</span>

    <span class="n">data2</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>


    <span class="c">#files</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select count(distinct(a.file_id)) as files_&quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;from scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     actions a &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where a.commit_id = s.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      s.date &gt;= (select (max(date) - INTERVAL &quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; day) from scmlog)&quot;</span>

    <span class="n">data3</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="c">#added_removed lines</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot; select sum(cl.added) as added_lines_&quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot;, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        sum(cl.removed) as removed_lines_&quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot; from scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      commits_lines cl &quot;</span><span class="o">+</span>\
        <span class="s">&quot; where cl.commit_id = s.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       s.date &gt;= (select (max(date) - INTERVAL &quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; day) from scmlog)&quot;</span>

    <span class="n">data4</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="n">agg_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data1</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span>  <span class="n">data2</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data3</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span><span class="n">data4</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">agg_data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="top_people"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.top_people">[docs]</a><span class="k">def</span> <span class="nf">top_people</span> <span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># This function returns the 10 top people participating in the source code.</span>
    <span class="c"># Dataset can be filtered by the affiliations, where specific companies</span>
    <span class="c"># can be ignored. This is done by using the argument &quot;filters&quot;,</span>
    <span class="c"># which can be &quot;None&quot; (no filetering) or the list of companies to</span>
    <span class="c"># filter out.</span>
    <span class="c"># In addition, the number of days allows to limit the study to the last</span>
    <span class="c"># X days specified in that parameter</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">filters</span><span class="p">:</span>
        <span class="n">affiliations_from</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">affiliations_where</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">affiliations</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">aff</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
            <span class="n">affiliations</span> <span class="o">+=</span> <span class="s">&quot; c.name&lt;&gt;&#39;&quot;</span><span class="o">+</span><span class="n">aff</span><span class="o">+</span><span class="s">&quot;&#39; and &quot;</span>
        <span class="n">affiliations_from</span> <span class="o">=</span> <span class="s">&quot;, upeople_companies upc, companies c &quot;</span>
        <span class="n">affiliations_where</span> <span class="o">=</span> <span class="s">&quot; and u.id = upc.upeople_id and &quot;</span><span class="o">+</span>\
            <span class="s">&quot; s.date &gt;= upc.init and &quot;</span><span class="o">+</span>\
            <span class="s">&quot; s.date &lt; upc.end and &quot;</span><span class="o">+</span> <span class="n">affiliations</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
            <span class="s">&quot; upc.company_id = c.id &quot;</span>
 
    <span class="n">date_limit</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">days</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="s">&quot;SELECT @maxdate:=max(date) from scmlog limit 1&quot;</span><span class="p">)</span>
        <span class="n">date_limit</span> <span class="o">=</span> <span class="s">&quot; AND DATEDIFF(@maxdate, date)&lt;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT u.id as id, u.identifier as &quot;</span><span class="o">+</span> <span class="n">role</span><span class="o">+</span> <span class="s">&quot;s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;count(distinct(s.id)) as commits &quot;</span><span class="o">+</span>\
        <span class="s">&quot; FROM scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot; people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot; upeople u &quot;</span><span class="o">+</span>\
        <span class="n">affiliations_from</span> <span class="o">+</span>\
        <span class="s">&quot; WHERE s.&quot;</span><span class="o">+</span> <span class="n">role</span><span class="o">+</span> <span class="s">&quot;_id = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot; pup.upeople_id = u.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot; s.date &gt;= &quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot; s.date &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span> <span class="n">date_limit</span> <span class="o">+</span>\
        <span class="n">affiliations_where</span> <span class="o">+</span>\
        <span class="s">&quot; GROUP BY u.identifier &quot;</span><span class="o">+</span>\
        <span class="s">&quot; ORDER BY commits desc, &quot;</span><span class="o">+</span><span class="n">role</span><span class="o">+</span><span class="s">&quot;s &quot;</span><span class="o">+</span>\
        <span class="s">&quot; LIMIT &quot;</span><span class="o">+</span> <span class="n">limit</span>

    <span class="k">print</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>	

</div>
<div class="viewcode-block" id="top_files_modified"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.top_files_modified">[docs]</a><span class="k">def</span> <span class="nf">top_files_modified</span> <span class="p">()</span> <span class="p">:</span>
    <span class="c"># Top 10 modified files</span>

    <span class="c">#FIXME: to be updated to use stardate and enddate values</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select file_name, count(commit_id) as modifications &quot;</span><span class="o">+</span>\
        <span class="s">&quot;from action_files a join files f on a.file_id = f.id  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where action_type=&#39;M&#39;  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;group by f.id  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;order by modifications desc limit 10; &quot;</span>	
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>	


<span class="c">## TODO: Follow top_committers implementation</span></div>
<div class="viewcode-block" id="top_authors"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.top_authors">[docs]</a><span class="k">def</span> <span class="nf">top_authors</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># Top 10 authors without filters</span>
    <span class="c">#</span>
    <span class="c"># DEPRECATED use top_people instead</span>
    <span class="c">#</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT u.id as id, u.identifier as authors, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       count(distinct(s.id)) as commits &quot;</span><span class="o">+</span>\
        <span class="s">&quot;FROM scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     actions a, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     upeople u &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where s.id = a.commit_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      s.author_id = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      pup.upeople_id = u.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      s.date &gt;=&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      s.date &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;group by u.identifier &quot;</span><span class="o">+</span>\
        <span class="s">&quot;order by commits desc &quot;</span><span class="o">+</span>\
        <span class="s">&quot;LIMIT &quot;</span> <span class="o">+</span> <span class="n">limit</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="top_authors_wo_affiliations"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.top_authors_wo_affiliations">[docs]</a><span class="k">def</span> <span class="nf">top_authors_wo_affiliations</span> <span class="p">(</span><span class="n">list_affs</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># top ten authors with affiliation removal</span>
    <span class="c">#list_affs</span>
    <span class="n">affiliations</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">aff</span> <span class="ow">in</span> <span class="n">list_affs</span><span class="p">:</span>
        <span class="n">affiliations</span> <span class="o">+=</span> <span class="s">&quot; c.name&lt;&gt;&#39;&quot;</span><span class="o">+</span><span class="n">aff</span><span class="o">+</span><span class="s">&quot;&#39; and &quot;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT u.id as id, u.identifier as authors, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       count(distinct(s.id)) as commits &quot;</span><span class="o">+</span>\
        <span class="s">&quot;FROM scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     actions a, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     upeople u,  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     upeople_companies upc, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     companies c &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where s.id = a.commit_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      s.author_id = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      pup.upeople_id = u.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      s.date &gt;=&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      s.date &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      &quot;</span><span class="o">+</span><span class="n">affiliations</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      pup.upeople_id = upc.upeople_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      upc.company_id = c.id &quot;</span><span class="o">+</span>\
        <span class="s">&quot;group by u.identifier &quot;</span><span class="o">+</span>\
        <span class="s">&quot;order by commits desc &quot;</span><span class="o">+</span>\
        <span class="s">&quot;LIMIT &quot;</span> <span class="o">+</span> <span class="n">limit</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="top_authors_year"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.top_authors_year">[docs]</a><span class="k">def</span> <span class="nf">top_authors_year</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># Given a year, this functions provides the top 10 authors </span>
    <span class="c"># of such year</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT u.id as id, u.identifier as authors, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       count(distinct(s.id)) as commits &quot;</span><span class="o">+</span>\
        <span class="s">&quot;FROM scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     upeople u &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where s.author_id = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      pup.upeople_id = u.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      year(s.date) = &quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;group by u.identifier &quot;</span><span class="o">+</span>\
        <span class="s">&quot;order by commits desc &quot;</span><span class="o">+</span>\
        <span class="s">&quot;LIMIT &quot;</span> <span class="o">+</span> <span class="n">limit</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="people"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.people">[docs]</a><span class="k">def</span> <span class="nf">people</span> <span class="p">()</span> <span class="p">:</span>
    <span class="c"># List of people participating in the source code development</span>
 
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select id,identifier from upeople&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">);</span>
</div>
<div class="viewcode-block" id="companies_name_wo_affs"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.companies_name_wo_affs">[docs]</a><span class="k">def</span> <span class="nf">companies_name_wo_affs</span> <span class="p">(</span><span class="n">affs_list</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span> <span class="p">:</span>
    <span class="c">#List of companies without certain affiliations</span>
    <span class="n">affiliations</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">aff</span> <span class="ow">in</span> <span class="n">affs_list</span><span class="p">:</span>
        <span class="n">affiliations</span> <span class="o">+=</span> <span class="s">&quot; c.name&lt;&gt;&#39;&quot;</span><span class="o">+</span><span class="n">aff</span><span class="o">+</span><span class="s">&quot;&#39; and &quot;</span>

    <span class="n">q_old</span> <span class="o">=</span> <span class="s">&quot;select c.name &quot;</span><span class="o">+</span>\
               <span class="s">&quot;  from companies c, &quot;</span><span class="o">+</span>\
               <span class="s">&quot;       people_upeople pup, &quot;</span><span class="o">+</span>\
               <span class="s">&quot;       upeople_companies upc, &quot;</span><span class="o">+</span>\
               <span class="s">&quot;       scmlog s,  &quot;</span><span class="o">+</span>\
               <span class="s">&quot;       actions a &quot;</span><span class="o">+</span>\
               <span class="s">&quot;  where c.id = upc.company_id and &quot;</span><span class="o">+</span>\
               <span class="s">&quot;        upc.upeople_id = pup.upeople_id and &quot;</span><span class="o">+</span>\
               <span class="s">&quot;        s.date &gt;= upc.init and &quot;</span><span class="o">+</span>\
               <span class="s">&quot;        s.date &lt; upc.end and &quot;</span><span class="o">+</span>\
               <span class="s">&quot;        pup.people_id = s.author_id and &quot;</span><span class="o">+</span>\
               <span class="s">&quot;        s.id = a.commit_id and &quot;</span><span class="o">+</span>\
               <span class="s">&quot;        &quot;</span><span class="o">+</span><span class="n">affiliations</span><span class="o">+</span><span class="s">&quot;  &quot;</span><span class="o">+</span>\
               <span class="s">&quot;        s.date &gt;=&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
               <span class="s">&quot;        s.date &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
               <span class="s">&quot;  group by c.name &quot;</span><span class="o">+</span>\
               <span class="s">&quot;  order by count(distinct(s.id)) desc&quot;</span>


    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        select c.name, count(distinct(t.s_id)) as total</span>
<span class="s">        from companies c,  (</span>
<span class="s">          select distinct(s.id) as s_id, company_id</span>
<span class="s">          from companies c, people_upeople pup, upeople_companies upc,</span>
<span class="s">               scmlog s,  actions a</span>
<span class="s">          where c.id = upc.company_id and  upc.upeople_id = pup.upeople_id</span>
<span class="s">            and  s.date &gt;= upc.init and s.date &lt; upc.end</span>
<span class="s">            and pup.people_id = s.author_id</span>
<span class="s">            and s.id = a.commit_id and</span>
<span class="s">            </span><span class="si">%s</span><span class="s"> s.date &gt;=</span><span class="si">%s</span><span class="s"> and s.date &lt; </span><span class="si">%s</span><span class="s">) t</span>
<span class="s">        where c.id = t.company_id</span>
<span class="s">        group by c.name</span>
<span class="s">        order by count(distinct(t.s_id)) desc</span>
<span class="s">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">affiliations</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="companies_name"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.companies_name">[docs]</a><span class="k">def</span> <span class="nf">companies_name</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># companies_limit = 30</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select c.name &quot;</span><span class="o">+</span>\
         <span class="s">&quot;from companies c, &quot;</span><span class="o">+</span>\
         <span class="s">&quot;     people_upeople pup, &quot;</span><span class="o">+</span>\
         <span class="s">&quot;     upeople_companies upc, &quot;</span><span class="o">+</span>\
         <span class="s">&quot;     scmlog s,  &quot;</span><span class="o">+</span>\
         <span class="s">&quot;     actions a &quot;</span><span class="o">+</span>\
         <span class="s">&quot;where c.id = upc.company_id and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      upc.upeople_id = pup.upeople_id and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      pup.people_id = s.author_id and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      s.id = a.commit_id and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      s.date &gt;=&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      s.date &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
         <span class="s">&quot;group by c.name &quot;</span><span class="o">+</span>\
         <span class="s">&quot;order by count(distinct(s.id)) desc&quot;</span>
        <span class="c"># order by count(distinct(s.id)) desc LIMIT &quot;, companies_limit</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>	
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="evol_info_data_companies"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.evol_info_data_companies">[docs]</a><span class="k">def</span> <span class="nf">evol_info_data_companies</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># DEPRECATED FUNCTION; TO BE REMOVED	</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select count(distinct(c.id)) as companies &quot;</span><span class="o">+</span>\
         <span class="s">&quot;from companies c, &quot;</span><span class="o">+</span>\
         <span class="s">&quot;     upeople_companies upc, &quot;</span><span class="o">+</span>\
         <span class="s">&quot;     people_upeople pup, &quot;</span><span class="o">+</span>\
         <span class="s">&quot;     scmlog s &quot;</span><span class="o">+</span>\
         <span class="s">&quot;where c.id = upc.company_id and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      upc.upeople_id = pup.upeople_id and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      pup.people_id = s.author_id and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      s.date &gt;=&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      s.date &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span>

    <span class="n">data13</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select count(distinct(c.id)) as companies_2006 &quot;</span><span class="o">+</span>\
        <span class="s">&quot;from scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  upeople_companies upc, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  companies c &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where s.author_id = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  pup.upeople_id = upc.upeople_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  s.date &gt;= upc.init and  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  s.date &lt; upc.end and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  upc.company_id = c.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  year(s.date) = 2006&quot;</span>

    <span class="n">data14</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select count(distinct(c.id)) as companies_2009 &quot;</span><span class="o">+</span>\
        <span class="s">&quot;from scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  upeople_companies upc, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  companies c &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where s.author_id = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  pup.upeople_id = upc.upeople_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  s.date &gt;= upc.init and  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  s.date &lt; upc.end and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  upc.company_id = c.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  year(s.date) = 2009&quot;</span>

    <span class="n">data15</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select count(distinct(c.id)) as companies_2012 &quot;</span><span class="o">+</span>\
        <span class="s">&quot;from scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  upeople_companies upc, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  companies c &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where s.author_id = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  pup.upeople_id = upc.upeople_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  s.date &gt;= upc.init and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  s.date &lt; upc.end and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  upc.company_id = c.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  year(s.date) = 2012&quot;</span>

    <span class="n">data16</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>


    <span class="n">agg_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data13</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data14</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data15</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data16</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">agg_data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="evol_info_data_countries"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.evol_info_data_countries">[docs]</a><span class="k">def</span> <span class="nf">evol_info_data_countries</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span> <span class="p">:</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select count(distinct(upc.country_id)) as countries &quot;</span><span class="o">+</span>\
         <span class="s">&quot;from upeople_countries upc, &quot;</span><span class="o">+</span>\
         <span class="s">&quot;     people_upeople pup, &quot;</span><span class="o">+</span>\
         <span class="s">&quot;     scmlog s &quot;</span><span class="o">+</span>\
         <span class="s">&quot;where upc.upeople_id = pup.upeople_id and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      pup.people_id = s.author_id and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      s.date &gt;=&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      s.date &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="company_top_authors"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.company_top_authors">[docs]</a><span class="k">def</span> <span class="nf">company_top_authors</span> <span class="p">(</span><span class="n">company_name</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># Returns top ten authors per company</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select u.id as id, u.identifier  as authors, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       count(distinct(s.id)) as commits &quot;</span><span class="o">+</span>\
        <span class="s">&quot; from people p, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      actions a,  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      upeople u, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      upeople_companies upc, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      companies c &quot;</span><span class="o">+</span>\
        <span class="s">&quot; where  s.id = a.commit_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        p.id = s.author_id and  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        s.author_id = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        pup.upeople_id = upc.upeople_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        pup.upeople_id = u.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        s.date &gt;= upc.init and  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        s.date &lt; upc.end and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        upc.company_id = c.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        s.date &gt;=&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        s.date &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        c.name =&quot;</span><span class="o">+</span> <span class="n">company_name</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;group by u.id &quot;</span><span class="o">+</span>\
        <span class="s">&quot;order by count(distinct(s.id)) desc &quot;</span><span class="o">+</span>\
        <span class="s">&quot;limit &quot;</span> <span class="o">+</span> <span class="n">limit</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        SELECT id, authors, commits FROM (</span>
<span class="s">        SELECT u.id AS id, u.identifier  AS authors, count(distinct(s.id)) AS commits</span>
<span class="s">        FROM people p,  scmlog s,  actions a, people_upeople pup, upeople u,</span>
<span class="s">             upeople_companies upc,  companies c</span>
<span class="s">        WHERE  s.id = a.commit_id AND p.id = s.author_id AND s.author_id = pup.people_id  AND</span>
<span class="s">          pup.upeople_id = upc.upeople_id AND pup.upeople_id = u.id AND  s.date &gt;= upc.init AND</span>
<span class="s">          s.date &lt; upc.end AND upc.company_id = c.id AND</span>
<span class="s">          s.date &gt;=</span><span class="si">%s</span><span class="s"> AND s.date &lt; </span><span class="si">%s</span><span class="s"> AND c.name =</span><span class="si">%s</span><span class="s">) t</span>
<span class="s">        GROUP BY id</span>
<span class="s">        ORDER BY COUNT(commits) DESC</span>
<span class="s">        LIMIT </span><span class="si">%s</span><span class="s"></span>
<span class="s">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">company_name</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="company_top_authors_year"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.company_top_authors_year">[docs]</a><span class="k">def</span> <span class="nf">company_top_authors_year</span> <span class="p">(</span><span class="n">company_name</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
    <span class="c"># Top 10 authors per company and in a given year</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select u.id as id, u.identifier as authors, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        count(distinct(s.id)) as commits &quot;</span><span class="o">+</span>\
        <span class="s">&quot; from people p, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      upeople u, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      upeople_companies upc, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      companies c &quot;</span><span class="o">+</span>\
        <span class="s">&quot; where  p.id = s.author_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        s.author_id = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        pup.upeople_id = upc.upeople_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        pup.upeople_id = u.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        s.date &gt;= upc.init and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        s.date &lt; upc.end and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        year(s.date)=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        upc.company_id = c.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        c.name =&quot;</span><span class="o">+</span> <span class="n">company_name</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot; group by u.id &quot;</span><span class="o">+</span>\
        <span class="s">&quot; order by count(distinct(s.id)) desc &quot;</span><span class="o">+</span>\
        <span class="s">&quot; limit &quot;</span> <span class="o">+</span> <span class="n">limit</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="evol_companies"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.evol_companies">[docs]</a><span class="k">def</span> <span class="nf">evol_companies</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>	
    <span class="c"># Evolution of companies, also deprecated function</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select ((to_days(s.date) - to_days(&quot;</span><span class="o">+</span><span class="n">startdate</span><span class="o">+</span><span class="s">&quot;)) div &quot;</span><span class="o">+</span><span class="n">period</span><span class="o">+</span><span class="s">&quot;) as id, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       count(distinct(upc.company_id)) as companies &quot;</span><span class="o">+</span>\
        <span class="s">&quot;from   scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       upeople_companies upc &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where  s.author_id = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       pup.upeople_id = upc.upeople_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       s.date &gt;= upc.init and  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       s.date &lt; upc.end and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       s.date &gt;=&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       s.date &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;group by ((to_days(s.date) - to_days(&quot;</span><span class="o">+</span><span class="n">startdate</span><span class="o">+</span><span class="s">&quot;)) div &quot;</span><span class="o">+</span><span class="n">period</span><span class="o">+</span><span class="s">&quot;)&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>	

</div>
<div class="viewcode-block" id="repos_name"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.repos_name">[docs]</a><span class="k">def</span> <span class="nf">repos_name</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># List of repositories name</span>

    <span class="c"># This query needs pretty large tmp tables</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select count(distinct(s.id)) as total, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        name &quot;</span><span class="o">+</span>\
        <span class="s">&quot; from actions a, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      repositories r &quot;</span><span class="o">+</span>\
        <span class="s">&quot; where s.id = a.commit_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       s.repository_id=r.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       s.date &gt;&quot;</span><span class="o">+</span><span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       s.date &lt;= &quot;</span><span class="o">+</span><span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot; group by repository_id  &quot;</span><span class="o">+</span>\
        <span class="s">&quot; order by total desc,name&quot;</span><span class="p">;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        select count(distinct(sid)) as total, name  </span>
<span class="s">        from repositories r, (</span>
<span class="s">          select distinct(s.id) as sid, repository_id from actions a, scmlog s</span>
<span class="s">          where s.id = a.commit_id  and s.date &gt;</span><span class="si">%s</span><span class="s"> and s.date &lt;= </span><span class="si">%s</span><span class="s">) t</span>
<span class="s">        WHERE repository_id = r.id</span>
<span class="s">        group by repository_id   </span>
<span class="s">        order by total desc,name</span>
<span class="s">        &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>	




<span class="c"># COUNTRIES support</span></div>
<div class="viewcode-block" id="scm_countries_names"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.scm_countries_names">[docs]</a><span class="k">def</span> <span class="nf">scm_countries_names</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span> <span class="p">:</span>

    <span class="n">countries_limit</span> <span class="o">=</span> <span class="mi">30</span> 
    <span class="n">rol</span> <span class="o">=</span> <span class="s">&quot;author&quot;</span> <span class="c">#committer</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT count(s.id) as commits, c.name as name &quot;</span><span class="o">+</span>\
        <span class="s">&quot;FROM scmlog s,  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.countries c, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople_countries upc &quot;</span><span class="o">+</span>\
        <span class="s">&quot;WHERE pup.people_id = s.&quot;</span><span class="o">+</span><span class="n">rol</span><span class="o">+</span><span class="s">&quot;_id AND &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      pup.upeople_id  = upc.upeople_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      upc.country_id = c.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      s.date &gt;=&quot;</span><span class="o">+</span><span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      s.date &lt; &quot;</span><span class="o">+</span><span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;group by c.name &quot;</span><span class="o">+</span>\
        <span class="s">&quot;order by commits desc LIMIT &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">countries_limit</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>	
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c"># Companies / Countries support</span>
</div>
<div class="viewcode-block" id="scm_companies_countries_evol"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.scm_companies_countries_evol">[docs]</a><span class="k">def</span> <span class="nf">scm_companies_countries_evol</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">company</span><span class="p">,</span> <span class="n">country</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span> <span class="p">:</span>

    <span class="n">rol</span> <span class="o">=</span> <span class="s">&quot;author&quot;</span> <span class="c">#committer</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT ((to_days(s.date) - to_days(&quot;</span><span class="o">+</span><span class="n">startdate</span><span class="o">+</span><span class="s">&quot;)) div &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">period</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;) as id, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;count(s.id) AS commits, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;COUNT(DISTINCT(s.&quot;</span><span class="o">+</span><span class="n">rol</span><span class="o">+</span><span class="s">&quot;_id)) as &quot;</span><span class="o">+</span><span class="n">rol</span><span class="o">+</span><span class="s">&quot;s &quot;</span><span class="o">+</span>\
        <span class="s">&quot;FROM scmlog s,  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.countries ct, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople_countries upct, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.companies com, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople_companies upcom &quot;</span><span class="o">+</span>\
        <span class="s">&quot;WHERE pup.people_id = s.&quot;</span><span class="o">+</span><span class="n">rol</span><span class="o">+</span><span class="s">&quot;_id AND &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      pup.upeople_id  = upct.upeople_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      pup.upeople_id = upcom.upeople_id AND &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      upcom.company_id = com.id AND &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      upct.country_id = ct.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      s.date &gt;=&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      s.date &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      ct.name = &#39;&quot;</span><span class="o">+</span> <span class="n">country</span><span class="o">+</span> <span class="s">&quot;&#39; AND &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      com.name =&#39;&quot;</span><span class="o">+</span><span class="n">company</span><span class="o">+</span><span class="s">&quot;&#39; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;GROUP BY ((to_days(s.date) - to_days(&quot;</span><span class="o">+</span><span class="n">startdate</span><span class="o">+</span><span class="s">&quot;)) div &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">period</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;)&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>	
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="c"># Domains</span></div>
<div class="viewcode-block" id="evol_info_data_domains"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.evol_info_data_domains">[docs]</a><span class="k">def</span> <span class="nf">evol_info_data_domains</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT COUNT(DISTINCT(upd.domain_id)) AS domains &quot;</span><span class="o">+</span>\
        <span class="s">&quot;FROM upeople_domains upd, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  scmlog s &quot;</span><span class="o">+</span>\
        <span class="s">&quot;WHERE upd.upeople_id = pup.upeople_id AND &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  pup.people_id = s.author_id AND &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  s.date &gt;=&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; AND &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  s.date &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="scm_domains_names"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.scm_domains_names">[docs]</a><span class="k">def</span> <span class="nf">scm_domains_names</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span> <span class="p">:</span>

    <span class="n">rol</span> <span class="o">=</span> <span class="s">&quot;author&quot;</span> <span class="c">#committer</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT count(s.id) as commits, d.name as name &quot;</span><span class="o">+</span>\
        <span class="s">&quot;FROM scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.domains d, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople_domains upd &quot;</span><span class="o">+</span>\
        <span class="s">&quot;WHERE pup.people_id = s.&quot;</span><span class="o">+</span><span class="n">rol</span><span class="o">+</span><span class="s">&quot;_id AND &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  pup.upeople_id  = upd.upeople_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  upd.domain_id = d.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  s.date &gt;=&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;  s.date &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;GROUP BY d.name &quot;</span><span class="o">+</span>\
        <span class="s">&quot;ORDER BY commits desc&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="scm_projects_name"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.scm_projects_name">[docs]</a><span class="k">def</span> <span class="nf">scm_projects_name</span>  <span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="c"># Projects activity needs to include subprojects also</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s">&quot;Getting projects list for SCM&quot;</span><span class="p">)</span>

    <span class="c"># Get all projects list</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT p.id AS name FROM  </span><span class="si">%s</span><span class="s">.projects p&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">)</span>
    <span class="n">projects</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c"># Loop all projects getting reviews</span>
    <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">projects</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]:</span>
        <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;project&#39;</span><span class="p">,</span> <span class="n">project</span><span class="p">]</span>
        <span class="n">period</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">evol</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">commits</span> <span class="o">=</span> <span class="n">GetCommits</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evol</span><span class="p">)</span>
        <span class="n">commits</span> <span class="o">=</span> <span class="n">commits</span><span class="p">[</span><span class="s">&#39;commits&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">commits</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">commits</span><span class="p">,</span><span class="n">project</span><span class="p">])</span>

    <span class="c"># Order the list using reviews: https://wiki.python.org/moin/HowTo/Sorting</span>
    <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
    <span class="n">data_sort</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_sort</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span> <span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
    <span class="k">return</span><span class="p">({</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="n">names</span><span class="p">})</span>

<span class="c">##############</span>
<span class="c"># Micro Studies</span>
<span class="c">##############</span>
</div>
<div class="viewcode-block" id="GetCodeCommunityStructure"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetCodeCommunityStructure">[docs]</a><span class="k">def</span> <span class="nf">GetCodeCommunityStructure</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">):</span>
    <span class="c"># This function provides information about the general structure of the community.</span>
    <span class="c"># This is divided into core, regular and ocassional authors</span>
    <span class="c"># Core developers are defined as those doing up to a 80% of the total commits</span>
    <span class="c"># Regular developers are defind as those doing from the 80% to a 99% of the total commits</span>
    <span class="c"># Occasional developers are defined as those doing from the 99% to the 100% of the commits</span>

    <span class="c"># Init of structure to be returned</span>
    <span class="n">community</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">community</span><span class="p">[</span><span class="s">&#39;core&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">community</span><span class="p">[</span><span class="s">&#39;regular&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">community</span><span class="p">[</span><span class="s">&#39;occasional&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select count(distinct(s.id)) as total &quot;</span><span class="o">+</span>\
         <span class="s">&quot;from scmlog s, people p, actions a &quot;</span><span class="o">+</span>\
         <span class="s">&quot;where s.author_id = p.id and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      p.email &lt;&gt; &#39;</span><span class="si">%g</span><span class="s">errit@%&#39; and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      p.email &lt;&gt; &#39;%jenkins@%&#39; and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      s.id = a.commit_id and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      s.date&gt;=&quot;</span><span class="o">+</span><span class="n">startdate</span><span class="o">+</span><span class="s">&quot; and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;      s.date&lt;=&quot;</span><span class="o">+</span><span class="n">enddate</span><span class="o">+</span><span class="s">&quot;;&quot;</span>

    <span class="n">total</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">total_commits</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">total</span><span class="p">[</span><span class="s">&#39;total&#39;</span><span class="p">])</span>

    <span class="c"># Database access: developer, %commits</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot; select pup.upeople_id, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;        (count(distinct(s.id))) as commits &quot;</span><span class="o">+</span>\
        <span class="s">&quot; from scmlog s, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      actions a, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      people p &quot;</span><span class="o">+</span>\
        <span class="s">&quot; where s.id = a.commit_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       s.date&gt;=&quot;</span><span class="o">+</span><span class="n">startdate</span><span class="o">+</span><span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       s.date&lt;=&quot;</span><span class="o">+</span><span class="n">enddate</span><span class="o">+</span><span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       s.author_id = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       s.author_id = p.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       p.email &lt;&gt; &#39;</span><span class="si">%g</span><span class="s">errit@%&#39; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       p.email &lt;&gt; &#39;%jenkins@%&#39; &quot;</span><span class="o">+</span>\
        <span class="s">&quot; group by pup.upeople_id &quot;</span><span class="o">+</span>\
        <span class="s">&quot; order by commits desc; &quot;</span>

    <span class="n">people</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">people</span><span class="p">[</span><span class="s">&#39;commits&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">people</span><span class="p">[</span><span class="s">&#39;commits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">people</span><span class="p">[</span><span class="s">&#39;commits&#39;</span><span class="p">]]</span>
    <span class="c"># this is a list. Operate over the list</span>
    <span class="n">people</span><span class="p">[</span><span class="s">&#39;commits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[((</span><span class="n">commits</span> <span class="o">/</span> <span class="n">total_commits</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">commits</span> <span class="ow">in</span> <span class="n">people</span><span class="p">[</span><span class="s">&#39;commits&#39;</span><span class="p">]]</span>
    <span class="c"># people[&#39;commits&#39;] = (people[&#39;commits&#39;] / total_commits) * 100</span>

    <span class="c"># Calculating number of core, regular and occasional developers</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">core</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">core_f</span> <span class="o">=</span> <span class="bp">True</span> <span class="c"># flag</span>
    <span class="n">regular</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">regular_f</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># flag</span>
    <span class="n">occasional</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">devs</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">people</span><span class="p">[</span><span class="s">&#39;commits&#39;</span><span class="p">]:</span>
        <span class="n">cont</span> <span class="o">=</span> <span class="n">cont</span> <span class="o">+</span> <span class="n">value</span>
        <span class="n">devs</span> <span class="o">=</span> <span class="n">devs</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">core_f</span> <span class="ow">and</span> <span class="n">cont</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">):</span>
            <span class="c">#core developers number reached</span>
            <span class="n">core</span> <span class="o">=</span> <span class="n">devs</span>
            <span class="n">core_f</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">regular_f</span> <span class="ow">and</span> <span class="n">cont</span> <span class="o">&gt;=</span> <span class="mi">95</span><span class="p">):</span>
            <span class="n">regular</span> <span class="o">=</span> <span class="n">devs</span>
            <span class="n">regular_f</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">occasional</span> <span class="o">=</span> <span class="n">devs</span> <span class="o">-</span> <span class="n">regular</span>
    <span class="n">regular</span> <span class="o">=</span> <span class="n">regular</span> <span class="o">-</span> <span class="n">core</span>

    <span class="c"># inserting values in variable</span>
    <span class="n">community</span><span class="p">[</span><span class="s">&#39;core&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">core</span>
    <span class="n">community</span><span class="p">[</span><span class="s">&#39;regular&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regular</span>
    <span class="n">community</span><span class="p">[</span><span class="s">&#39;occasional&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">occasional</span>

    <span class="k">return</span><span class="p">(</span><span class="n">community</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetCommitsSummaryCompanies"><a class="viewcode-back" href="../../vizgrimoire.SCM.html#vizgrimoire.SCM.GetCommitsSummaryCompanies">[docs]</a><span class="k">def</span> <span class="nf">GetCommitsSummaryCompanies</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">num_companies</span><span class="p">):</span>
    <span class="c"># This function returns the following dataframe structrure</span>
    <span class="c"># unixtime, date, week/month/..., company1, company2, ... company[num_companies -1], others</span>
    <span class="c"># The 3 first fields are used for data and ordering purposes</span>
    <span class="c"># The &quot;companyX&quot; fields are those that provide info about that company</span>
    <span class="c"># The &quot;Others&quot; field is the aggregated value of the rest of the companies</span>
    <span class="c"># Companies above num_companies will be aggregated in Others</span>

    <span class="n">companies</span>  <span class="o">=</span> <span class="n">companies_name_wo_affs</span><span class="p">([</span><span class="s">&quot;-Bot&quot;</span><span class="p">,</span> <span class="s">&quot;-Individual&quot;</span><span class="p">,</span> <span class="s">&quot;-Unknown&quot;</span><span class="p">],</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">companies</span> <span class="o">=</span> <span class="n">companies</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>

    <span class="n">first_companies</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">company</span> <span class="ow">in</span> <span class="n">companies</span><span class="p">:</span>
        <span class="n">company_name</span> <span class="o">=</span> <span class="s">&quot;&#39;&quot;</span><span class="o">+</span><span class="n">company</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span>

        <span class="n">commits</span> <span class="o">=</span> <span class="n">EvolCommits</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;company&quot;</span><span class="p">,</span> <span class="n">company_name</span><span class="p">])</span>
        <span class="n">commits</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">commits</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="c"># Rename field commits to company name</span>
        <span class="n">commits</span><span class="p">[</span><span class="n">company</span><span class="p">]</span> <span class="o">=</span> <span class="n">commits</span><span class="p">[</span><span class="s">&quot;commits&quot;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">commits</span><span class="p">[</span><span class="s">&#39;commits&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&lt;=</span> <span class="n">num_companies</span><span class="p">):</span>
            <span class="c">#Case of companies with entity in the dataset</span>
            <span class="n">first_companies</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">first_companies</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">commits</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="c">#Case of companies that are aggregated in the field Others</span>
            <span class="k">if</span> <span class="s">&#39;Others&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">first_companies</span><span class="p">:</span>
                <span class="n">first_companies</span><span class="p">[</span><span class="s">&#39;Others&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">commits</span><span class="p">[</span><span class="n">company</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first_companies</span><span class="p">[</span><span class="s">&#39;Others&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">first_companies</span><span class="p">[</span><span class="s">&#39;Others&#39;</span><span class="p">],</span><span class="n">commits</span><span class="p">[</span><span class="n">company</span><span class="p">])]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c">#TODO: remove global variables...</span>
    <span class="n">first_companies</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">first_companies</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">first_companies</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">GrimoreLib 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Bitergia.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>