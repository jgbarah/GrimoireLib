<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>vizgrimoire.ITS &mdash; GrimoreLib 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="GrimoreLib 1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">GrimoreLib 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for vizgrimoire.ITS</h1><div class="highlight"><pre>
<span class="c">## Copyright (C) 2012, 2013 Bitergia</span>
<span class="c">##</span>
<span class="c">## This program is free software; you can redistribute it and/or modify</span>
<span class="c">## it under the terms of the GNU General Public License as published by</span>
<span class="c">## the Free Software Foundation; either version 3 of the License, or</span>
<span class="c">## (at your option) any later version.</span>
<span class="c">##</span>
<span class="c">## This program is distributed in the hope that it will be useful,</span>
<span class="c">## but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c">## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="c">## GNU General Public License for more details. </span>
<span class="c">##</span>
<span class="c">## You should have received a copy of the GNU General Public License</span>
<span class="c">## along with this program; if not, write to the Free Software</span>
<span class="c">## Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
<span class="c">##</span>
<span class="c">## This file is a part of the vizGrimoire R package</span>
<span class="c">##  (an R library for the MetricsGrimoire and vizGrimoire systems)</span>
<span class="c">##</span>
<span class="c">## ITS.R</span>
<span class="c">##</span>
<span class="c">## Queries for ITS data analysis</span>
<span class="c">##</span>
<span class="c">## Authors:</span>
<span class="c">##   Jesus M. Gonzalez-Barahona &lt;jgb@bitergia.com&gt;</span>
<span class="c">##   Daniel Izquierdo &lt;dizquierdo@bitergia.com&gt;</span>
<span class="c">##   Alvaro del Castillo &lt;acs@bitergia.com&gt;</span>
<span class="c">##   Luis Canas-Diaz &lt;lcanas@bitergia.com&gt;</span>

<span class="kn">import</span> <span class="nn">logging</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">GrimoireSQL</span> <span class="kn">import</span> <span class="n">GetSQLGlobal</span><span class="p">,</span> <span class="n">GetSQLPeriod</span>
<span class="kn">from</span> <span class="nn">GrimoireSQL</span> <span class="kn">import</span> <span class="n">ExecuteQuery</span><span class="p">,</span> <span class="n">BuildQuery</span>
<span class="kn">from</span> <span class="nn">GrimoireUtils</span> <span class="kn">import</span> <span class="n">GetPercentageDiff</span><span class="p">,</span> <span class="n">GetDates</span><span class="p">,</span> <span class="n">completePeriodIds</span><span class="p">,</span> <span class="n">getPeriod</span>
<span class="kn">from</span> <span class="nn">GrimoireUtils</span> <span class="kn">import</span> <span class="n">createJSON</span><span class="p">,</span> <span class="n">get_subprojects</span>

<span class="kn">from</span> <span class="nn">data_source</span> <span class="kn">import</span> <span class="n">DataSource</span>
<span class="kn">from</span> <span class="nn">filter</span> <span class="kn">import</span> <span class="n">Filter</span>
<span class="kn">import</span> <span class="nn">report</span>

<div class="viewcode-block" id="ITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS">[docs]</a><span class="k">class</span> <span class="nc">ITS</span><span class="p">(</span><span class="n">DataSource</span><span class="p">):</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.get_db_name"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.get_db_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_db_name</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">&quot;db_bicho&quot;</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.get_name"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">():</span> <span class="k">return</span> <span class="s">&quot;its&quot;</span>
</div>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_backend</span><span class="p">():</span>
        <span class="n">automator</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">Report</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
        <span class="n">its_backend</span> <span class="o">=</span> <span class="n">automator</span><span class="p">[</span><span class="s">&#39;bicho&#39;</span><span class="p">][</span><span class="s">&#39;backend&#39;</span><span class="p">]</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">its_backend</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">backend</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_closed_condition</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">ITS</span><span class="o">.</span><span class="n">_get_backend</span><span class="p">()</span><span class="o">.</span><span class="n">closed_condition</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.get_tickets_states"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.get_tickets_states">[docs]</a>    <span class="k">def</span> <span class="nf">get_tickets_states</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">backend</span><span class="p">):</span>

        <span class="kn">from</span> <span class="nn">rpy2.robjects.packages</span> <span class="kn">import</span> <span class="n">importr</span>
        <span class="kn">from</span> <span class="nn">GrimoireUtils</span> <span class="kn">import</span> <span class="n">dataFrame2Dict</span>

        <span class="n">vizr</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span><span class="s">&quot;vizgrimoire&quot;</span><span class="p">)</span>

        <span class="n">evol</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">evol</span>

        <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">backend</span><span class="o">.</span><span class="n">statuses</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s">&quot;Working with ticket status: &quot;</span> <span class="o">+</span> <span class="n">status</span><span class="p">)</span>
            <span class="c">#Evolution of the backlog</span>
            <span class="n">tickets_status</span> <span class="o">=</span> <span class="n">vizr</span><span class="o">.</span><span class="n">GetEvolBacklogTickets</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">backend</span><span class="o">.</span><span class="n">name_log_table</span><span class="p">)</span>
            <span class="n">tickets_status</span> <span class="o">=</span> <span class="n">dataFrame2Dict</span><span class="p">(</span><span class="n">tickets_status</span><span class="p">)</span>
            <span class="n">tickets_status</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">tickets_status</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="c"># rename key</span>
            <span class="n">tickets_status</span><span class="p">[</span><span class="n">status</span><span class="p">]</span> <span class="o">=</span> <span class="n">tickets_status</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;pending_tickets&quot;</span><span class="p">)</span>
            <span class="c">#Issues per status</span>
            <span class="n">current_status</span> <span class="o">=</span> <span class="n">vizr</span><span class="o">.</span><span class="n">GetCurrentStatus</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
            <span class="n">current_status</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">dataFrame2Dict</span><span class="p">(</span><span class="n">current_status</span><span class="p">),</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="c">#Merging data</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">current_status</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">tickets_status</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">evol</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.get_evolutionary_data"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.get_evolutionary_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_evolutionary_data</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">closed_condition</span> <span class="o">=</span> <span class="n">ITS</span><span class="o">.</span><span class="n">_get_closed_condition</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">filter_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="s">&quot;&#39;&quot;</span><span class="o">+</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_item</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span><span class="p">]</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="n">EvolITSInfo</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> 
                               <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolITSInfo</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolIssuesCompanies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolIssuesCountries</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolIssuesRepositories</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">EvolIssuesDomains</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">ITS</span><span class="o">.</span><span class="n">get_tickets_states</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">ITS</span><span class="o">.</span><span class="n">_get_backend</span><span class="p">())</span>
            <span class="n">evol</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">evol</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">evol</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.create_evolutionary_report"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.create_evolutionary_report">[docs]</a>    <span class="k">def</span> <span class="nf">create_evolutionary_report</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">filter_</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span>  <span class="n">ITS</span><span class="o">.</span><span class="n">get_evolutionary_data</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">filter_</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">ITS</span><span class="p">()</span><span class="o">.</span><span class="n">get_evolutionary_filename</span><span class="p">()</span>
        <span class="n">createJSON</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.get_agg_data"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.get_agg_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_agg_data</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">closed_condition</span> <span class="o">=</span> <span class="n">ITS</span><span class="o">.</span><span class="n">_get_closed_condition</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">filter_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="s">&quot;&#39;&quot;</span><span class="o">+</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_item</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">AggITSInfo</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="n">data</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="n">AggITSInfo</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">AggAllParticipants</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span>  <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">TrackerURL</span><span class="p">()</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span>  <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">AggIssuesCompanies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">AggIssuesCountries</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">AggIssuesDomains</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
            <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="c"># Tendencies    </span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">365</span><span class="p">]:</span>
                <span class="n">period_data</span> <span class="o">=</span> <span class="n">GetDiffClosedDays</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">[],</span> <span class="n">closed_condition</span><span class="p">)</span>
                <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">period_data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="n">period_data</span> <span class="o">=</span> <span class="n">GetDiffOpenedDays</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">period_data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="n">period_data</span> <span class="o">=</span> <span class="n">GetDiffClosersDays</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">[],</span> <span class="n">closed_condition</span><span class="p">)</span>
                <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">period_data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="n">period_data</span> <span class="o">=</span> <span class="n">GetDiffChangersDays</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">period_data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

            <span class="c"># Last Activity: to be removed</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">365</span><span class="p">,</span><span class="mi">730</span><span class="p">]:</span>
                <span class="n">period_activity</span> <span class="o">=</span> <span class="n">GetLastActivityITS</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
                <span class="n">agg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">period_activity</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">agg</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.create_agg_report"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.create_agg_report">[docs]</a>    <span class="k">def</span> <span class="nf">create_agg_report</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">filter_</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ITS</span><span class="o">.</span><span class="n">get_agg_data</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="n">filter_</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">ITS</span><span class="p">()</span><span class="o">.</span><span class="n">get_agg_filename</span><span class="p">()</span>
        <span class="n">createJSON</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.get_top_data"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.get_top_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_top_data</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_</span><span class="p">,</span> <span class="n">npeople</span><span class="p">):</span>
        <span class="n">bots</span> <span class="o">=</span> <span class="n">ITS</span><span class="o">.</span><span class="n">get_bots</span><span class="p">()</span>
        <span class="n">closed_condition</span> <span class="o">=</span>  <span class="n">ITS</span><span class="o">.</span><span class="n">_get_closed_condition</span><span class="p">()</span>
        <span class="n">top</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">filter_</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">top_closers_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">top_closers_data</span><span class="p">[</span><span class="s">&#39;closers.&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">GetTopClosers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
            <span class="n">top_closers_data</span><span class="p">[</span><span class="s">&#39;closers.last year&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">GetTopClosers</span><span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
            <span class="n">top_closers_data</span><span class="p">[</span><span class="s">&#39;closers.last month&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">GetTopClosers</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>

            <span class="n">top_openers_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">top_openers_data</span><span class="p">[</span><span class="s">&#39;openers.&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">GetTopOpeners</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
            <span class="n">top_openers_data</span><span class="p">[</span><span class="s">&#39;openers.last year&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">GetTopOpeners</span><span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
            <span class="n">top_openers_data</span><span class="p">[</span><span class="s">&#39;openers.last month&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">GetTopOpeners</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>

            <span class="n">top</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">top_closers_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">top_openers_data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">filter_name</span> <span class="o">=</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="n">item</span> <span class="o">=</span> <span class="s">&quot;&#39;&quot;</span><span class="o">+</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_item</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;company&quot;</span><span class="p">):</span>
                <span class="n">top</span> <span class="o">=</span> <span class="n">GetCompanyTopClosers</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;domain&quot;</span><span class="p">):</span>
                <span class="n">top</span> <span class="o">=</span> <span class="n">GetDomainTopClosers</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">top</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">top</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.create_top_report"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.create_top_report">[docs]</a>    <span class="k">def</span> <span class="nf">create_top_report</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">npeople</span><span class="p">,</span> <span class="n">i_db</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ITS</span><span class="o">.</span><span class="n">get_top_data</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">i_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
        <span class="n">createJSON</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">destdir</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">ITS</span><span class="p">()</span><span class="o">.</span><span class="n">get_top_filename</span><span class="p">())</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.get_filter_items"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.get_filter_items">[docs]</a>    <span class="k">def</span> <span class="nf">get_filter_items</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">filter_name</span> <span class="o">=</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span><span class="p">):</span>
            <span class="n">items</span>  <span class="o">=</span> <span class="n">GetReposNameITS</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;company&quot;</span><span class="p">):</span>
            <span class="n">items</span>  <span class="o">=</span> <span class="n">GetCompaniesNameITS</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">ITS</span><span class="o">.</span><span class="n">_get_closed_condition</span><span class="p">(),</span> <span class="n">bots</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;country&quot;</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">GetCountriesNamesITS</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">ITS</span><span class="o">.</span><span class="n">_get_closed_condition</span><span class="p">())</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;domain&quot;</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">GetDomainsNameITS</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">ITS</span><span class="o">.</span><span class="n">_get_closed_condition</span><span class="p">(),</span> <span class="n">bots</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;project&quot;</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">get_projects_name</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">ITS</span><span class="o">.</span><span class="n">_get_closed_condition</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">filter_name</span> <span class="o">+</span> <span class="s">&quot; not supported&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.get_filter_summary"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.get_filter_summary">[docs]</a>    <span class="k">def</span> <span class="nf">get_filter_summary</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">filter_name</span> <span class="o">=</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="n">closed_condition</span> <span class="o">=</span>  <span class="n">ITS</span><span class="o">.</span><span class="n">_get_closed_condition</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;company&quot;</span><span class="p">):</span>
            <span class="n">summary</span> <span class="o">=</span>  <span class="n">GetClosedSummaryCompanies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">summary</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.create_filter_report"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.create_filter_report">[docs]</a>    <span class="k">def</span> <span class="nf">create_filter_report</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">npeople</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">ITS</span><span class="o">.</span><span class="n">get_filter_items</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">bots</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">items</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span> <span class="k">return</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>

        <span class="n">filter_name</span> <span class="o">=</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">)):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span><span class="p">]</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="n">ITS</span><span class="p">()))</span>
        <span class="n">createJSON</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filter_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;domain&quot;</span><span class="p">,</span> <span class="s">&quot;company&quot;</span><span class="p">,</span> <span class="s">&quot;repository&quot;</span><span class="p">):</span>
            <span class="n">items_list</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;closed_365&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s">&#39;closers_365&#39;</span> <span class="p">:</span> <span class="p">[]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items_list</span> <span class="o">=</span> <span class="n">items</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span> <span class="p">:</span>
            <span class="n">item_name</span> <span class="o">=</span> <span class="s">&quot;&#39;&quot;</span><span class="o">+</span> <span class="n">item</span><span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="n">item_name</span><span class="p">)</span>
            <span class="n">filter_item</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="n">filter_name</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

            <span class="n">evol_data</span> <span class="o">=</span> <span class="n">ITS</span><span class="o">.</span><span class="n">get_evolutionary_data</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_item</span><span class="p">)</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filter_item</span><span class="o">.</span><span class="n">get_evolutionary_filename</span><span class="p">(</span><span class="n">ITS</span><span class="p">()))</span>
            <span class="n">createJSON</span><span class="p">(</span><span class="n">evol_data</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

            <span class="n">agg</span> <span class="o">=</span> <span class="n">ITS</span><span class="o">.</span><span class="n">get_agg_data</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_item</span><span class="p">)</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filter_item</span><span class="o">.</span><span class="n">get_static_filename</span><span class="p">(</span><span class="n">ITS</span><span class="p">()))</span>
            <span class="n">createJSON</span><span class="p">(</span><span class="n">agg</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">filter_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;domain&quot;</span><span class="p">,</span> <span class="s">&quot;company&quot;</span><span class="p">,</span> <span class="s">&quot;repository&quot;</span><span class="p">):</span>
                <span class="n">items_list</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">))</span>
                <span class="n">items_list</span><span class="p">[</span><span class="s">&#39;closed_365&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agg</span><span class="p">[</span><span class="s">&#39;closed_365&#39;</span><span class="p">])</span>
                <span class="n">items_list</span><span class="p">[</span><span class="s">&#39;closers_365&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agg</span><span class="p">[</span><span class="s">&#39;closers_365&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">filter_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;company&quot;</span><span class="p">,</span><span class="s">&quot;domain&quot;</span><span class="p">]):</span>
                <span class="n">top</span> <span class="o">=</span> <span class="n">ITS</span><span class="o">.</span><span class="n">get_top_data</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">filter_item</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filter_item</span><span class="o">.</span><span class="n">get_top_filename</span><span class="p">(</span><span class="n">ITS</span><span class="p">()))</span>
                <span class="n">createJSON</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destdir</span><span class="p">,</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="n">ITS</span><span class="p">()))</span>
        <span class="n">createJSON</span><span class="p">(</span><span class="n">items_list</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">filter_name</span> <span class="o">==</span> <span class="s">&quot;company&quot;</span><span class="p">):</span>
            <span class="n">closed</span> <span class="o">=</span> <span class="n">ITS</span><span class="o">.</span><span class="n">get_filter_summary</span><span class="p">(</span><span class="n">filter_</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">createJSON</span> <span class="p">(</span><span class="n">closed</span><span class="p">,</span> <span class="n">destdir</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_summary_filename</span><span class="p">(</span><span class="n">ITS</span><span class="p">))</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.get_top_people"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.get_top_people">[docs]</a>    <span class="k">def</span> <span class="nf">get_top_people</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">npeople</span><span class="p">):</span>
        <span class="n">top_data</span> <span class="o">=</span> <span class="n">ITS</span><span class="o">.</span><span class="n">get_top_data</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">npeople</span><span class="p">)</span>

        <span class="n">top</span> <span class="o">=</span> <span class="n">top_data</span><span class="p">[</span><span class="s">&#39;closers.&#39;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">top_data</span><span class="p">[</span><span class="s">&#39;closers.last year&#39;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">top_data</span><span class="p">[</span><span class="s">&#39;closers.last month&#39;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">top_data</span><span class="p">[</span><span class="s">&#39;openers.&#39;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">top_data</span><span class="p">[</span><span class="s">&#39;openers.last year&#39;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">top</span> <span class="o">+=</span> <span class="n">top_data</span><span class="p">[</span><span class="s">&#39;openers.last month&#39;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
        <span class="c"># remove duplicates</span>
        <span class="n">people</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">top</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">people</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.get_person_evol"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.get_person_evol">[docs]</a>    <span class="k">def</span> <span class="nf">get_person_evol</span><span class="p">(</span><span class="n">upeople_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
        <span class="n">closed_condition</span> <span class="o">=</span>  <span class="n">ITS</span><span class="o">.</span><span class="n">_get_closed_condition</span><span class="p">()</span>

        <span class="n">evol</span> <span class="o">=</span> <span class="n">GetPeopleEvolITS</span><span class="p">(</span><span class="n">upeople_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
        <span class="n">evol</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">evol</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">evol</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.get_person_agg"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.get_person_agg">[docs]</a>    <span class="k">def</span> <span class="nf">get_person_agg</span><span class="p">(</span><span class="n">upeople_id</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
        <span class="n">closed_condition</span> <span class="o">=</span>  <span class="n">ITS</span><span class="o">.</span><span class="n">_get_closed_condition</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">GetPeopleStaticITS</span><span class="p">(</span><span class="n">upeople_id</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.create_r_reports"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.create_r_reports">[docs]</a>    <span class="k">def</span> <span class="nf">create_r_reports</span><span class="p">(</span><span class="n">vizr</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">):</span>
        <span class="c"># Time to Close: Other backends not yet supported</span>
        <span class="n">vizr</span><span class="o">.</span><span class="n">ReportTimeToCloseITS</span><span class="p">(</span><span class="n">ITS</span><span class="o">.</span><span class="n">_get_backend</span><span class="p">()</span><span class="o">.</span><span class="n">its_type</span><span class="p">,</span> <span class="n">destdir</span><span class="p">)</span>
        <span class="n">unique_ids</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># Demographics</span>
        <span class="n">vizr</span><span class="o">.</span><span class="n">ReportDemographicsAgingITS</span><span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">unique_ids</span><span class="p">)</span>
        <span class="n">vizr</span><span class="o">.</span><span class="n">ReportDemographicsBirthITS</span><span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="n">destdir</span><span class="p">,</span> <span class="n">unique_ids</span><span class="p">)</span>

        <span class="c"># Markov</span>
        <span class="n">vizr</span><span class="o">.</span><span class="n">ReportMarkovChain</span><span class="p">(</span><span class="n">destdir</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_remove_people</span><span class="p">(</span><span class="n">people_id</span><span class="p">):</span>
        <span class="c"># Remove from people</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM people_upeople WHERE people_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">people_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM people WHERE id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">people_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_remove_issue</span><span class="p">(</span><span class="n">issue_id</span><span class="p">):</span>
        <span class="c"># Backend name</span>
        <span class="n">its_type</span> <span class="o">=</span> <span class="n">ITS</span><span class="o">.</span><span class="n">_get_backend</span><span class="p">()</span><span class="o">.</span><span class="n">its_type</span>
        <span class="n">db_ext</span> <span class="o">=</span> <span class="n">its_type</span>
        <span class="k">if</span> <span class="n">its_type</span> <span class="o">==</span> <span class="s">&quot;lp&quot;</span><span class="p">:</span> <span class="n">db_ext</span> <span class="o">=</span> <span class="s">&quot;launchpad&quot;</span>
        <span class="k">elif</span> <span class="n">its_type</span> <span class="o">==</span> <span class="s">&quot;bg&quot;</span><span class="p">:</span> <span class="n">db_ext</span> <span class="o">=</span> <span class="s">&quot;bugzilla&quot;</span>
        <span class="c"># attachments</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM attachments WHERE issue_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">issue_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="c"># changes</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM changes WHERE issue_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">issue_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="c"># comments</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM comments WHERE issue_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">issue_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="c"># related_to</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM related_to WHERE issue_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">issue_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="c"># issues_ext_bugzilla</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM issues_ext_</span><span class="si">%s</span><span class="s"> WHERE issue_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">db_ext</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="c"># issues_log_bugzilla</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM issues_log_</span><span class="si">%s</span><span class="s"> WHERE issue_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">db_ext</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="c"># issues_watchers</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM issues_watchers WHERE issue_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">issue_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="c"># issues</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE FROM issues WHERE id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">issue_id</span><span class="p">)</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.remove_filter_data"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.remove_filter_data">[docs]</a>    <span class="k">def</span> <span class="nf">remove_filter_data</span><span class="p">(</span><span class="n">filter_</span><span class="p">):</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">filter_</span><span class="o">.</span><span class="n">get_item</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Removing ITS filter </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="n">filter_</span><span class="o">.</span><span class="n">get_item</span><span class="p">()))</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT * from trackers WHERE url=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="n">repo</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">repo</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> not found&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">uri</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">get_people_one_repo</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
            <span class="k">return</span>  <span class="s">&quot;&quot;&quot;</span>
<span class="s">                SELECT </span><span class="si">%s</span><span class="s"> FROM (SELECT COUNT(DISTINCT(tracker_id)) AS total, </span><span class="si">%s</span><span class="s"></span>
<span class="s">                FROM issues</span>
<span class="s">                GROUP BY </span><span class="si">%s</span><span class="s"></span>
<span class="s">                HAVING total=1) t</span>
<span class="s">                &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>


        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Removing people&quot;</span><span class="p">)</span>
        <span class="c">## Remove submitted_by that exists only in this repository</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">            SELECT DISTINCT(submitted_by) from issues</span>
<span class="s">            WHERE tracker_id=&#39;</span><span class="si">%s</span><span class="s">&#39; AND submitted_by in (</span><span class="si">%s</span><span class="s">)</span>
<span class="s">        &quot;&quot;&quot;</span>  <span class="o">%</span> <span class="p">(</span><span class="n">repo</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span><span class="n">get_people_one_repo</span><span class="p">(</span><span class="s">&quot;submitted_by&quot;</span><span class="p">))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">people_id</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;submitted_by&#39;</span><span class="p">]:</span>
            <span class="n">ITS</span><span class="o">.</span><span class="n">_remove_people</span><span class="p">(</span><span class="n">people_id</span><span class="p">)</span>
        <span class="c">## Remove assigned_to that exists only in this repository</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">            SELECT DISTINCT(assigned_to) from issues</span>
<span class="s">            WHERE tracker_id=&#39;</span><span class="si">%s</span><span class="s">&#39; AND assigned_to in (</span><span class="si">%s</span><span class="s">)</span>
<span class="s">        &quot;&quot;&quot;</span>  <span class="o">%</span> <span class="p">(</span><span class="n">repo</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span><span class="n">get_people_one_repo</span><span class="p">(</span><span class="s">&quot;assigned_to&quot;</span><span class="p">))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">people_id</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;assigned_to&#39;</span><span class="p">]:</span>
            <span class="n">ITS</span><span class="o">.</span><span class="n">_remove_people</span><span class="p">(</span><span class="n">people_id</span><span class="p">)</span>

        <span class="c"># Remove people activity</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Removing issues&quot;</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT id from issues WHERE tracker_id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">repo</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">issue_id</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]:</span>
            <span class="n">ITS</span><span class="o">.</span><span class="n">_remove_issue</span><span class="p">(</span><span class="n">issue_id</span><span class="p">)</span>
        <span class="c"># Remove filter</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;DELETE from trackers WHERE id=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">repo</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ITS.get_metrics_definition"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.ITS.get_metrics_definition">[docs]</a>    <span class="k">def</span> <span class="nf">get_metrics_definition</span> <span class="p">():</span>
        <span class="n">mdef</span> <span class="o">=</span> <span class="p">{</span>
           <span class="s">&quot;its_opened&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;its_opened&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;opened&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Opened tickets&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of opened tickets&quot;</span><span class="p">,</span>
                <span class="s">&quot;envision&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s">&quot;y_labels&quot;</span> <span class="p">:</span> <span class="s">&quot;true&quot;</span><span class="p">,</span>
                    <span class="s">&quot;show_markers&quot;</span> <span class="p">:</span> <span class="s">&quot;true&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">&quot;its_openers&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;its_openers&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;openers&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Ticket submitters&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of persons submitting new tickets&quot;</span><span class="p">,</span>
                <span class="s">&quot;action&quot;</span> <span class="p">:</span> <span class="s">&quot;opened&quot;</span><span class="p">,</span>
                <span class="s">&quot;envision&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s">&quot;gtype&quot;</span> <span class="p">:</span> <span class="s">&quot;whiskers&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">&quot;its_closed&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;its_closed&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;closed&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Closed tickets&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of closed tickets&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;its_closers&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;its_closers&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;closers&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Ticket closers&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of persons closing tickets&quot;</span><span class="p">,</span>
                <span class="s">&quot;action&quot;</span> <span class="p">:</span> <span class="s">&quot;closed&quot;</span><span class="p">,</span>
                <span class="s">&quot;envision&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s">&quot;gtype&quot;</span> <span class="p">:</span> <span class="s">&quot;whiskers&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">&quot;its_changed&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;its_changed&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;changed&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Changed tickets&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of changes to the state of tickets&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;its_changers&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;its_changers&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;changers&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Ticket state changers&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of persons changing the state of tickets&quot;</span><span class="p">,</span>
                <span class="s">&quot;action&quot;</span> <span class="p">:</span> <span class="s">&quot;changed&quot;</span><span class="p">,</span>
                <span class="s">&quot;envision&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s">&quot;gtype&quot;</span> <span class="p">:</span> <span class="s">&quot;whiskers&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">&quot;its_companies&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;its_companies&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;companies&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Organziations&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of organizations (companies, etc.) with persons active in the ticketing system&quot;</span>
            <span class="p">},</span> 
            <span class="s">&quot;its_countries&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;its_countries&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;countries&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Countries&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of countries with persons active in the ticketing system&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;its_domains&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;its_domains&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;domains&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Domains&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of distinct domains with persons active in the ticketing system&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;its_repositories&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;its_repositories&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;repositories&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Trackers&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of active trackers&quot;</span>
            <span class="p">},</span>
            <span class="s">&quot;its_people&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;divid&quot;</span> <span class="p">:</span> <span class="s">&quot;its_people&quot;</span><span class="p">,</span>
                <span class="s">&quot;column&quot;</span> <span class="p">:</span> <span class="s">&quot;people&quot;</span><span class="p">,</span>
                <span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;Active persons&quot;</span><span class="p">,</span>
                <span class="s">&quot;desc&quot;</span> <span class="p">:</span> <span class="s">&quot;Number of persons active in the ticketing system&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">mdef</span>

<span class="c">##############</span>
<span class="c"># Specific FROM and WHERE clauses per type of report</span>
<span class="c">##############</span>
</div></div>
<div class="viewcode-block" id="GetITSSQLRepositoriesFrom"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetITSSQLRepositoriesFrom">[docs]</a><span class="k">def</span> <span class="nf">GetITSSQLRepositoriesFrom</span> <span class="p">():</span>
    <span class="c"># tables necessary for repositories </span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot;, trackers t&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetITSSQLRepositoriesWhere"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetITSSQLRepositoriesWhere">[docs]</a><span class="k">def</span> <span class="nf">GetITSSQLRepositoriesWhere</span> <span class="p">(</span><span class="n">repository</span><span class="p">):</span>
    <span class="c"># fields necessary to match info among tables</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot; i.tracker_id = t.id and t.url = &quot;</span><span class="o">+</span><span class="n">repository</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetITSSQLProjectsFrom"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetITSSQLProjectsFrom">[docs]</a><span class="k">def</span> <span class="nf">GetITSSQLProjectsFrom</span> <span class="p">():</span>
    <span class="c"># tables necessary for repositories</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">&quot;, trackers t&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetITSSQLProjectsWhere"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetITSSQLProjectsWhere">[docs]</a><span class="k">def</span> <span class="nf">GetITSSQLProjectsWhere</span> <span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">):</span>
    <span class="c"># include all repositories for a project and its subprojects</span>
    <span class="c"># Remove &#39;&#39; from project name</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">project</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">project</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&#39;&quot;</span><span class="p">):</span>
        <span class="n">project</span> <span class="o">=</span> <span class="n">project</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">repos</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot; t.url IN (</span>
<span class="s">           SELECT repository_name</span>
<span class="s">           FROM   </span><span class="si">%s</span><span class="s">.projects p, </span><span class="si">%s</span><span class="s">.project_repositories pr</span>
<span class="s">           WHERE  p.project_id = pr.project_id AND p.project_id IN (</span><span class="si">%s</span><span class="s">)</span>
<span class="s">               AND pr.data_source=&#39;its&#39;</span>
<span class="s">    )&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">get_subprojects</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">repos</span>   <span class="o">+</span> <span class="s">&quot; and t.id = i.tracker_id&quot;</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="GetITSSQLCompaniesFrom"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetITSSQLCompaniesFrom">[docs]</a><span class="k">def</span> <span class="nf">GetITSSQLCompaniesFrom</span> <span class="p">(</span><span class="n">i_db</span><span class="p">):</span>
    <span class="c"># fields necessary for the companies analysis</span>

    <span class="k">return</span><span class="p">(</span><span class="s">&quot; , people_upeople pup, &quot;</span><span class="o">+</span>\
           <span class="n">i_db</span><span class="o">+</span><span class="s">&quot;.companies c, &quot;</span><span class="o">+</span>\
           <span class="n">i_db</span><span class="o">+</span><span class="s">&quot;.upeople_companies upc&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetITSSQLCompaniesWhere"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetITSSQLCompaniesWhere">[docs]</a><span class="k">def</span> <span class="nf">GetITSSQLCompaniesWhere</span> <span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="c"># filters for the companies analysis</span>
    <span class="k">return</span><span class="p">(</span><span class="s">&quot; i.submitted_by = pup.people_id and &quot;</span><span class="o">+</span>\
           <span class="s">&quot;pup.upeople_id = upc.upeople_id and &quot;</span><span class="o">+</span>\
           <span class="s">&quot;upc.company_id = c.id and &quot;</span><span class="o">+</span>\
           <span class="s">&quot;i.submitted_on &gt;= upc.init and &quot;</span><span class="o">+</span>\
           <span class="s">&quot;i.submitted_on &lt; upc.end and &quot;</span><span class="o">+</span>\
           <span class="s">&quot;c.name = &quot;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetITSSQLCountriesFrom"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetITSSQLCountriesFrom">[docs]</a><span class="k">def</span> <span class="nf">GetITSSQLCountriesFrom</span> <span class="p">(</span><span class="n">i_db</span><span class="p">):</span>
    <span class="c"># fields necessary for the countries analysis</span>

    <span class="k">return</span><span class="p">(</span><span class="s">&quot; , people_upeople pup, &quot;</span><span class="o">+</span>\
           <span class="n">i_db</span><span class="o">+</span><span class="s">&quot;.countries c, &quot;</span><span class="o">+</span>\
           <span class="n">i_db</span><span class="o">+</span><span class="s">&quot;.upeople_countries upc&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetITSSQLCountriesWhere"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetITSSQLCountriesWhere">[docs]</a><span class="k">def</span> <span class="nf">GetITSSQLCountriesWhere</span> <span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="c"># filters for the countries analysis</span>
    <span class="k">return</span><span class="p">(</span><span class="s">&quot; i.submitted_by = pup.people_id and &quot;</span><span class="o">+</span>\
           <span class="s">&quot;pup.upeople_id = upc.upeople_id and &quot;</span><span class="o">+</span>\
           <span class="s">&quot;upc.country_id = c.id and &quot;</span><span class="o">+</span>\
           <span class="s">&quot;c.name = &quot;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetITSSQLDomainsFrom"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetITSSQLDomainsFrom">[docs]</a><span class="k">def</span> <span class="nf">GetITSSQLDomainsFrom</span> <span class="p">(</span><span class="n">i_db</span><span class="p">):</span>
    <span class="c"># fields necessary for the domains analysis</span>

    <span class="k">return</span><span class="p">(</span><span class="s">&quot; , people_upeople pup, &quot;</span><span class="o">+</span>\
           <span class="n">i_db</span><span class="o">+</span><span class="s">&quot;.domains d, &quot;</span><span class="o">+</span>\
           <span class="n">i_db</span><span class="o">+</span><span class="s">&quot;.upeople_domains upd&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetITSSQLDomainsWhere"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetITSSQLDomainsWhere">[docs]</a><span class="k">def</span> <span class="nf">GetITSSQLDomainsWhere</span> <span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="c"># filters for the domains analysis</span>
    <span class="k">return</span><span class="p">(</span><span class="s">&quot; i.submitted_by = pup.people_id and &quot;</span><span class="o">+</span>\
           <span class="s">&quot;pup.upeople_id = upd.upeople_id and &quot;</span><span class="o">+</span>\
           <span class="s">&quot;upd.domain_id = d.id and &quot;</span><span class="o">+</span>\
           <span class="s">&quot;d.name = &quot;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>

<span class="c">##########</span>
<span class="c">#Generic functions to obtain FROM and WHERE clauses per type of report</span>
<span class="c">##########</span>
</div>
<div class="viewcode-block" id="GetITSSQLReportFrom"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetITSSQLReportFrom">[docs]</a><span class="k">def</span> <span class="nf">GetITSSQLReportFrom</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c">#generic function to generate &#39;from&#39; clauses</span>
    <span class="c">#&quot;type&quot; is a list of two values: type of analysis and value of </span>
    <span class="c">#such analysis</span>

    <span class="n">From</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">type_analysis</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span> <span class="k">return</span> <span class="n">From</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;repository&#39;</span><span class="p">:</span> <span class="n">From</span> <span class="o">=</span> <span class="n">GetITSSQLRepositoriesFrom</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;company&#39;</span><span class="p">:</span> <span class="n">From</span> <span class="o">=</span> <span class="n">GetITSSQLCompaniesFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;country&#39;</span><span class="p">:</span> <span class="n">From</span> <span class="o">=</span> <span class="n">GetITSSQLCountriesFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;domain&#39;</span><span class="p">:</span> <span class="n">From</span> <span class="o">=</span> <span class="n">GetITSSQLDomainsFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;project&#39;</span><span class="p">:</span> <span class="n">From</span> <span class="o">=</span> <span class="n">GetITSSQLProjectsFrom</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">From</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetITSSQLReportWhere"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetITSSQLReportWhere">[docs]</a><span class="k">def</span> <span class="nf">GetITSSQLReportWhere</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="c">#generic function to generate &#39;where&#39; clauses</span>

    <span class="c">#&quot;type&quot; is a list of two values: type of analysis and value of </span>
    <span class="c">#such analysis</span>
    <span class="n">where</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">type_analysis</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span> <span class="k">return</span> <span class="n">where</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;repository&#39;</span><span class="p">:</span> <span class="n">where</span> <span class="o">=</span> <span class="n">GetITSSQLRepositoriesWhere</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;company&#39;</span><span class="p">:</span> <span class="n">where</span> <span class="o">=</span> <span class="n">GetITSSQLCompaniesWhere</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;country&#39;</span><span class="p">:</span> <span class="n">where</span> <span class="o">=</span> <span class="n">GetITSSQLCountriesWhere</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;domain&#39;</span><span class="p">:</span> <span class="n">where</span> <span class="o">=</span> <span class="n">GetITSSQLDomainsWhere</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">analysis</span> <span class="o">==</span> <span class="s">&#39;project&#39;</span><span class="p">:</span> <span class="n">where</span> <span class="o">=</span> <span class="n">GetITSSQLProjectsWhere</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">where</span><span class="p">)</span>

<span class="c">##########</span>
<span class="c"># Meta functions to retrieve data</span>
<span class="c">##########</span>
</div>
<div class="viewcode-block" id="GetITSInfo"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetITSInfo">[docs]</a><span class="k">def</span> <span class="nf">GetITSInfo</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># Meta function to aggregate all of the evolutionary or</span>
    <span class="c"># aggregated functions</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">evolutionary</span><span class="p">):</span>
        <span class="n">closed</span> <span class="o">=</span> <span class="n">EvolIssuesClosed</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
        <span class="n">closed</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">closed</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="n">closers</span> <span class="o">=</span> <span class="n">EvolIssuesClosers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
        <span class="n">closers</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">closers</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="n">EvolIssuesChanged</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">changed</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="n">changers</span> <span class="o">=</span> <span class="n">EvolIssuesChangers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
        <span class="n">changers</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">changers</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="nb">open</span> <span class="o">=</span> <span class="n">EvolIssuesOpened</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
        <span class="nb">open</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="nb">open</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="n">openers</span> <span class="o">=</span> <span class="n">EvolIssuesOpeners</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
        <span class="n">openers</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">openers</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="n">repos</span> <span class="o">=</span> <span class="n">EvolIssuesRepositories</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
        <span class="n">repos</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">repos</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">closed</span> <span class="o">=</span> <span class="n">AggIssuesClosed</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
        <span class="n">closers</span> <span class="o">=</span> <span class="n">AggIssuesClosers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="n">AggIssuesChanged</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
        <span class="n">changers</span> <span class="o">=</span> <span class="n">AggIssuesChangers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
        <span class="nb">open</span> <span class="o">=</span> <span class="n">AggIssuesOpened</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
        <span class="n">openers</span> <span class="o">=</span> <span class="n">AggIssuesOpeners</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
        <span class="n">repos</span> <span class="o">=</span> <span class="n">AggIssuesRepositories</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
        <span class="n">init_date</span> <span class="o">=</span> <span class="n">GetInitDate</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">GetEndDate</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>

        <span class="c"># Data from the last 365 days</span>
        <span class="n">fromdate</span> <span class="o">=</span> <span class="n">GetDates</span><span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="mi">365</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">closed_365</span> <span class="o">=</span> <span class="n">AggIssuesClosed</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
        <span class="n">closers_365</span> <span class="o">=</span> <span class="n">AggIssuesClosers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">fromdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
        <span class="n">closed</span><span class="p">[</span><span class="s">&#39;closed_365&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">closed_365</span><span class="p">[</span><span class="s">&#39;closed&#39;</span><span class="p">]</span>
        <span class="n">closers</span><span class="p">[</span><span class="s">&#39;closers_365&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">closers_365</span><span class="p">[</span><span class="s">&#39;closers&#39;</span><span class="p">]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">closed</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">closers</span><span class="o">.</span><span class="n">items</span><span class="p">()</span><span class="o">+</span> <span class="n">changed</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">changers</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="nb">open</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">openers</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">repos</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">evolutionary</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">init_date</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">end_date</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="EvolITSInfo"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.EvolITSInfo">[docs]</a><span class="k">def</span> <span class="nf">EvolITSInfo</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="c">#Evolutionary info all merged in a dataframe</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetITSInfo</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AggITSInfo"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.AggITSInfo">[docs]</a><span class="k">def</span> <span class="nf">AggITSInfo</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="c">#Agg info all merged in a dataframe</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetITSInfo</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>

<span class="c">#TODO: check the differences between function GetCurrentOpened and GetEvolClosed,</span>
<span class="c"># GetEvolOpened, etc... in some cases such as opened, openers, closed, closers, </span>
<span class="c"># changed and changers is more than enough to just count changes in table changes</span>
<span class="c"># opened when the issue was submitted (and submitted by) and closers providing the</span>
<span class="c"># closed condition. Do we get whe same results if using the Backlog table?</span>
</div>
<div class="viewcode-block" id="GetOpened"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetOpened">[docs]</a><span class="k">def</span> <span class="nf">GetOpened</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c">#This function returns the evolution or agg number of opened issues</span>
    <span class="c">#This function can be also reproduced using the Backlog function.</span>
    <span class="c">#However this function is less time expensive.</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(i.id)) as opened &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; issues i &quot;</span><span class="o">+</span> <span class="n">GetITSSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetITSSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; submitted_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AggIssuesOpened"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.AggIssuesOpened">[docs]</a><span class="k">def</span> <span class="nf">AggIssuesOpened</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># Returns aggregated number of opened issues</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetOpened</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolIssuesOpened"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.EvolIssuesOpened">[docs]</a><span class="k">def</span> <span class="nf">EvolIssuesOpened</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c">#return(GetEvolBacklogTickets(period, startdate, enddate, status, name.logtable, filter))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetOpened</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="GetOpeners"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetOpeners">[docs]</a><span class="k">def</span> <span class="nf">GetOpeners</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="c">#This function returns the evolution or agg number of people opening issues</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(pup.upeople_id)) as openers &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; issues i &quot;</span> <span class="o">+</span> <span class="n">GetITSSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetITSSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">type_analysis</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
        <span class="c">#Specific case for the basic option where people_upeople table is needed</span>
        <span class="c">#and not taken into account in the initial part of the query</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;, people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and i.submitted_by = pup.people_id&quot;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span> <span class="ow">or</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;project&quot;</span><span class="p">):</span>
        <span class="c">#Adding people_upeople table</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;, people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and i.submitted_by = pup.people_id &quot;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; submitted_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="AggIssuesOpeners"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.AggIssuesOpeners">[docs]</a><span class="k">def</span> <span class="nf">AggIssuesOpeners</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="c"># Returns aggregated number of opened issues</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetOpeners</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolIssuesOpeners"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.EvolIssuesOpeners">[docs]</a><span class="k">def</span> <span class="nf">EvolIssuesOpeners</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="c">#return(GetEvolBacklogTickets(period, startdate, enddate, status, name.logtable, filter))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetOpeners</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="GetClosed"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetClosed">[docs]</a><span class="k">def</span> <span class="nf">GetClosed</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="c">#This function returns the evolution or agg number of closed issues</span>
    <span class="c">#This function can be also reproduced using the Backlog function.</span>
    <span class="c">#However this function is less time expensive.</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(i.id)) as closed &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; issues i, changes ch &quot;</span> <span class="o">+</span> <span class="n">GetITSSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>

    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; i.id = ch.issue_id and &quot;</span> <span class="o">+</span> <span class="n">closed_condition</span> 
    <span class="n">filters_ext</span> <span class="o">=</span> <span class="n">GetITSSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">filters_ext</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and &quot;</span> <span class="o">+</span> <span class="n">filters_ext</span>
    <span class="c">#Action needed to replace issues filters by changes one</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;i.submitted&quot;</span><span class="p">,</span> <span class="s">&quot;ch.changed&quot;</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; ch.changed_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AggIssuesClosed"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.AggIssuesClosed">[docs]</a><span class="k">def</span> <span class="nf">AggIssuesClosed</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="c"># Returns aggregated number of closed issues</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetClosed</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolIssuesClosed"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.EvolIssuesClosed">[docs]</a><span class="k">def</span> <span class="nf">EvolIssuesClosed</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="c">#return(GetEvolBacklogTickets(period, startdate, enddate, status, name.logtable, filter))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetClosed</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="GetClosers"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetClosers">[docs]</a><span class="k">def</span> <span class="nf">GetClosers</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="c">#This function returns the evolution or agg number of closed issues</span>
    <span class="c">#This function can be also reproduced using the Backlog function.</span>
    <span class="c">#However this function is less time expensive.</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(pup.upeople_id)) as closers &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; issues i, changes ch &quot;</span> <span class="o">+</span> <span class="n">GetITSSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>

    <span class="c">#closed condition filters</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; i.id = ch.issue_id and &quot;</span> <span class="o">+</span> <span class="n">closed_condition</span>
    <span class="n">filters_ext</span> <span class="o">=</span> <span class="n">GetITSSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">filters_ext</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and &quot;</span> <span class="o">+</span> <span class="n">filters_ext</span>
    <span class="c">#unique identities filters</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type_analysis</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
        <span class="c">#Specific case for the basic option where people_upeople table is needed</span>
        <span class="c">#and not taken into account in the initial part of the query</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;, people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and i.submitted_by = pup.people_id&quot;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span> <span class="ow">or</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;project&quot;</span><span class="p">):</span>
        <span class="c">#Adding people_upeople table</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;, people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and i.submitted_by = pup.people_id &quot;</span>

    <span class="c">#Action needed to replace issues filters by changes one</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;i.submitted&quot;</span><span class="p">,</span> <span class="s">&quot;ch.changed&quot;</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; ch.changed_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AggIssuesClosers"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.AggIssuesClosers">[docs]</a><span class="k">def</span> <span class="nf">AggIssuesClosers</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="c"># Returns aggregated number of closed issues</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetClosers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolIssuesClosers"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.EvolIssuesClosers">[docs]</a><span class="k">def</span> <span class="nf">EvolIssuesClosers</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="c">#return(GetEvolBacklogTickets(period, startdate, enddate, status, name.logtable, filter))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetClosers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="GetChanged"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetChanged">[docs]</a><span class="k">def</span> <span class="nf">GetChanged</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c">#This function returns the evolution or agg number of changed issues</span>
    <span class="c">#This function can be also reproduced using the Backlog function.</span>
    <span class="c">#However this function is less time expensive.</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(ch.issue_id)) as changed &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; issues i, changes ch &quot;</span> <span class="o">+</span> <span class="n">GetITSSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>

    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; i.id = ch.issue_id &quot;</span>
    <span class="n">filters_ext</span> <span class="o">=</span> <span class="n">GetITSSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">filters_ext</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and &quot;</span> <span class="o">+</span> <span class="n">filters_ext</span>

    <span class="c">#Action needed to replace issues filters by changes one</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;i.submitted&quot;</span><span class="p">,</span> <span class="s">&quot;ch.changed&quot;</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; ch.changed_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="AggIssuesChanged"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.AggIssuesChanged">[docs]</a><span class="k">def</span> <span class="nf">AggIssuesChanged</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># Returns aggregated number of closed issues</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetChanged</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolIssuesChanged"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.EvolIssuesChanged">[docs]</a><span class="k">def</span> <span class="nf">EvolIssuesChanged</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetChanged</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GetChangers"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetChangers">[docs]</a><span class="k">def</span> <span class="nf">GetChangers</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c">#This function returns the evolution or agg number of changed issues</span>
    <span class="c">#This function can be also reproduced using the Backlog function.</span>
    <span class="c">#However this function is less time expensive.</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; count(distinct(pup.upeople_id)) as changers &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; issues i, changes ch &quot;</span> <span class="o">+</span> <span class="n">GetITSSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>

    <span class="n">filters</span> <span class="o">=</span> <span class="s">&quot; i.id = ch.issue_id &quot;</span>
    <span class="n">filters_ext</span> <span class="o">=</span> <span class="n">GetITSSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">filters_ext</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and &quot;</span> <span class="o">+</span> <span class="n">filters_ext</span>

    <span class="c">#unique identities filters</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">type_analysis</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
        <span class="c">#Specific case for the basic option where people_upeople table is needed</span>
        <span class="c">#and not taken into account in the initial part of the query</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;, people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and i.submitted_by = pup.people_id&quot;</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;repository&quot;</span><span class="ow">or</span> <span class="n">type_analysis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;project&quot;</span><span class="p">):</span>
        <span class="c">#Adding people_upeople table</span>
        <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;, people_upeople pup&quot;</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; and i.submitted_by = pup.people_id &quot;</span>

    <span class="c">#Action needed to replace issues filters by changes one</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;i.submitted&quot;</span><span class="p">,</span> <span class="s">&quot;ch.changed&quot;</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; ch.changed_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AggIssuesChangers"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.AggIssuesChangers">[docs]</a><span class="k">def</span> <span class="nf">AggIssuesChangers</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># Returns aggregated number of closed issues</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetChangers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolIssuesChangers"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.EvolIssuesChangers">[docs]</a><span class="k">def</span> <span class="nf">EvolIssuesChangers</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetChangers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>

<span class="c"># Repositories</span></div>
<div class="viewcode-block" id="GetIssuesRepositories"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetIssuesRepositories">[docs]</a><span class="k">def</span> <span class="nf">GetIssuesRepositories</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">):</span>
    <span class="c"># Generic function that counts repositories</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; COUNT(DISTINCT(tracker_id)) AS trackers  &quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; issues i &quot;</span> <span class="o">+</span> <span class="n">GetITSSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetITSSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; i.submitted_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolIssuesRepositories"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.EvolIssuesRepositories">[docs]</a><span class="k">def</span> <span class="nf">EvolIssuesRepositories</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="c"># Evolution of trackers</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetIssuesRepositories</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AggIssuesRepositories"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.AggIssuesRepositories">[docs]</a><span class="k">def</span> <span class="nf">AggIssuesRepositories</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="c"># Evolution of trackers</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetIssuesRepositories</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="GetIssuesStudies"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetIssuesStudies">[docs]</a><span class="k">def</span> <span class="nf">GetIssuesStudies</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">,</span> <span class="n">study</span><span class="p">):</span>
    <span class="c"># Generic function that counts evolution/agg number of specific studies with similar</span>
    <span class="c"># database schema such as domains, companies and countries</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&#39; count(distinct(name)) as &#39;</span> <span class="o">+</span> <span class="n">study</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; issues i &quot;</span> <span class="o">+</span> <span class="n">GetITSSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetITSSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="c">#Filtering last part of the query, not used in this case</span>
    <span class="c">#filters = gsub(&quot;and\n( )+(d|c|cou|com).name =.*$&quot;, &quot;&quot;, filters)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; i.submitted_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">evolutionary</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;and (d|c|cou|com).name.*=&#39;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="EvolIssuesDomains"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.EvolIssuesDomains">[docs]</a><span class="k">def</span> <span class="nf">EvolIssuesDomains</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">):</span>
    <span class="c"># Evol number of domains used</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetIssuesStudies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;domain&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;domains&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolIssuesProjects"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.EvolIssuesProjects">[docs]</a><span class="k">def</span> <span class="nf">EvolIssuesProjects</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">):</span>
    <span class="c"># Evol number of projects used</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetIssuesStudies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;project&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;projects&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolIssuesCountries"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.EvolIssuesCountries">[docs]</a><span class="k">def</span> <span class="nf">EvolIssuesCountries</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">):</span>
    <span class="c"># Evol number of countries</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetIssuesStudies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;country&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;countries&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="EvolIssuesCompanies"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.EvolIssuesCompanies">[docs]</a><span class="k">def</span> <span class="nf">EvolIssuesCompanies</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">):</span>
    <span class="c"># Evol number of companies</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">GetIssuesStudies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;company&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;companies&#39;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AggIssuesDomains"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.AggIssuesDomains">[docs]</a><span class="k">def</span> <span class="nf">AggIssuesDomains</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">):</span>
    <span class="c"># Agg number of domains</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetIssuesStudies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;domain&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">],</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;domains&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AggIssuesProjects"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.AggIssuesProjects">[docs]</a><span class="k">def</span> <span class="nf">AggIssuesProjects</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">):</span>
    <span class="c"># Agg number of projects</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetIssuesStudies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;project&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">],</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;projects&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AggIssuesCountries"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.AggIssuesCountries">[docs]</a><span class="k">def</span> <span class="nf">AggIssuesCountries</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">):</span>
    <span class="c"># Agg number of countries</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetIssuesStudies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;country&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">],</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;countries&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AggIssuesCompanies"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.AggIssuesCompanies">[docs]</a><span class="k">def</span> <span class="nf">AggIssuesCompanies</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">):</span>
    <span class="c"># Agg number of companies</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetIssuesStudies</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;company&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">],</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;companies&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="GetDate"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetDate">[docs]</a><span class="k">def</span> <span class="nf">GetDate</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
    <span class="c"># date of submmitted issues (type= max or min)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="o">==</span><span class="s">&quot;max&quot;</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; DATE_FORMAT (max(submitted_on), &#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;) as last_date&quot;</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; DATE_FORMAT (min(submitted_on), &#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;) as first_date&quot;</span>

    <span class="n">tables</span> <span class="o">=</span> <span class="s">&quot; issues i &quot;</span> <span class="o">+</span> <span class="n">GetITSSQLReportFrom</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetITSSQLReportWhere</span><span class="p">(</span><span class="n">type_analysis</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">BuildQuery</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="s">&quot; i.submitted_on &quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetInitDate"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetInitDate">[docs]</a><span class="k">def</span> <span class="nf">GetInitDate</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c">#Initial date of submitted issues</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetDate</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;min&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="GetEndDate"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetEndDate">[docs]</a><span class="k">def</span> <span class="nf">GetEndDate</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c">#End date of submitted issues</span>
    <span class="k">return</span><span class="p">(</span><span class="n">GetDate</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="s">&quot;max&quot;</span><span class="p">))</span>

<span class="c">##----------------------</span>
<span class="c">## Auxiliary functions querying the database</span>
<span class="c">##----------------------</span>
</div>
<div class="viewcode-block" id="get_timespan"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.get_timespan">[docs]</a><span class="k">def</span> <span class="nf">get_timespan</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get timespan found in the ITS database.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    startdate : datetime.datetime</span>
<span class="sd">        Time of first activity in tickets</span>
<span class="sd">    enddate : datetime.datetime</span>
<span class="sd">        Time of last activity in tickets</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    Looks for entries both in issues and changes tables.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;SELECT</span>
<span class="s">          DATE(MIN(DATE)) as startdate,</span>
<span class="s">          DATE(MAX(date)) as enddate</span>
<span class="s">      FROM</span>
<span class="s">          (SELECT submitted_on AS date FROM issues</span>
<span class="s">           UNION ALL</span>
<span class="s">           SELECT changed_on AS date FROM changes) AS dates&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="c"># Returns [first time, last_time]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;startdate&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;enddate&#39;</span><span class="p">])</span>

<span class="c">###############</span>
<span class="c"># Others</span>
<span class="c">###############</span>
</div>
<div class="viewcode-block" id="AggAllParticipants"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.AggAllParticipants">[docs]</a><span class="k">def</span> <span class="nf">AggAllParticipants</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
    <span class="c"># All participants from the whole history</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT count(distinct(pup.upeople_id)) as allhistory_participants from people_upeople pup&quot;</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="TrackerURL"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.TrackerURL">[docs]</a><span class="k">def</span> <span class="nf">TrackerURL</span> <span class="p">():</span>
    <span class="c"># URL of the analyzed tracker</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT url, name as type FROM trackers t JOIN &quot;</span><span class="o">+</span>\
        <span class="s">&quot;supported_trackers s ON t.type = s.id limit 1&quot;</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

<span class="c">###############</span>
<span class="c"># Lists of repositories, companies, countries and other analysis</span>
<span class="c">###############</span>
</div>
<div class="viewcode-block" id="GetReposNameITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetReposNameITS">[docs]</a><span class="k">def</span> <span class="nf">GetReposNameITS</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># List the url of each of the repositories analyzed</span>
    <span class="c"># Those are order by the number of opened issues (dec order)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot; SELECT t.url as name &quot;</span><span class="o">+</span>\
               <span class="s">&quot;   FROM issues i, &quot;</span><span class="o">+</span>\
               <span class="s">&quot;        trackers t &quot;</span><span class="o">+</span>\
               <span class="s">&quot;   WHERE i.tracker_id=t.id and &quot;</span><span class="o">+</span>\
               <span class="s">&quot;         i.submitted_on &gt;= &quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
               <span class="s">&quot;         i.submitted_on &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span>\
               <span class="s">&quot;   GROUP BY t.url  &quot;</span><span class="o">+</span>\
               <span class="s">&quot;   ORDER BY count(distinct(i.id)) DESC &quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="get_projects_name"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.get_projects_name">[docs]</a><span class="k">def</span> <span class="nf">get_projects_name</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># Projects activity needs to include subprojects also</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span> <span class="p">(</span><span class="s">&quot;Getting projects list for ITS&quot;</span><span class="p">)</span>

    <span class="c"># Get all projects list</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT p.id AS name FROM  </span><span class="si">%s</span><span class="s">.projects p&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">identities_db</span><span class="p">)</span>
    <span class="n">projects</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c"># Loop all projects getting reviews</span>
    <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">projects</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]:</span>
        <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;project&#39;</span><span class="p">,</span> <span class="n">project</span><span class="p">]</span>
        <span class="n">period</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">issues</span> <span class="o">=</span> <span class="n">AggIssuesClosed</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span>
                                  <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
        <span class="n">issues</span> <span class="o">=</span> <span class="n">issues</span><span class="p">[</span><span class="s">&#39;closed&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">issues</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">issues</span><span class="p">,</span><span class="n">project</span><span class="p">])</span>

    <span class="c"># Order the list using reviews: https://wiki.python.org/moin/HowTo/Sorting</span>
    <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
    <span class="n">data_sort</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">data_sort</span><span class="p">]</span>

    <span class="k">return</span><span class="p">({</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="n">names</span><span class="p">})</span>
</div>
<div class="viewcode-block" id="GetTablesDomainsITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetTablesDomainsITS">[docs]</a><span class="k">def</span> <span class="nf">GetTablesDomainsITS</span> <span class="p">(</span><span class="n">i_db</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">GetTablesOwnUniqueIdsITS</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="s">&#39;,&#39;</span><span class="o">+</span><span class="n">i_db</span><span class="o">+</span><span class="s">&#39;.upeople_domains upd&#39;</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetFiltersDomainsITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetFiltersDomainsITS">[docs]</a><span class="k">def</span> <span class="nf">GetFiltersDomainsITS</span> <span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetFiltersOwnUniqueIdsITS</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; AND pup.upeople_id = upd.upeople_id&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetDomainsNameITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetDomainsNameITS">[docs]</a><span class="k">def</span> <span class="nf">GetDomainsNameITS</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="nb">filter</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">affiliations</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">aff</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">:</span>
        <span class="n">affiliations</span> <span class="o">+=</span> <span class="s">&quot; dom.name&lt;&gt;&#39;&quot;</span><span class="o">+</span><span class="n">aff</span><span class="o">+</span><span class="s">&quot;&#39; and &quot;</span>

    <span class="n">tables</span> <span class="o">=</span> <span class="n">GetTablesDomainsITS</span><span class="p">(</span><span class="n">identities_db</span><span class="p">)</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="s">&quot;,&quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.domains dom&quot;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT dom.name &quot;</span><span class="o">+</span>\
        <span class="s">&quot;FROM &quot;</span><span class="o">+</span> <span class="n">tables</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;WHERE &quot;</span> <span class="o">+</span> <span class="n">GetFiltersDomainsITS</span><span class="p">()</span> <span class="o">+</span><span class="s">&quot; AND &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       dom.id = upd.domain_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       &quot;</span><span class="o">+</span> <span class="n">affiliations</span> <span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       c.changed_on &gt;= &quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; AND &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       c.changed_on &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; AND &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       &quot;</span><span class="o">+</span> <span class="n">closed_condition</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;GROUP BY dom.name &quot;</span><span class="o">+</span>\
        <span class="s">&quot;ORDER BY COUNT(DISTINCT(c.issue_id)) DESC&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetCountriesNamesITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetCountriesNamesITS">[docs]</a><span class="k">def</span> <span class="nf">GetCountriesNamesITS</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span> <span class="p">:</span>
    <span class="c"># List each of the countries analyzed</span>
    <span class="c"># Those are order by number of closed issues</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select cou.name &quot;</span><span class="o">+</span>\
        <span class="s">&quot;from issues i, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     changes ch, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span> <span class="n">identities_db</span><span class="o">+</span> <span class="s">&quot;.upeople_countries upc, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span> <span class="n">identities_db</span><span class="o">+</span> <span class="s">&quot;.countries cou &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where i.id = ch.issue_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      ch.changed_by = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      pup.upeople_id = upc.upeople_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      upc.country_id = cou.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      ch.changed_on &gt;= &quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      ch.changed_on &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span><span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      &quot;</span><span class="o">+</span> <span class="n">closed_condition</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      group by cou.name  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      order by count(distinct(i.id)) desc&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetCompaniesNameITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetCompaniesNameITS">[docs]</a><span class="k">def</span> <span class="nf">GetCompaniesNameITS</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="nb">filter</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">affiliations</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">aff</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">:</span>
        <span class="n">affiliations</span> <span class="o">+=</span> <span class="s">&quot; c.name&lt;&gt;&#39;&quot;</span><span class="o">+</span><span class="n">aff</span><span class="o">+</span><span class="s">&quot;&#39; and &quot;</span>

    <span class="c"># list each of the companies analyzed</span>
    <span class="c"># those are order by number of closed issues</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select c.name &quot;</span><span class="o">+</span>\
        <span class="s">&quot;from issues i, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     changes ch, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     people_upeople pup, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span> <span class="n">identities_db</span><span class="o">+</span> <span class="s">&quot;.upeople_companies upc, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span> <span class="n">identities_db</span><span class="o">+</span> <span class="s">&quot;.companies c &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where i.id = ch.issue_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      ch.changed_by = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      pup.upeople_id = upc.upeople_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      upc.company_id = c.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      ch.changed_on &gt;= &quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      ch.changed_on &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span><span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      i.submitted_on &gt;= upc.init and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      i.submitted_on &lt; upc.end and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      &quot;</span><span class="o">+</span> <span class="n">affiliations</span>  <span class="o">+</span>\
               <span class="n">closed_condition</span> <span class="o">+</span>\
        <span class="s">&quot;      group by c.name  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      order by count(distinct(i.id)) desc&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c">################</span>
<span class="c"># Last activity functions</span>
<span class="c">################</span>


<span class="c">##</span>
<span class="c">## GetDiffClosedDays</span>
<span class="c">##</span>
<span class="c">## Get differences in number of closed tickets between two periods.</span>
<span class="c">##  - date: final date of the two periods.</span>
<span class="c">##  - days: number of days for each period.</span>
<span class="c">##  - closed_condition: SQL string to define the condition of &quot;closed&quot;</span>
<span class="c">##     for a ticket</span>
<span class="c">## Example of parameters, for analizing the difference during the last</span>
<span class="c">##  two weeks for the day 2013-11-25:</span>
<span class="c">##  (date=&quot;2013-11-25&quot;, days=7, closed_condition=...)</span>
<span class="c">##</span></div>
<div class="viewcode-block" id="GetDiffClosedDays"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetDiffClosedDays">[docs]</a><span class="k">def</span> <span class="nf">GetDiffClosedDays</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="n">chardates</span> <span class="o">=</span> <span class="n">GetDates</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">AggIssuesClosed</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;closed&#39;</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">AggIssuesClosed</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s">&#39;closed&#39;</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;diff_netclosed_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">prev</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;percentage_closed_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GetPercentageDiff</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
    <span class="c"># data[&#39;closed_&#39;+str(days)] = last</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c">##</span>
<span class="c">## GetDiffClosersDays</span>
<span class="c">##</span>
<span class="c">## Get differences in number of ticket closers between two periods.</span>
<span class="c">##  - date: final date of the two periods.</span>
<span class="c">##  - days: number of days for each period.</span>
<span class="c">##  - closed_condition: SQL string to define the condition of &quot;closed&quot;</span>
<span class="c">##     for a ticket</span>
<span class="c">## Example of parameters, for analizing the difference during the last</span>
<span class="c">##  two weeks for the day 2013-11-25:</span>
<span class="c">##  (date=&quot;2013-11-25&quot;, days=7, closed_condition=...)</span>
<span class="c">##</span></div>
<div class="viewcode-block" id="GetDiffClosersDays"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetDiffClosersDays">[docs]</a><span class="k">def</span> <span class="nf">GetDiffClosersDays</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="c"># This function provides the percentage in activity between two periods</span>
    <span class="n">chardates</span> <span class="o">=</span> <span class="n">GetDates</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">AggIssuesClosers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;closers&#39;</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">AggIssuesClosers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s">&#39;closers&#39;</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;diff_netclosers_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">prev</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;percentage_closers_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GetPercentageDiff</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
    <span class="c"># data[&#39;closers_&#39;+str(days)] = last</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetDiffOpenedDays"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetDiffOpenedDays">[docs]</a><span class="k">def</span> <span class="nf">GetDiffOpenedDays</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># This function provides the percentage in activity between two periods</span>
    <span class="n">chardates</span> <span class="o">=</span> <span class="n">GetDates</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">AggIssuesOpened</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;opened&#39;</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">AggIssuesOpened</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s">&#39;opened&#39;</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;diff_netopened_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">prev</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;percentage_opened_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GetPercentageDiff</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
    <span class="c">#data[&#39;opened_&#39;+str(days)] = last</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetDiffChangersDays"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetDiffChangersDays">[docs]</a><span class="k">def</span> <span class="nf">GetDiffChangersDays</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">):</span>
    <span class="c"># This function provides the percentage in activity between two periods</span>
    <span class="n">chardates</span> <span class="o">=</span> <span class="n">GetDates</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">AggIssuesChangers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;changers&#39;</span><span class="p">])</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">AggIssuesChangers</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">chardates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prev</span><span class="p">[</span><span class="s">&#39;changers&#39;</span><span class="p">])</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;diff_netchangers_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">last</span> <span class="o">-</span> <span class="n">prev</span>
    <span class="n">data</span><span class="p">[</span><span class="s">&#39;percentage_changers_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)]</span> <span class="o">=</span> <span class="n">GetPercentageDiff</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
    <span class="c"># data[&#39;changers_&#39;+str(days)] = last</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetLastActivityITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetLastActivityITS">[docs]</a><span class="k">def</span> <span class="nf">GetLastActivityITS</span> <span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="c"># opened issues</span>
    <span class="n">days</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select count(*) as opened_&quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;from issues &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where submitted_on &gt;= ( &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      select (max(submitted_on) - INTERVAL &quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; day) &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      from issues)&quot;</span>

    <span class="n">data1</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="c"># closed issues</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;select count(distinct(issue_id)) as closed_&quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;from changes &quot;</span><span class="o">+</span>\
        <span class="s">&quot;where  &quot;</span><span class="o">+</span><span class="n">closed_condition</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;and changed_on &gt;= ( &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      select (max(changed_on) - INTERVAL &quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; day) &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      from changes)&quot;</span>

    <span class="n">data2</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="c"># closers</span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT count(distinct(pup.upeople_id)) as closers_&quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
         <span class="s">&quot;FROM changes, people_upeople pup &quot;</span><span class="o">+</span>\
         <span class="s">&quot;WHERE pup.people_id = changes.changed_by and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;changed_on &gt;= ( &quot;</span><span class="o">+</span>\
         <span class="s">&quot;    select (max(changed_on) - INTERVAL &quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; day) &quot;</span><span class="o">+</span>\
         <span class="s">&quot;     from changes) AND &quot;</span><span class="o">+</span> <span class="n">closed_condition</span>


    <span class="n">data3</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="c"># people_involved    </span>
    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT count(distinct(pup.upeople_id)) as changers_&quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
         <span class="s">&quot;FROM changes, people_upeople pup &quot;</span><span class="o">+</span>\
         <span class="s">&quot;WHERE pup.people_id = changes.changed_by and &quot;</span><span class="o">+</span>\
         <span class="s">&quot;changed_on &gt;= ( &quot;</span><span class="o">+</span>\
         <span class="s">&quot;    select (max(changed_on) - INTERVAL &quot;</span><span class="o">+</span><span class="n">days</span><span class="o">+</span><span class="s">&quot; day) &quot;</span><span class="o">+</span>\
         <span class="s">&quot;     from changes)&quot;</span>

    <span class="n">data4</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="n">agg_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data1</span><span class="o">.</span><span class="n">items</span><span class="p">()</span><span class="o">+</span><span class="n">data2</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">agg_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">agg_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span><span class="o">+</span><span class="n">data3</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">agg_data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetActiveChangersITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetActiveChangersITS">[docs]</a><span class="k">def</span> <span class="nf">GetActiveChangersITS</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
    <span class="c"># FIXME parameters should be: startdate and enddate</span>
    <span class="n">q0</span> <span class="o">=</span> <span class="s">&quot;SELECT distinct(pup.upeople_id) as active_changers&quot;</span><span class="o">+</span>\
        <span class="s">&quot; FROM changes, people_upeople pup &quot;</span><span class="o">+</span>\
        <span class="s">&quot; WHERE pup.people_id = changes.changed_by and &quot;</span><span class="o">+</span>\
        <span class="s">&quot; changed_on &gt;= ( </span><span class="si">%s</span><span class="s"> - INTERVAL </span><span class="si">%s</span><span class="s"> day)&quot;</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="n">q0</span> <span class="o">%</span> <span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetActiveCommentersITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetActiveCommentersITS">[docs]</a><span class="k">def</span> <span class="nf">GetActiveCommentersITS</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
    <span class="c"># FIXME parameters should be: startdate and enddate</span>
    <span class="n">q0</span> <span class="o">=</span> <span class="s">&quot;SELECT DISTINCT(pup.upeople_id) AS active_commenters&quot;</span><span class="o">+</span>\
        <span class="s">&quot; FROM comments c, people_upeople pup&quot;</span><span class="o">+</span>\
        <span class="s">&quot; WHERE pup.people_id = c.submitted_by AND&quot;</span><span class="o">+</span>\
        <span class="s">&quot; submitted_on &gt;= (</span><span class="si">%s</span><span class="s"> - INTERVAL </span><span class="si">%s</span><span class="s"> day)&quot;</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="n">q0</span> <span class="o">%</span> <span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetActiveSubmittersITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetActiveSubmittersITS">[docs]</a><span class="k">def</span> <span class="nf">GetActiveSubmittersITS</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
    <span class="c"># FIXME parameters should be: startdate and enddate</span>
    <span class="n">q0</span> <span class="o">=</span> <span class="s">&quot;SELECT DISTINCT(pup.upeople_id) AS active_submitters&quot;</span><span class="o">+</span>\
      <span class="s">&quot; FROM issues i, people_upeople pup&quot;</span><span class="o">+</span>\
      <span class="s">&quot; WHERE pup.people_id = i.submitted_by AND&quot;</span><span class="o">+</span>\
      <span class="s">&quot; submitted_on &gt;= ( </span><span class="si">%s</span><span class="s"> - INTERVAL </span><span class="si">%s</span><span class="s"> day)&quot;</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="n">q0</span> <span class="o">%</span> <span class="p">(</span><span class="n">enddate</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetActivePeopleITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetActivePeopleITS">[docs]</a><span class="k">def</span> <span class="nf">GetActivePeopleITS</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">enddate</span><span class="p">):</span>
    <span class="c">#Gets the IDs of the active people during the last days (until enddate)</span>
    <span class="c"># for comments, issue creation and changes</span>
    <span class="n">submitters</span> <span class="o">=</span> <span class="n">GetActiveSubmittersITS</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">changers</span> <span class="o">=</span> <span class="n">GetActiveChangersITS</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">commenters</span> <span class="o">=</span> <span class="n">GetActiveCommentersITS</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">people_its</span> <span class="o">=</span> <span class="n">submitters</span><span class="p">[</span><span class="s">&#39;active_submitters&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">changers</span><span class="p">[</span><span class="s">&#39;active_changers&#39;</span><span class="p">]</span> <span class="o">+</span>\
        <span class="n">commenters</span><span class="p">[</span><span class="s">&#39;active_commenters&#39;</span><span class="p">]</span>
    <span class="n">people_its</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">people_its</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">people_its</span><span class="p">)</span>


<span class="c">################</span>
<span class="c"># Top functions</span>
<span class="c">################</span>
</div>
<div class="viewcode-block" id="GetTopClosersByAssignee"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetTopClosersByAssignee">[docs]</a><span class="k">def</span> <span class="nf">GetTopClosersByAssignee</span> <span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="nb">filter</span><span class="p">)</span> <span class="p">:</span>

    <span class="n">affiliations</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">aff</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">:</span>
        <span class="n">affiliations</span> <span class="o">+=</span> <span class="s">&quot; com.name&lt;&gt;&#39;&quot;</span><span class="o">+</span> <span class="n">aff</span> <span class="o">+</span><span class="s">&quot;&#39; and &quot;</span>

    <span class="n">date_limit</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">days</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;SELECT @maxdate:=max(changed_on) from changes limit 1&quot;</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="n">date_limit</span> <span class="o">=</span> <span class="s">&quot; AND DATEDIFF(@maxdate, changed_on)&lt;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT up.id as id, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       up.identifier as closers, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       count(distinct(ill.issue_id)) as closed &quot;</span><span class="o">+</span>\
        <span class="s">&quot;FROM people_upeople pup,  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span> <span class="n">identities_db</span><span class="o">+</span> <span class="s">&quot;.upeople_companies upc, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span> <span class="n">identities_db</span><span class="o">+</span> <span class="s">&quot;.upeople up,  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span> <span class="n">identities_db</span><span class="o">+</span> <span class="s">&quot;.companies com, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     issues_log_launchpad ill  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;WHERE ill.assigned_to = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      pup.upeople_id = up.id and  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      up.id = upc.upeople_id and  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      upc.company_id = com.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      &quot;</span><span class="o">+</span> <span class="n">affiliations</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      ill.date &gt;= upc.init and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      ill.date &lt; upc.end and  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      ill.change_id  in (  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;         select id &quot;</span><span class="o">+</span>\
        <span class="s">&quot;         from changes  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;         where new_value=&#39;Fix Committed&#39; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;               changed_on&gt;=&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and  &quot;</span><span class="o">+</span>\
        <span class="s">&quot;               changed_on&lt;&quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span> <span class="n">date_limit</span><span class="o">+</span><span class="s">&quot;) &quot;</span><span class="o">+</span>\
        <span class="s">&quot;GROUP BY up.identifier &quot;</span><span class="o">+</span>\
        <span class="s">&quot;ORDER BY closed desc, closers limit 10&quot;</span>


    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetTablesOwnUniqueIdsITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetTablesOwnUniqueIdsITS">[docs]</a><span class="k">def</span> <span class="nf">GetTablesOwnUniqueIdsITS</span> <span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="s">&#39;changes c, people_upeople pup&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">table</span> <span class="o">==</span> <span class="s">&quot;issues&quot;</span><span class="p">):</span> <span class="n">tables</span> <span class="o">=</span> <span class="s">&#39;issues i, people_upeople pup&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">tables</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetTablesCompaniesITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetTablesCompaniesITS">[docs]</a><span class="k">def</span> <span class="nf">GetTablesCompaniesITS</span> <span class="p">(</span><span class="n">i_db</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">GetTablesOwnUniqueIdsITS</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="n">tables</span> <span class="o">+=</span> <span class="s">&#39;,&#39;</span><span class="o">+</span><span class="n">i_db</span><span class="o">+</span><span class="s">&#39;.upeople_companies upc&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">tables</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetFiltersOwnUniqueIdsITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetFiltersOwnUniqueIdsITS">[docs]</a><span class="k">def</span> <span class="nf">GetFiltersOwnUniqueIdsITS</span> <span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="s">&#39;pup.people_id = c.changed_by&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">table</span> <span class="o">==</span> <span class="s">&quot;issues&quot;</span><span class="p">):</span> <span class="n">filters</span> <span class="o">=</span> <span class="s">&#39;pup.people_id = i.submitted_by&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">filters</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetFiltersCompaniesITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetFiltersCompaniesITS">[docs]</a><span class="k">def</span> <span class="nf">GetFiltersCompaniesITS</span> <span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetFiltersOwnUniqueIdsITS</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; AND pup.upeople_id = upc.upeople_id&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">table</span> <span class="o">==</span> <span class="s">&#39;issues&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; AND submitted_on &gt;= upc.init AND submitted_on &lt; upc.end&quot;</span>
    <span class="k">else</span> <span class="p">:</span>
         <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; AND changed_on &gt;= upc.init AND changed_on &lt; upc.end&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">filters</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetCompanyTopClosers"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetCompanyTopClosers">[docs]</a><span class="k">def</span> <span class="nf">GetCompanyTopClosers</span> <span class="p">(</span><span class="n">company_name</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span>
        <span class="n">identities_db</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">affiliations</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">aff</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">:</span>
        <span class="n">affiliations</span> <span class="o">+=</span> <span class="s">&quot; AND up.identifier&lt;&gt;&#39;&quot;</span><span class="o">+</span><span class="n">aff</span><span class="o">+</span><span class="s">&quot;&#39; &quot;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT up.id as id, up.identifier as closers, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       COUNT(DISTINCT(c.id)) as closed &quot;</span><span class="o">+</span>\
        <span class="s">&quot;FROM &quot;</span><span class="o">+</span><span class="n">GetTablesCompaniesITS</span><span class="p">(</span><span class="n">identities_db</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.companies com, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople up &quot;</span><span class="o">+</span>\
        <span class="s">&quot;WHERE &quot;</span><span class="o">+</span><span class="n">GetFiltersCompaniesITS</span><span class="p">()</span><span class="o">+</span><span class="s">&quot; AND &quot;</span> <span class="o">+</span> <span class="n">closed_condition</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      AND pup.upeople_id = up.id &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      AND upc.company_id = com.id &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      AND com.name = &quot;</span><span class="o">+</span> <span class="n">company_name</span> <span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      AND changed_on &gt;= &quot;</span><span class="o">+</span><span class="n">startdate</span><span class="o">+</span><span class="s">&quot; AND changed_on &lt; &quot;</span><span class="o">+</span><span class="n">enddate</span><span class="o">+</span>\
            <span class="n">affiliations</span> <span class="o">+</span>\
        <span class="s">&quot; GROUP BY up.identifier ORDER BY closed DESC, closers LIMIT &quot;</span> <span class="o">+</span> <span class="n">limit</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetTopClosers"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetTopClosers">[docs]</a><span class="k">def</span> <span class="nf">GetTopClosers</span> <span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span>
        <span class="n">identities_db</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span> <span class="p">:</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">filter</span><span class="p">:</span>
        <span class="n">affiliations_from</span> <span class="o">=</span> <span class="n">GetTablesOwnUniqueIdsITS</span><span class="p">()</span>
        <span class="n">affiliations_where</span> <span class="o">=</span> <span class="n">GetFiltersOwnUniqueIdsITS</span> <span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">affiliations</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">aff</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">:</span>
            <span class="n">affiliations</span> <span class="o">+=</span> <span class="s">&quot; com.name&lt;&gt;&#39;&quot;</span><span class="o">+</span> <span class="n">aff</span> <span class="o">+</span><span class="s">&quot;&#39; and &quot;</span>
        <span class="n">affiliations_from</span> <span class="o">=</span> <span class="n">GetTablesCompaniesITS</span><span class="p">(</span><span class="n">identities_db</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> \
            <span class="n">identities_db</span> <span class="o">+</span> <span class="s">&quot;.companies com&quot;</span>
        <span class="n">affiliations_where</span> <span class="o">=</span> <span class="n">GetFiltersCompaniesITS</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; and &quot;</span> <span class="o">+</span> \
            <span class="n">affiliations</span> <span class="o">+</span> \
            <span class="s">&quot; upc.company_id = com.id&quot;</span>

    <span class="n">date_limit</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">days</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;SELECT @maxdate:=max(changed_on) from changes limit 1&quot;</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="n">date_limit</span> <span class="o">=</span> <span class="s">&quot; AND DATEDIFF(@maxdate, changed_on)&lt;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT up.id as id, up.identifier as closers, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;       count(distinct(c.id)) as closed &quot;</span><span class="o">+</span>\
        <span class="s">&quot;FROM  &quot;</span><span class="o">+</span><span class="n">affiliations_from</span><span class="o">+</span>\
        <span class="s">&quot;,     &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople up &quot;</span><span class="o">+</span>\
        <span class="s">&quot;WHERE &quot;</span><span class="o">+</span><span class="n">affiliations_where</span><span class="o">+</span><span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      c.changed_by = pup.people_id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      pup.upeople_id = up.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      c.changed_on &gt;= &quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      c.changed_on &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span> <span class="o">+</span>\
        <span class="s">&quot;      &quot;</span><span class="o">+</span><span class="n">closed_condition</span><span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">date_limit</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;GROUP BY up.identifier &quot;</span><span class="o">+</span>\
        <span class="s">&quot;ORDER BY closed desc, closers &quot;</span><span class="o">+</span>\
        <span class="s">&quot;LIMIT &quot;</span><span class="o">+</span> <span class="n">limit</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">item</span><span class="p">:</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetDomainTopClosers"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetDomainTopClosers">[docs]</a><span class="k">def</span> <span class="nf">GetDomainTopClosers</span> <span class="p">(</span><span class="n">domain_name</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span>
        <span class="n">identities_db</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">affiliations</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">aff</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">:</span>
        <span class="n">affiliations</span> <span class="o">+=</span> <span class="s">&quot; AND up.identifier&lt;&gt;&#39;&quot;</span><span class="o">+</span><span class="n">aff</span><span class="o">+</span><span class="s">&quot;&#39; &quot;</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT up.id as id, up.identifier as closers, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;COUNT(DISTINCT(c.id)) as closed &quot;</span><span class="o">+</span>\
        <span class="s">&quot;FROM &quot;</span><span class="o">+</span><span class="n">GetTablesDomainsITS</span><span class="p">(</span><span class="n">identities_db</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.domains dom, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;     &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople up &quot;</span><span class="o">+</span>\
        <span class="s">&quot;WHERE &quot;</span><span class="o">+</span> <span class="n">GetFiltersDomainsITS</span><span class="p">()</span><span class="o">+</span><span class="s">&quot; AND &quot;</span><span class="o">+</span><span class="n">closed_condition</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      AND pup.upeople_id = up.id &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      AND upd.domain_id = dom.id &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      AND dom.name = &quot;</span><span class="o">+</span><span class="n">domain_name</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;      AND changed_on &gt;= &quot;</span><span class="o">+</span><span class="n">startdate</span><span class="o">+</span><span class="s">&quot; AND changed_on &lt; &quot;</span> <span class="o">+</span><span class="n">enddate</span> <span class="o">+</span>\
              <span class="n">affiliations</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;GROUP BY up.identifier ORDER BY closed DESC, closers LIMIT &quot;</span> <span class="o">+</span> <span class="n">limit</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetTopOpeners"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetTopOpeners">[docs]</a><span class="k">def</span> <span class="nf">GetTopOpeners</span> <span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span>
        <span class="n">identities_db</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span> <span class="p">:</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">filter</span><span class="p">:</span>
        <span class="n">affiliations_from</span> <span class="o">=</span> <span class="n">GetTablesOwnUniqueIdsITS</span><span class="p">(</span><span class="s">&#39;issues&#39;</span><span class="p">)</span>
        <span class="n">affiliations_where</span> <span class="o">=</span> <span class="n">GetFiltersOwnUniqueIdsITS</span> <span class="p">(</span><span class="s">&#39;issues&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">affiliations</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">aff</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">:</span>
            <span class="n">affiliations</span> <span class="o">+=</span> <span class="s">&quot; com.name&lt;&gt;&#39;&quot;</span><span class="o">+</span> <span class="n">aff</span> <span class="o">+</span><span class="s">&quot;&#39; and &quot;</span>
        <span class="n">affiliations_from</span> <span class="o">=</span> <span class="n">GetTablesCompaniesITS</span><span class="p">(</span><span class="n">identities_db</span><span class="p">,</span><span class="s">&#39;issues&#39;</span><span class="p">)</span> <span class="o">+</span> \
            <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">identities_db</span> <span class="o">+</span> <span class="s">&quot;.companies com&quot;</span>
        <span class="n">affiliations_where</span> <span class="o">=</span> <span class="n">GetFiltersCompaniesITS</span><span class="p">(</span><span class="s">&#39;issues&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; and &quot;</span> <span class="o">+</span> \
            <span class="n">affiliations</span> <span class="o">+</span> \
            <span class="s">&quot; upc.company_id = com.id&quot;</span>

    <span class="n">date_limit</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">days</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;SELECT @maxdate:=max(submitted_on) from issues limit 1&quot;</span>
        <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="n">date_limit</span> <span class="o">=</span> <span class="s">&quot; AND DATEDIFF(@maxdate, submitted_on)&lt;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)</span>

    <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;SELECT up.id as id, up.identifier as openers, &quot;</span><span class="o">+</span>\
        <span class="s">&quot;    count(distinct(i.id)) as opened &quot;</span><span class="o">+</span>\
        <span class="s">&quot;FROM &quot;</span><span class="o">+</span><span class="n">affiliations_from</span><span class="o">+</span>\
        <span class="s">&quot; ,   &quot;</span><span class="o">+</span><span class="n">identities_db</span><span class="o">+</span><span class="s">&quot;.upeople up &quot;</span><span class="o">+</span>\
        <span class="s">&quot;WHERE &quot;</span><span class="o">+</span><span class="n">affiliations_where</span><span class="o">+</span><span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;    pup.upeople_id = up.id and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;    i.submitted_on &gt;= &quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span> <span class="s">&quot; and &quot;</span><span class="o">+</span>\
        <span class="s">&quot;    i.submitted_on &lt; &quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span>\
            <span class="n">date_limit</span><span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">+</span>\
        <span class="s">&quot;    GROUP BY up.identifier &quot;</span><span class="o">+</span>\
        <span class="s">&quot;    ORDER BY opened desc, openers &quot;</span><span class="o">+</span>\
        <span class="s">&quot;    LIMIT &quot;</span> <span class="o">+</span> <span class="n">limit</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c">#################</span>
<span class="c"># People information, to be refactored</span>
<span class="c">#################</span>
</div>
<div class="viewcode-block" id="GetPeopleListITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetPeopleListITS">[docs]</a><span class="k">def</span> <span class="nf">GetPeopleListITS</span> <span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;DISTINCT(pup.upeople_id) as pid, count(c.id) as total&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">GetTablesOwnUniqueIdsITS</span><span class="p">()</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetFiltersOwnUniqueIdsITS</span><span class="p">()</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; GROUP BY pid ORDER BY total desc&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&#39;changed_on&#39;</span><span class="p">,</span><span class="n">fields</span><span class="p">,</span><span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="GetPeopleQueryITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetPeopleQueryITS">[docs]</a><span class="k">def</span> <span class="nf">GetPeopleQueryITS</span> <span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">evol</span><span class="p">,</span>  <span class="n">closed_condition</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot; COUNT(distinct(c.issue_id)) AS closed&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">GetTablesOwnUniqueIdsITS</span><span class="p">()</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="n">GetFiltersOwnUniqueIdsITS</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; AND pup.upeople_id = &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">developer_id</span><span class="p">)</span>
    <span class="n">filters</span> <span class="o">+=</span> <span class="s">&quot; AND &quot;</span><span class="o">+</span> <span class="n">closed_condition</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">evol</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLPeriod</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="s">&#39;changed_on&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                            <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">fields</span> <span class="o">+=</span> <span class="s">&quot;,DATE_FORMAT (min(changed_on),&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;) as first_date, &quot;</span><span class="o">+</span>\
                  <span class="s">&quot;DATE_FORMAT (max(changed_on),&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;) as last_date&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">GetSQLGlobal</span><span class="p">(</span><span class="s">&#39;changed_on&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span>
                            <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetPeopleEvolITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetPeopleEvolITS">[docs]</a><span class="k">def</span> <span class="nf">GetPeopleEvolITS</span> <span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span> <span class="p">:</span>
    <span class="c">## FIXME is this function used only to calculate closed issues? if not it must be</span>
    <span class="c">## fixed</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetPeopleQueryITS</span><span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GetPeopleStaticITS"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetPeopleStaticITS">[docs]</a><span class="k">def</span> <span class="nf">GetPeopleStaticITS</span> <span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span> <span class="p">:</span>
    <span class="c">## FIXME is this function used only to calculate closed issues? if not it must be</span>
    <span class="c">## fixed</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">GetPeopleQueryITS</span><span class="p">(</span><span class="n">developer_id</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">ExecuteQuery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c">#################</span>
<span class="c"># Micro studies</span>
<span class="c">#################</span>
</div>
<div class="viewcode-block" id="EvolBMIIndex"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.EvolBMIIndex">[docs]</a><span class="k">def</span> <span class="nf">EvolBMIIndex</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">):</span>
    <span class="c"># Metric based on chapter 4.3.1 from</span>
    <span class="c"># &quot;Metrics and Models in Software Quality Engineering&quot;</span>
    <span class="c"># by Stephen H. Kan</span>
    <span class="n">closed</span> <span class="o">=</span> <span class="n">EvolIssuesClosed</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
    <span class="n">closed</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">closed</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
    <span class="n">opened</span> <span class="o">=</span> <span class="n">EvolIssuesOpened</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">)</span>
    <span class="n">opened</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">opened</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="n">evol_bmi</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">closed</span><span class="p">[</span><span class="s">&quot;closed&quot;</span><span class="p">]:</span>
        
        <span class="n">index</span> <span class="o">=</span> <span class="n">closed</span><span class="p">[</span><span class="s">&quot;closed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opened</span><span class="p">[</span><span class="s">&quot;opened&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c">#div by 0</span>
            <span class="n">evol_bmi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="c"># some &quot;neutral&quot; value, although this should be infinite</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">evol_bmi</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">opened</span><span class="p">[</span><span class="s">&#39;opened&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;closed&#39;</span> <span class="p">:</span> <span class="n">closed</span><span class="p">[</span><span class="s">&#39;closed&#39;</span><span class="p">],</span>
            <span class="s">&#39;opened&#39;</span> <span class="p">:</span> <span class="n">opened</span><span class="p">[</span><span class="s">&#39;opened&#39;</span><span class="p">],</span>
            <span class="s">&#39;bmi&#39;</span> <span class="p">:</span> <span class="n">evol_bmi</span><span class="p">}</span>
</div>
<div class="viewcode-block" id="GetClosedSummaryCompanies"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.GetClosedSummaryCompanies">[docs]</a><span class="k">def</span> <span class="nf">GetClosedSummaryCompanies</span> <span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="n">num_companies</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">first_companies</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">companies</span> <span class="o">=</span> <span class="n">GetCompaniesNameITS</span><span class="p">(</span><span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;-Bot&quot;</span><span class="p">,</span> <span class="s">&quot;-Individual&quot;</span><span class="p">,</span> <span class="s">&quot;-Unknown&quot;</span><span class="p">])</span>
    <span class="n">companies</span> <span class="o">=</span> <span class="n">companies</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">company</span> <span class="ow">in</span> <span class="n">companies</span><span class="p">:</span>
        <span class="n">type_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;company&quot;</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span><span class="o">+</span><span class="n">company</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span><span class="p">]</span>
        <span class="n">closed</span> <span class="o">=</span> <span class="n">EvolIssuesClosed</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">,</span> <span class="n">identities_db</span><span class="p">,</span> <span class="n">type_analysis</span><span class="p">,</span> <span class="n">closed_condition</span><span class="p">)</span>
        <span class="n">closed</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">closed</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>
        <span class="c"># Rename field closed to company name</span>
        <span class="n">closed</span><span class="p">[</span><span class="n">company</span><span class="p">]</span> <span class="o">=</span> <span class="n">closed</span><span class="p">[</span><span class="s">&quot;closed&quot;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">closed</span><span class="p">[</span><span class="s">&#39;closed&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&lt;=</span> <span class="n">num_companies</span><span class="p">):</span>
            <span class="c">#Case of companies with entity in the dataset</span>
            <span class="n">first_companies</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">first_companies</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">closed</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="c">#Case of companies that are aggregated in the field Others</span>
            <span class="k">if</span> <span class="s">&#39;Others&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">first_companies</span><span class="p">:</span>
                <span class="n">first_companies</span><span class="p">[</span><span class="s">&#39;Others&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">closed</span><span class="p">[</span><span class="n">company</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first_companies</span><span class="p">[</span><span class="s">&#39;Others&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">first_companies</span><span class="p">[</span><span class="s">&#39;Others&#39;</span><span class="p">],</span><span class="n">closed</span><span class="p">[</span><span class="n">company</span><span class="p">])]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">first_companies</span> <span class="o">=</span> <span class="n">completePeriodIds</span><span class="p">(</span><span class="n">first_companies</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">startdate</span><span class="p">,</span> <span class="n">enddate</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">first_companies</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Backend"><a class="viewcode-back" href="../../vizgrimoire.ITS.html#vizgrimoire.ITS.Backend">[docs]</a><span class="k">class</span> <span class="nc">Backend</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">its_type</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">closed_condition</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">reopened_condition</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">name_log_table</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">statuses</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">open_status</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">reopened_status</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">name_log_table</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">its_type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">its_type</span> <span class="o">=</span> <span class="n">its_type</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">its_type</span> <span class="o">==</span> <span class="s">&#39;allura&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">closed_condition</span> <span class="o">=</span> <span class="s">&quot;new_value=&#39;CLOSED&#39;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">its_type</span> <span class="o">==</span> <span class="s">&#39;bugzilla&#39;</span> <span class="ow">or</span> <span class="n">its_type</span> <span class="o">==</span> <span class="s">&#39;bg&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">closed_condition</span> <span class="o">=</span> <span class="s">&quot;(new_value=&#39;RESOLVED&#39; OR new_value=&#39;CLOSED&#39;)&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reopened_condition</span> <span class="o">=</span> <span class="s">&quot;new_value=&#39;NEW&#39;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_log_table</span> <span class="o">=</span> <span class="s">&#39;issues_log_bugzilla&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statuses</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;NEW&quot;</span><span class="p">,</span> <span class="s">&quot;ASSIGNED&quot;</span><span class="p">]</span>
            <span class="c">#Pretty specific states in Red Hat&#39;s Bugzilla</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statuses</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;ASSIGNED&quot;</span><span class="p">,</span> <span class="s">&quot;CLOSED&quot;</span><span class="p">,</span> <span class="s">&quot;MODIFIED&quot;</span><span class="p">,</span> <span class="s">&quot;NEW&quot;</span><span class="p">,</span> <span class="s">&quot;ON_DEV&quot;</span><span class="p">,</span> \
                    <span class="s">&quot;ON_QA&quot;</span><span class="p">,</span> <span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="s">&quot;RELEASE_PENDING&quot;</span><span class="p">,</span> <span class="s">&quot;VERIFIED&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">its_type</span> <span class="o">==</span> <span class="s">&#39;github&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">closed_condition</span> <span class="o">=</span> <span class="s">&quot;field=&#39;closed&#39;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">its_type</span> <span class="o">==</span> <span class="s">&#39;jira&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">closed_condition</span> <span class="o">=</span> <span class="s">&quot;new_value=&#39;CLOSED&#39;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reopened_condition</span> <span class="o">=</span> <span class="s">&quot;new_value=&#39;Reopened&#39;&quot;</span>
            <span class="c">#self.new_condition = &quot;status=&#39;Open&#39;&quot;</span>
            <span class="c">#self.reopened_condition = &quot;status=&#39;Reopened&#39;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open_status</span> <span class="o">=</span> <span class="s">&#39;Open&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reopened_status</span> <span class="o">=</span> <span class="s">&#39;Reopened&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_log_table</span> <span class="o">=</span> <span class="s">&#39;issues_log_jira&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">its_type</span> <span class="o">==</span> <span class="s">&#39;lp&#39;</span><span class="p">):</span>
            <span class="c">#self.closed_condition = &quot;(new_value=&#39;Fix Released&#39; or new_value=&#39;Invalid&#39; or new_value=&#39;Expired&#39; or new_value=&#39;Won&#39;&#39;t Fix&#39;)&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">closed_condition</span> <span class="o">=</span> <span class="s">&quot;(new_value=&#39;Fix Committed&#39;)&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statuses</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="s">&quot;Fix Committed&quot;</span><span class="p">,</span> <span class="s">&quot;New&quot;</span><span class="p">,</span> <span class="s">&quot;In Progress&quot;</span><span class="p">,</span> <span class="s">&quot;Triaged&quot;</span><span class="p">,</span> <span class="s">&quot;Incomplete&quot;</span><span class="p">,</span> <span class="s">&quot;Invalid&quot;</span><span class="p">,</span> <span class="s">&quot;Won</span><span class="se">\\</span><span class="s">&#39;t Fix&quot;</span><span class="p">,</span> <span class="s">&quot;Fix Released&quot;</span><span class="p">,</span> <span class="s">&quot;Opinion&quot;</span><span class="p">,</span> <span class="s">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s">&quot;Expired&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_log_table</span> <span class="o">=</span> <span class="s">&#39;issues_log_launchpad&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">its_type</span> <span class="o">==</span> <span class="s">&#39;redmine&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statuses</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;New&quot;</span><span class="p">,</span> <span class="s">&quot;Verified&quot;</span><span class="p">,</span> <span class="s">&quot;Need More Info&quot;</span><span class="p">,</span> <span class="s">&quot;In Progress&quot;</span><span class="p">,</span> <span class="s">&quot;Feedback&quot;</span><span class="p">,</span>
                         <span class="s">&quot;Need Review&quot;</span><span class="p">,</span> <span class="s">&quot;Testing&quot;</span><span class="p">,</span> <span class="s">&quot;Pending Backport&quot;</span><span class="p">,</span> <span class="s">&quot;Pending Upstream&quot;</span><span class="p">,</span>
                         <span class="s">&quot;Resolved&quot;</span><span class="p">,</span> <span class="s">&quot;Closed&quot;</span><span class="p">,</span> <span class="s">&quot;Rejected&quot;</span><span class="p">,</span> <span class="s">&quot;Won</span><span class="se">\\</span><span class="s">&#39;t Fix&quot;</span><span class="p">,</span> <span class="s">&quot;Can</span><span class="se">\\</span><span class="s">&#39;t reproduce&quot;</span><span class="p">,</span>
                         <span class="s">&quot;Duplicate&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">closed_condition</span> <span class="o">=</span> <span class="s">&quot;(new_value=&#39;Resolved&#39; OR new_value=&#39;Closed&#39; OR new_value=&#39;Rejected&#39;&quot;</span> <span class="o">+</span>\
                                  <span class="s">&quot; OR new_value=&#39;Won</span><span class="se">\\</span><span class="s">&#39;t Fix&#39; OR new_value=&#39;Can</span><span class="se">\\</span><span class="s">&#39;t reproduce&#39; OR new_value=&#39;Duplicate&#39;)&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reopened_condition</span> <span class="o">=</span> <span class="s">&quot;new_value=&#39;Reopened&#39;&quot;</span> <span class="c"># FIXME: fake condition</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_log_table</span> <span class="o">=</span> <span class="s">&#39;issues_log_redmine&#39;</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">GrimoreLib 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Bitergia.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>